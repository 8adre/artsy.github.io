<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ios | Artsy Engineering]]></title>
  <link href="http://artsy.github.io/blog/categories/ios/atom.xml" rel="self"/>
  <link href="http://artsy.github.io/"/>
  <updated>2015-08-06T17:20:58-04:00</updated>
  <id>http://artsy.github.io/</id>
  <author>
    <name><![CDATA[Artsy]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Open Sourcing Energy]]></title>
    <link href="http://artsy.github.io/blog/2015/08/06/open-sourcing-energy/"/>
    <updated>2015-08-06T13:54:00-04:00</updated>
    <id>http://artsy.github.io/blog/2015/08/06/open-sourcing-energy</id>
    <content type="html"><![CDATA[<p>The Artsy Mobile team is pretty aggressive in our stance on <a href="http://code.dblock.org/2015/02/09/becoming-open-source-by-default.html">Open Source by Default</a>. We've talked about it at <a href="https://www.youtube.com/watch?v=2DvDeEZ0NDw&amp;spfreload=10">conferences</a> <a href="https://www.youtube.com/watch?v=SjjvnrqDjpM">around</a> <a href="https://www.youtube.com/watch?v=zPbLYWmLPow">the</a> <a href="https://speakerdeck.com/orta/ios-at-artsy">world</a>, in <a href="www.objc.io/issues/22-scale/artsy">renowned magazines</a> and on <a href="http://artsy.github.io/blog/2015/04/28/how-we-open-sourced-eigen/">our blog</a>.</p>

<p>It's worth mentioning that we don't just talk externally about Open Source. Internally, the Mobile team runs talks about Open Source for the rest of the Artsy staff. As well, we discuss the tooling and business implications of having our work in public repos. Artsy strives for an open culture, in this case the development team, on the whole, is just further along in the process.</p>

<p>The Open Source app idea started with an experiment in the Summer of 2014, asking, "What does a truly Open Source App look like?" The outcome of that was our Swift Kiosk app, <a href="https://github.com/artsy/eidolon/">Eidolon</a>. Open from day one. We took the knowledge from that and applied it to our public facing app, <a href="https://github.com/artsy/eigen/">Eigen</a>. Open from day 806. That made 2/3rds of our apps Open Source.</p>

<p>I'm going to talk about our final app, <a href="https://github.com/artsy/energy">Energy</a>. Open from day 1433 and ~3500 commits.</p>

<!-- more -->


<hr />

<p><img src="/images/2015-08-01-open-sourcing-energy/ENERGY.png" alt="ENERGY" /></p>

<p>Energy is commonly known as <a href="http://folio.artsy.net">Artsy Folio</a>. It's a tool for Artsy's Partners to showcase their artworks on the go, and quickly email them. Here's a beautiful splash showing it in action.</p>

<p></div></div><a href='http://folio.artsy.net/images/cover-bbf6fdf4.jpg'><img src="http://folio.artsy.net/images/cover-bbf6fdf4.jpg" title="Folio overview" ></a><div class='meta-container'><header>&nbsp;</header></div><div class='date-container'>&nbsp;</div><div class='content-container'><div class='entry-content'></p>

<p>This app comes from the pre-CocoaPods, pre-ARC, pre-UICollectionView and pre-Auto Layout days. It spent 3 years with no tests, but has come up to over 50% code coverage in the last year. It's testing suite is super fast, given that we learned a lot with Eigen's tests we stuck with five main principals:</p>

<ul>
<li>No un-stubbed HTTP requests.</li>
<li>Avoid <code>will</code>s in a test as much as possible.</li>
<li>Never allow access to the main Core Data instance in tests</li>
<li>Dependency Inject anything</li>
<li>Use snapshots to test view controller states</li>
</ul>


<h3>On Opening Folio</h3>

<p>Folio is interesting in that it has competitors. To some extent the Kiosk app does too, but the cost of entry there is really high in comparison. Folio on the other hand, has a handful of competing businesses who exist to <em>only</em> build a Gallery/Museum/Collector portfolio app. In opening the code for Folio, we're not making it easy for people to copy and paste our business, it's very directly tied to Artsy's APIs and <a href="http://www.dylanfareed.com/projects/artsy-cms/">CMS</a>.</p>

<p>I commonly get questions about the process of Open Sourcing an app, so here's what happened after I decided it was time. First, I emailed my intent:</p>

<p></div></div><a href='/images/2015-08-01-open-sourcing-energy/oss-energy-email.png'><img src="/images/2015-08-01-open-sourcing-energy/oss-energy-email.png"></a><div class='meta-container'><header>&nbsp;</header></div><div class='date-container'>&nbsp;</div><div class='content-container'><div class='entry-content'></p>

<p>The concepts I wanted to cover were: "This is a codebase is worthy of art", "We know what we're doing", "This doesn't make it simple for someone to create a business off our product" and "I've managed to get a lot of the source out already." I gave a month or so to ensure that I could have corridor chats with people, in order to be very certain around opinions. We had some discussions in the email thread about ways in which an open source'd Energy would impact the team, and overall the reaction was positive. This wasn't surprising, the non-technical parts of the team are regularly kept up to date on thoughts like this.</p>

<p>After the internal announcement I started looking at the codebase and decided what should be cleaned up. I don't believe a codebase is ever perfect ( just look at Eigen's <a href="https://raw.githubusercontent.com/artsy/eigen/3f29f61f2b96f516e9ecf407818b82911b268694/HACKS.md">HACKS.md</a> ) but one thing I learned from the launch of Eigen is that we need a lot of beginner docs to help people get started. So I went into Energy's <a href="https://github.com/artsy/energy/tree/master/docs">docs</a> directory and started comparing it to <a href="https://github.com/artsy/eigen/tree/master/docs">Eigen</a>'s.</p>

<p>With the docs ready, we anticipated the repo change as <a href="/blog/2015/04/28/how-we-open-sourced-eigen/">with Eigen</a>. This means making sure all loose pull requests were wrapped up, and all code comments were audited. Next we used <a href="https://github.com/google/github-issue-mover">github-issue-mover</a> to migrate important issues to the new repo. Then we deleted the <code>.git</code> folder in the app, and <code>git init</code> to create a new repo.</p>

<p>Given that we have three Open source apps now, I wanted to give them a consistent branding when we talk about the apps from the context of the codebase. It's like programming, if you're writing a similar thing 3 times, definitely time to refactor.</p>

<p></div></div><a href='/images/2015-08-01-open-sourcing-energy/oss-design-sketch.png'><img src="/images/2015-08-01-open-sourcing-energy/oss-design-sketch.png"></a><div class='meta-container'><header>&nbsp;</header></div><div class='date-container'>&nbsp;</div><div class='content-container'><div class='entry-content'></p>

<p>Finally, I started working on the announcement blog post. Which you're reading. I'll send a <a href="https://github.com/artsy/artsy.github.com/pull/119">pull request</a> for this blog post, then when it's merged, I'll take one more final look over how everything looks, then make the new Energy repo public.</p>

<h3>On more than just Opening Source</h3>

<p>Eigen, the public facing iOS app, allows people to log in with a trial user account. We also have a known API Key + Secret for the <a href="https://github.com/artsy/eigen/blob/master/Makefile#L41-L42">OSS app</a>. With this, any developer can run a few commands and have a working application to play around in. This makes it easy to look around and see how things are done.</p>

<p>Energy, however, requires you have a Artsy partner account. So opening it up would mean that an OSS developer hits the login screen and is stuck. In developing this app, I've slowly been creating my own partner gallery account based on my paintings and photography. So now when you set up the app to run as an OSS app, it will pre-load a known database of artworks and metadata from my test gallery.</p>

<p></div></div><a href='/images/2015-08-01-open-sourcing-energy/ios-sim.png'><img src="/images/2015-08-01-open-sourcing-energy/ios-sim.png"></a><div class='meta-container'><header>&nbsp;</header></div><div class='date-container'>&nbsp;</div><div class='content-container'><div class='entry-content'></p>

<p>It's easy to imagine that Open Sourcing something is an end-point, but from our perspective it's a journey. We want to make sure that anyone can download this app, learn how and why it's structured and then run through the app with a debugger to get a deeper sense of how everything connects. Just releasing the code would have been underwhelming. Instead we're aiming high.</p>

<p>I think that there is no higher compliment to your team and your code than opening it to the public.</p>

<p>You should Open Source your app.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How we Open Source'd Eigen]]></title>
    <link href="http://artsy.github.io/blog/2015/04/28/how-we-open-sourced-eigen/"/>
    <updated>2015-04-28T00:00:00-04:00</updated>
    <id>http://artsy.github.io/blog/2015/04/28/how-we-open-sourced-eigen</id>
    <content type="html"><![CDATA[<p>It was 95 days ago, and I was sitting before of my computer in NYC. I loaded my terminal, opened <a href="https://taptalk.me">TapTalk</a> on my phone, tapped on my collegue <a href="http://ashfurrow.com">Ash's</a> avatar and held my finger there. I paused, this moment was a long time, it was worth waiting. I switched the camera from my face to the screen with the terminal open.</p>

<p>This moment was probably the most nervous I had been in years. It showed <code>git push origin master</code>. I said "it's happening." I hit return. A new era in the Artsy mobile team had started. A few minutes later, I wrote this tweet:</p>

<center>
<blockquote class="twitter-tweet" data-cards="hidden" lang="en"><p>We have open source’d the <a href="https://twitter.com/artsy">@Artsy</a> iOS app.&#10;&#10;<a href="https://t.co/c1SWtHmUgy">https://t.co/c1SWtHmUgy</a>&#10;&#10;🎉</p>&mdash; Ørta (@orta) <a href="https://twitter.com/orta/status/558395611754819586">January 22, 2015</a></blockquote>
</center>


<p>Let's go over the process we went through to get to that point.</p>

<!-- more -->


<p>Credit where credit is due, when we were <a href="/blog/2014/11/13/eidolon-retrospective/">working on Eidolon</a>, our CTO <a href="http://code.dblock.org/">dB</a> just casually tossed the idea that, really, Eigen should be open source too. Eigen is the code name for the <a href="http://iphone.artsy.net/">Artsy iOS app</a>. This totally threw me for a loop, we were only just getting to a point where we could build an app from scratch in the open. Trying to get a project that had existed for years and had its own momentum converted would take a lot of thinking about.</p>

<p>We devoted time at the end of 2014 to understand what the constraints were for getting the app opened. From a purely functional perspective we would have to start with a <a href="https://github.com/artsy/mobile/issues/11">drastic decision</a> around the repo itself.</p>

<h3>The Repo</h3>

<p><img src="/images/2015-04-28-open-sourcing-your-apps/rise-and-fall.png" alt="Rise And Fall" /></p>

<p>We opted to go for a total repo switch, removing all history. There were a lot of places where keys could have been hiding within the app. To get this done we migrated the existing <code>eigen</code> to <code>eigen-private</code> on github, and did a fresh <code>git init</code>. People who have joined Artsy Mobile post-OSS have never even cloned the <code>eigen-private</code> repo. So I feel good about this call.</p>

<p>We used the last few moments of the private repo to remove all of the default Apple copyright notices. We didn't feel they added anything on top of the git history, and made it feel like the founders of a project were more important than anyone working on improvements.</p>

<p>It wasn't all smooth sailing with respect to the repo switch however. As the switch happened the WatchKit came out, and we had devoted quite a lot of time to building an app in it. Given that you <a href="http://www.elischiff.com/blog/2015/3/24/fear-of-apple">can't predict Apple</a>'s reactions, and you couldn't ship an app with an embedded watch app to the store, we opted to work on a branch from our private repo. <a href="https://github.com/artsy/eigen/pull/302">For months</a>. In the end it was easier to have the two folders next to each other, then copy &amp; paste over all the files and to set all the settings in the Xcode project again.</p>

<p>One of the things that we found a bit sad about the transition to a new repo, is that it's hard to give past contributors recognition for their work. One of the ways we've worked around this is by having a file <a href="https://github.com/artsy/eigen/pull/409">documenting past contributors</a> in our repo.</p>

<h3>Docs</h3>

<p>We had to significantly update our README, and a lot of the process around bootstrapping. We wanted to reduce the friction to actually trying the app as much as possible. It's easy to look at the source on github but to be able to get it up and running quickly should be a really high priority. So our README is based on getting it up and running as an OSS project, not for someone internal who may push betas/releases.</p>

<p>When we opened the repo, there <a href="https://github.com/artsy/eigen/pulls?q=is%3Apr+is%3Aclosed+sort%3Acreated-asc">were a lot</a> of documentation fix PRs - thanks <em>segiddins</em>, <em>neonichu</em> and <em>dkhamsing</em>. They have low barriers to entry, and fun to make for people looking through big projects. We still get them pretty regularly.</p>

<h3>Secrets</h3>

<p>There aren't large sections of the our app that we are keeping secret, though we have discussed ways in which we could. There is however a nice solution to having something different for OSS vs your internal team, API compatible CocoaPods. We <a href="/blog/2014/06/20/artsys-first-closed-source-pod/">do this</a> for our fonts in all apps. We've talked extensively about our <a href="/blog/2015/01/21/cocoapods-keys-and-CI/">tools for keeping</a> API keys secret, so no need to go over that twice.</p>

<p>Other than that we had already been opening any good abstractions as CocoaPods for anyone to use. All our dependencies were packaged outside of the app, we had no crazy internal SDKs or anything worth hiding within the codebase.</p>

<h3>Selling the idea</h3>

<p>It's one thing to think that it's possible, it's another to do it. I'm glad that I am in a position where I can enact change. I felt no resistence in the process. I kept offering potential avenues for someone to stop me, too. I emailed the entire team as I started the process 2 weeks before it happened, I talked to anyone who might write issues or contribute from the design team. As I got further along the process and sent another email out that it was going to happen tomorrow. All I got were 👍 and 🎉s in <a href="https://itunes.apple.com/us/app/gifs/id961850017?l=en&amp;mt=12">GIF</a> form. So I kept moving forwards till that tweet above.</p>

<p>From our dev team's perspective, this is not a brave new world. Our website, <a href="https://github.com/artsy/force-public">force</a>, is open source. Though they operate under different constraints.</p>

<p>From the perspective of Artsy, even though opening our code aligns very strongly with our <a href="/blog/2015/03/31/the-culture-of-openness-artsy-mobile/">values of openness</a>, we are still a company. Opening up our codebase lets our competitors see what we're up to in advance, and <a href="http://code.dblock.org/2015/02/09/becoming-open-source-by-default.html">closed source</a> is still the norm for apps. Opening our code and process is also opening ourselves to criticism.</p>

<h3>Evolution of the team</h3>

<p>3 months on the way we operate has changed. We're a lot more organized, and the Eigen repo is easily the most well run project on the mobile team. It has <a href="https://github.com/artsy/eigen/milestones">active milestones</a>, that represent long term goals and the current sprint. We discuss a lot of the interesting cultural choices publicly on <a href="https://github.com/artsy/eigen/issues/221">issues</a> and in our <a href="https://github.com/artsy/mobile/issues">mobile team repo</a>. Having this app in the open, and the experience of doing so has also improved our workflow on other apps. Eidolon for example now runs with a similar structure.</p>

<p><img src="/images/2015-04-28-open-sourcing-your-apps/sprint-planning-issue.png" alt="Sprint Planning Issue" /></p>

<p>We found that people would use our issue structure to <a href="https://github.com/artsy/eigen/issues/324">ask</a> <a href="https://github.com/artsy/eigen/issues/313">questions</a> about Eigen itself. This was an unexpected positive outcome. It gave us a chance to re-think decisions and try to understand how we came to certain decisions that might not be documented anywhere.</p>

<p>Our culture improved by open sourcing our app. As individuals, it's great to know that our work goes towards helping the larger community and all engineers love having a green profile.</p>

<center>
<img src="http://artsy.github.io/images/2015-04-28-open-sourcing-your-apps/staying-green.png" alt="Staying Green">
</center>


<p>If you've not explored the idea of open sourcing your app, you should. We're happy to help out - <a href="https://github.com/artsy/mobile/issues/new">create an issue</a>. Or contact me personally, my email is on my <a href="https://github.com/orta">github profile</a>.</p>
]]></content>
  </entry>
  
</feed>
