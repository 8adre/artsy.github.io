
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Artsy Engineering</title>
  <meta name="author" content="">

  
  <meta name="description" content="
  
  
    
      
        



  
    
      
        
          
        
        
          Relay Pagination Containers Demystified
        
    ...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:image" content="http://artsy.github.io/images/artsy_oss_image.png" />
  <meta property="og:image:type" content="image/png" />

  
  <link rel="canonical" href="http://artsy.github.io/">
  <link rel="alternate" type="application/rss+xml" title="Artsy Engineering Blog" href="/feed">

  <link href="/favicon.ico" rel="icon">
  <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <script src="/javascripts/jquery-1.11.3.min.js"> </script>
  <script src="/javascripts/gradient-fade.js"></script>
  <script src="/javascripts/noframework.waypoints.min.js"></script>
  <script src="/javascripts/sticky.min.js"></script>
  <script src="/javascripts/search.min.js"></script>
  <script src="/javascripts/custom-element.min.js"></script>
  <script src="/javascripts/g-emoji-element.js"></script>

  

  <script type="text/javascript" src="https://fast.fonts.net/jsapi/f7f47a40-b25b-44ee-9f9c-cfdfc8bb2741.js"></script>


  <link href="" rel="alternate" title="Artsy Engineering" type="application/atom+xml">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12450662-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <!--[if IE 8]><link href="/stylesheets/custom/ie_font.css" type="text/css"><![endif]-->

</head>


<body>
  <div id="logo-container">
    <a id="lrg-mark" href="https://www.artsy.net/">
      <svg viewBox="0 0 510 510" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
        <path transform="scale(1, -1) translate(0, -480)" d="M0 -32h512v512h-512v-512v0zM464 16h-80v80h-48v-80h-288v416h416v-416v0zM194 384h-40l-74 -186h38l20 52h72l19 -52h39l-74 186v0zM149 282l25 66l24 -66h-49v0z"/>
      </svg>
    </a>
  </div>
  <header id="banner"><div id="header">
  <div class="header-navigation">
    <ul>
      <li><a href="https://developers.artsy.net/">API</a></li>
      <li><a href="https://www.artsy.net/jobs">Careers</a></li>
      <li><a href="http://twitter.com/artsyopensource">@artsyopensource</a></li>
      <li><a href="http://www.artsy.net/">Artsy.net</a></li>
    </ul>
    <span class="header-section-title">
      
        <a href="/open-source">Open Source</a>
      
    </span>
  </div>

  <div class="header-sticky-container">
    <div class="header-logo">
      <h2><a href="http://artsy.github.io">Artsy</a></h2>
    </div>
    <div class="header-search">
      
        <h2><a href="/">Engineering Blog</a></h2>
        <span>
  <form action="/search" method="get">
    <input class="search" id="search-query" type="text" name="q" results="0" placeholder="Search"/>
  </form>

</span>
      
    </div>
  </div>
</div>
</header>
  <div class="header-hamburger">
    <button class="cmn-toggle-switch cmn-toggle-switch__htx">
      <span>toggle menu</span>
    </button>
  </div>
  <div id="main">
    <div id="content">

      <div class="blog-index">
  
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/08/31/relay-pagination-containers-demystified/">
        
        
          <h2 class="entry-title">Relay Pagination Containers Demystified</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/ash">Ash Furrow<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/ashfurrow">@ashfurrow</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>In 2017, Artsy adopted <a href="https://relay.dev/en/">Relay</a> in both its front-end web and iOS codebases (using React and
React Native, respectively). Generally speaking, this investment has turned out very well for us! Relay empowers
product teams to quickly iterate on new features and to share common infrastructure across web and iOS codebases.
However, most of the original engineers who pioneered using Relay at Artsy have since moved on to their next role;
this has left a knowledge gap where Artsy engineers are comfortable <em>using</em> Relay, but they don't totally
understand how it works.</p>

<p>This is a problem as old as software engineering itself, and it has a simple solution: learn and then teach others.
We'll be driving a peer learning group centering around Relay, but today we are going to dive into the part of
Relay that comes up the most in requests for pairing: getting Relay pagination to work. (Note: we're going to use
plain old Relay and not <a href="https://github.com/relay-tools/relay-hooks">relay-hooks</a>.)</p>

<p>My goal with this post is to show my thought process when trying to learn about, and clean up our use of, Relay
pagination containers. This post emphasizes the <em>demystifying</em> process and not so much the <em>Relay pagination
containers</em> themselves â€“ we'll briefly cover some Relay fundamentals before diving into a case study on how
problematic code proliferates through copy-and-paste.</p>

<p>Let's back up and talk a little bit about what Relay is and how it works. Relay is a framework that glues React
components and GraphQL requests together. React components define the data they need from a GraphQL schema in order
to render themselves, and Relay handles actually fetching GraphQL requests and marshalling data into the React
component tree. It is very efficient because of build-time optimizations by the Relay compiler.</p>

<p>The simplest use of Relay is a <a href="https://relay.dev/docs/en/fragment-container">fragment container</a>, which is created
from a React component and a <a href="https://blog.logrocket.com/graphql-fragments-explained/">GraphQL fragment</a>. (We're
going to skip over how the GraphQL query is made, but
<a href="https://relay.dev/docs/en/query-renderer">here are the docs on query renderers</a> if you're curious.)</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">class</span> <span class="nx">Artist</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">artist</span> <span class="nx">name</span> <span class="nx">is</span> <span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">artist</span><span class="p">.</span><span class="nx">name</span><span class="p">}.</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="nx">ArtistFragmentContainer</span> <span class="o">=</span> <span class="nx">createFragmentContainer</span><span class="p">(</span><span class="nx">Artist</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">artist</span><span class="o">:</span> <span class="nx">graphql</span><span class="err">`</span> <span class="err">#</span> <span class="nx">artist</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">passed</span> <span class="k">in</span> <span class="nx">as</span> <span class="nx">props</span>
</span><span class='line'>    <span class="nx">fragment</span> <span class="nx">Artist_artist</span> <span class="nx">on</span> <span class="nx">Artist</span> <span class="p">{</span> <span class="err">#</span> <span class="nx">Relay</span> <span class="nx">has</span> <span class="nx">strong</span> <span class="nx">naming</span> <span class="nx">conventions</span>
</span><span class='line'>      <span class="nx">name</span> <span class="err">#</span> <span class="nx">Get</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">we</span> <span class="nx">want</span> <span class="nx">here</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">`</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>(At Artsy, we use <a href="https://github.com/relay-tools/relay-compiler-language-typescript">TypeScript with Relay</a>, but
for this blog post we'll stick to JavaScript.)</p>

<p>So we have a plain React component that gets some props, and a Relay fragment container that wraps it, defining the
data that the component needs.</p>

<p>There are other types of Relay containers beyond simple fragment containers.
<a href="https://relay.dev/docs/en/refetch-container">Refetch containers</a> are like fragment containers except you can
refetch their contents from your GraphQL server (in response to, for example, user interaction). Using a refetch
container is very similar to using a plain fragment container. But today, we want to talk about
<a href="https://relay.dev/docs/en/pagination-container">pagination containers</a>, which use a GraphQL construct called
<em>connections</em> to show page after page of data.</p>

<p><a href="https://www.apollographql.com/blog/explaining-graphql-connections-c48b7c3d6976/">GraphQL connections</a> are beyond
the scope of this blog post, but they are a way to fetch lists of data without running into the limitations of
returning a simple array. Connections can return metadata about their results, like how many total results there
are, and use cursors (rather than page numbers) for paginating. They also handle when items are inserted or deleted
from the results between requests for pages â€“
<a href="https://artsy.github.io/blog/2020/01/21/graphql-relay-windowed-pagination/">check out this blog post</a> for more
info on how to use connections with Relay.</p>

<p>Pagination containers take considerably more setup than plain fragment containers, and the setup itself is very
fickle. Things simply will not work until you get the configuration <em>exactly correct</em>, and then everything works
perfectly. The setup is largely repeated boilerplate, and what I've noticed (from other engineers but also myself)
is that the boilerplate for new pagination containers gets copy-and-pasted from existing ones. We will see how this
leads to small problems getting propagated throughout the codebase, and leads to engineers not feeling confident
when working in pagination containers.</p>

<p>So let's modify the Relay container above to fetch a list of the artist's artworks. This is a very simple example,
only used to illustrate how to use pagination containers.</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">class</span> <span class="nx">Artist</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">artist</span> <span class="nx">name</span> <span class="nx">is</span> <span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">artist</span><span class="p">.</span><span class="nx">name</span><span class="p">}.</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class='line'>    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">artist</span><span class="p">.</span><span class="nx">artworks</span><span class="p">.</span><span class="nx">edges</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">node</span> <span class="o">=&gt;</span>
</span><span class='line'>      <span class="cm">/* Render each artwork */</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class='line'>    <span class="p">)}</span>
</span><span class='line'>    <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">relay</span><span class="p">.</span><span class="nx">hasMore</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">onPress</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">relay</span><span class="p">.</span><span class="nx">loadMore</span><span class="p">()</span> <span class="p">}</span> <span class="nx">text</span><span class="o">=</span><span class="s2">&quot;Load next page&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="nx">ArtistFragmentContainer</span> <span class="o">=</span> <span class="nx">createPaginationContainer</span><span class="p">(</span><span class="nx">Artist</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">artist</span><span class="o">:</span> <span class="nx">graphql</span><span class="err">`</span>
</span><span class='line'>    <span class="nx">fragment</span> <span class="nx">Artist_artist</span> <span class="nx">on</span> <span class="nx">Artist</span>
</span><span class='line'>      <span class="err">@</span><span class="nx">argumentDefinitions</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">count</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;Int&quot;</span><span class="p">,</span> <span class="nx">defaultValue</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span>
</span><span class='line'>        <span class="nx">cursor</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;String&quot;</span> <span class="p">}</span>
</span><span class='line'>      <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">name</span>
</span><span class='line'>      <span class="nx">id</span>
</span><span class='line'>      <span class="nx">artworksConnection</span><span class="p">(</span><span class="nx">first</span><span class="o">:</span> <span class="nx">$count</span><span class="p">,</span> <span class="nx">after</span><span class="o">:</span> <span class="nx">$cursor</span><span class="p">)</span> <span class="err">@</span><span class="nx">connection</span><span class="p">(</span><span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;Artist_artworks&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">edges</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">node</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">title</span> <span class="err">#</span> <span class="nx">Now</span> <span class="nx">fetch</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">artwork</span> <span class="nx">data</span>
</span><span class='line'>            <span class="nx">id</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">`</span>
</span><span class='line'><span class="p">},</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">direction</span><span class="o">:</span> <span class="s2">&quot;forward&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">getConnectionFromProps</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">props</span><span class="p">.</span><span class="nx">artist</span><span class="p">.</span><span class="nx">artworks</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">getFragmentVariables</span><span class="p">(</span><span class="nx">prevVars</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">...</span><span class="nx">prevVars</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">count</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">getVariables</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="p">{</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">cursor</span> <span class="p">},</span> <span class="nx">fragmentVariables</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">id</span><span class="o">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">artist</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">count</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">cursor</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">query</span><span class="o">:</span> <span class="nx">graphql</span><span class="err">`</span> <span class="err">#</span> <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">query</span> <span class="nx">to</span> <span class="nx">fetch</span> <span class="nx">any</span> <span class="nx">specific</span> <span class="nx">page</span>
</span><span class='line'>    <span class="nx">query</span> <span class="nx">ArtistArtworksQuery</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">$id</span><span class="o">:</span> <span class="nx">ID</span><span class="o">!</span>
</span><span class='line'>      <span class="nx">$count</span><span class="o">:</span> <span class="nx">Int</span><span class="o">!</span>
</span><span class='line'>      <span class="nx">$cursor</span><span class="o">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">artist</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">...</span><span class="nx">Artist_artist</span> <span class="err">@</span><span class="nx">arguments</span><span class="p">(</span>
</span><span class='line'>          <span class="nx">count</span><span class="o">:</span> <span class="nx">$count</span>
</span><span class='line'>          <span class="nx">cursor</span><span class="o">:</span> <span class="nx">$cursor</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">`</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Wow, that's a lot! I don't want to get too bogged down in details, so let's break this apart at a high level:</p>

<ul>
<li>We changed the React component to show a list of artworks and include a button to load the next page.</li>
<li>We changed from <code>createFragmentContainer</code> to using <code>createPaginationContainer</code>.</li>
<li>We added GraphQL fragment variables for <code>count</code> and <code>cursor</code> to be passed through to the new
<code>artworksConnection</code>, which we also added.</li>
<li>Finally, we added a whole new configuration parameter to <code>createPaginationContainer</code>.</li>
</ul>


<p>This last bit is the part where I see the most frustration. Hopefully what follows will clear things up.</p>

<p>I like to always start by <a href="https://relay.dev/docs/en/pagination-container">reading the docs</a>. The <code>direction</code> key
is the direction that we paginate through, either <code>"forward"</code> or <code>"backward"</code>. <code>getConnectionFromProps</code> is a
function that returns the GraphQL connection, in case the query has more than one. And <code>query</code> is used to fetch any
specific page of results.</p>

<p>Those all makes sense to me, but then we arrive at the real gotchas: <code>getFragmentVariables</code> and <code>getVariables</code>. The
docs are helpful, but only if you understand
<a href="https://relay.dev/docs/en/runtime-architecture.html">the internals of how Relay works</a>. Relay has a sophisticated
architecture that delivers some really well-performing code, but its abstractions sometimes
"<a href="https://en.wikipedia.org/wiki/Leaky_abstraction">leak</a>" and you have to deal with underlying implementation
details of Relay (like <a href="https://relay.dev/docs/en/relay-store">the Relay store</a>) which you don't need to know about
<em>most</em> of the time.</p>

<p>So what are these two functions? Let's return to the docs:</p>

<ul>
<li><code>getFragmentVariables</code> is used when re-rendering the component, to retrieve the previously-fetched GraphQL
response for a certain set of variables.</li>
<li><code>getVariables</code> is used when actually fetching another page, and its return value is given to the <code>query</code>.</li>
</ul>


<p>I think of <code>getFragmentVariables</code> as a kind of caches key for lookup in Relay's internal store. Our implementation
of <code>getFragmentVariables</code> above doesn't really do anything interesting, but a connection that accepted <code>sort</code> or
<code>filter</code> parameters would need to return those to avoid lookup collisions when the user changed sort and filter
options.</p>

<p>Now for <code>getVariables</code>, which are the variables used for the <code>query</code> later on. It really ought to be named
<code>getQueryVariables</code>, I think. But I digress.</p>

<p>Every implementation of <code>getFragmentVariables</code> I could find at Artsy was identical, which makes sense because <em>that
is the default implementation</em>. We shouldn't be defining this option at all! As far as I can tell, Artsy started
with a few pagination containers that supplied this parameter unnecessarily and it got copy-and-pasted throughout
our codebases.</p>

<p>After revisiting the docs, I noticed other optional parameters that don't need to be defined either. Let's rewrite
the call to <code>createPaginationContainer</code> to only supply the parameters that are required:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">export</span> <span class="nx">ArtistFragmentContainer</span> <span class="o">=</span> <span class="nx">createPaginationContainer</span><span class="p">(</span><span class="nx">Artist</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">artist</span><span class="o">:</span> <span class="nx">graphql</span><span class="err">`</span>
</span><span class='line'>    <span class="nx">fragment</span> <span class="nx">Artist_artist</span> <span class="nx">on</span> <span class="nx">Artist</span> <span class="err">@</span><span class="nx">argumentDefinitions</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">count</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;Int&quot;</span><span class="p">,</span> <span class="nx">defaultValue</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span>
</span><span class='line'>      <span class="nx">cursor</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;String&quot;</span> <span class="p">}</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">name</span>
</span><span class='line'>      <span class="nx">id</span>
</span><span class='line'>      <span class="nx">artworksConnection</span> <span class="p">(</span><span class="nx">first</span><span class="o">:</span> <span class="nx">$count</span><span class="p">,</span> <span class="nx">after</span><span class="o">:</span> <span class="nx">$cursor</span><span class="p">)</span> <span class="err">@</span><span class="nx">connection</span><span class="p">(</span><span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;Artist_artworks&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">edges</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">node</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">title</span> <span class="err">#</span> <span class="nx">Now</span> <span class="nx">fetch</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">artwork</span> <span class="nx">data</span>
</span><span class='line'>            <span class="nx">id</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">`</span>
</span><span class='line'>  <span class="p">},</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">getVariables</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="p">{</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">cursor</span> <span class="p">},</span> <span class="nx">fragmentVariables</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">id</span><span class="o">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">artist</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">count</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">cursor</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">query</span><span class="o">:</span> <span class="nx">graphql</span><span class="err">`</span> <span class="err">#</span> <span class="nx">Here</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">query</span> <span class="nx">to</span> <span class="nx">fetch</span> <span class="nx">any</span> <span class="nx">specific</span> <span class="nx">page</span>
</span><span class='line'>    <span class="nx">query</span> <span class="nx">ArtistArtworksQuery</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">$id</span><span class="o">:</span> <span class="nx">ID</span><span class="o">!</span>
</span><span class='line'>      <span class="nx">$count</span><span class="o">:</span> <span class="nx">Int</span><span class="o">!</span>
</span><span class='line'>      <span class="nx">$cursor</span><span class="o">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">artist</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">$id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">...</span><span class="nx">Artist_artist</span> <span class="err">@</span><span class="nx">arguments</span><span class="p">(</span>
</span><span class='line'>          <span class="nx">count</span><span class="o">:</span> <span class="nx">$count</span>
</span><span class='line'>          <span class="nx">cursor</span><span class="o">:</span> <span class="nx">$cursor</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">`</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>This is a lot nicer! By not specifying unnecessary options, we have a smaller surface area to make mistakes in. We
also have fewer overloaded terms, like "variables", so now it's more obvious that <code>getVariables</code> supplies data for
the <code>query</code> below it.</p>

<p>I've already <a href="https://github.com/artsy/eigen/pull/3711">sent a pull request</a> to clean up our use of pagination
containers in our React Native app, and will be following up on the web side next. But I wouldn't have discovered
this if I hadn't really dug into the docs, which I only did so that I could write this blog post. Earlier I said
that the solution to a knowledge gap is simple: learn, and then teach. I learned a lot about Relay today, and I
hope this blog post illustrates the value in the learn-then-teach approach.</p>

    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/08/21/review-apps-post/">
        
        
          <h2 class="entry-title">Servers for Everyone: Review Apps @ Artsy</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/daniel">Daniel Levenson<a/></span>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>This blog post is going to motivate and describe Artsy's adoption and evolution
of the usage of review apps.</p>

<p>This first part of this post covers a couple of common problems where
topic-specific servers (i.e. review apps) are useful.</p>

<p>The rest of the post describes Artsy's history with review app automation via
incremental problem solving and the composition of a few well-known technologies.</p>


        <p><a href="/blog/2020/08/21/review-apps-post/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/08/11/improve-pull-requests-by-including-valuable-context/">
        
        
          <h2 class="entry-title">Improve Pull Requests By Including Valuable Context</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/steve-hicks">Steve Hicks<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/pepopowitz">@pepopowitz</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>Code review is an engineering process that has benefited greatly from a move toward asynchronous communication.
Long ago, engineering teams would sit in a room with code on a projector to review changes together. ðŸ˜± For many
teams this led to batching code reviews or even skipping them altogether. ðŸ˜±ðŸ˜±</p>

<p>Today, most engineering teams use incredible tools like GitHub or GitLab to review changes through Pull Requests
(PRs). The greatest advantage of PRs is that the review can happen when it's convenient for the reviewer:
asynchronously. Asynchronous communication isn't all sunshine and unicorns, though. Notably, it lacks the ability
to course-correct when context is misunderstood.</p>


        <p><a href="/blog/2020/08/11/improve-pull-requests-by-including-valuable-context/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/07/23/from-engineering-to-product-management-and-back-again/">
        
        
          <h2 class="entry-title">From engineering to product management, and back again</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/will">Will Doenlen<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/willdoenlen">@willdoenlen</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>A year and a half ago I decided to become a product manager after 5 years as a software engineer. This past June,
however, I decided to switch back into engineering.</p>

<p>What happened, and what did I learn?</p>


        <p><a href="/blog/2020/07/23/from-engineering-to-product-management-and-back-again/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/04/01/team-working-agreements/">
        
        
          <h2 class="entry-title">Team Working Agreements</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/steve-hicks">Steve Hicks<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/pepopowitz">@pepopowitz</a>
      </p>
      

    </div>
  

  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/adam">Adam Iskounen<a/></span>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>Good team culture strives for cohesion. Once organizations get large enough, a tension emerges between the culture
of individual teams and the culture of the larger organization. How do you achieve team cohesion across small teams
<em>and</em> the larger organizations they comprise?</p>

<p>The culture at Artsy is driven by every team member, not mandated or handed down from above. This adds another
level of tension, between individuals and their smaller teams. Team working agreements embrace that tension to
provide a framework for converting tension into healthy culture.</p>


        <p><a href="/blog/2020/04/01/team-working-agreements/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/03/02/ios-deploys-super-weird-totally-normal/">
        
        
          <h2 class="entry-title">iOS Deploys: Super Weird And Totally Normal</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/ash">Ash Furrow<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/ashfurrow">@ashfurrow</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>Software deploys! What a concept. You have some code running somewhere, and you need to get it running somewhere
else. What could possibly go wrong? While web developers have become accustom to some <em>really slick</em> deploy
processes, iOS developers have to work within some very different constraints.</p>

<p>Today I want to explore the differences between deploying iOS software and front-end/back-end web software. Some of
these differences are inherent to how the code gets executed, and some of the differences are incidental to choices
that Apple has made. These are constraints that iOS developers need to work within. As Artsy has adopted React
Native over the past four years, we have had more and more of our web engineering colleagues contributing to our
iOS app. For these web engineers, getting familiar with the iOS deploy constraints is as important as getting to
know Xcode and CocoaPods.</p>


        <p><a href="/blog/2020/03/02/ios-deploys-super-weird-totally-normal/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/02/20/deploying-canaries-with-auto/">
        
        
          <h2 class="entry-title">Deploying canaries with auto</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/justin">Justin Bennett<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/zephraph">@zephraph</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>Coordinating changes across many packages in the node ecosystem can be quite the challenge. You can use <code>npm link</code>
or <code>yarn link</code> to create a symlink of the package you're developing on into another package, but it
<a href="https://github.com/yarnpkg/yarn/issues/1761#issuecomment-259706202">has some drawbacks</a>. If you're doing local
development and need to rapidly see updates and <code>yarn link</code> isn't working out there's always tools like
<a href="https://github.com/whitecolor/yalc#yalc">yalc</a> to help you out. That's really only for local development though.</p>

<p>What if you need to test packages together in a staging environment? Generally the approach would to be to deploy a
<a href="https://martinfowler.com/bliki/CanaryRelease.html">canary</a> version to npm that you can use in your staging
environment. I'll go over how to do that and how Artsy automates it.</p>


        <p><a href="/blog/2020/02/20/deploying-canaries-with-auto/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/01/21/graphql-relay-windowed-pagination/">
        
        
          <h2 class="entry-title">Effortless Pagination with GraphQL and Relay? Really!</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/matt">Matt Zikherman<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/mzikherman">@mzikherman</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>It's the year 2020. You use a modern front-end stack of <a href="https://relay.dev/">Relay</a>,
<a href="https://graphql.org/">GraphQL</a>, <a href="https://reactjs.org/">React</a> and <a href="https://www.typescriptlang.org/">TypeScript</a>.
You can build an infinite scroll 'feed' type UI totally out of the box with these tools, by mostly putting together
boilerplate (proper <a href="https://facebook.github.io/relay/graphql/connections.htm#sec-Connection-Types">connections</a>,
along with a <a href="https://relay.dev/docs/en/pagination-container">pagination container</a>). You have a design system, and
are rapidly building up a component library. Things are great!</p>

<p>Then you take a look at the latest design comps for a 'browse' type page, and you see that the
<a href="https://medium.com/simple-human/7-reasons-why-infinite-scrolling-is-probably-a-bad-idea-a0139e13c96b">controversial</a>
infinite scroll has been replaced by a more traditional pagination bar.</p>

<p>You know the one. Like the following, from <a href="https://www.amazon.com">Amazon</a>:</p>

<p><img src="/images/2020-01-21-graphql-relay-windowed-pagination/amazon.png"></p>

<p>You start to realize that the cursor-based setup of a connection, along with a Relay pagination container, does not
lend itself to this more traditional UI. For one thing, a user can arbitrarily 'jump' to any page by including a
<code>?page=X</code> query param (typically). For another, the user can only actually see the current page of content, versus
a feed. As you go to sleep and dream of REST, Rails controllers, <a href="https://github.com/kaminari/kaminari">kaminari</a>,
<a href="https://github.com/mislav/will_paginate">will_paginate</a>, and a simpler time, you start to have a vision...</p>


        <p><a href="/blog/2020/01/21/graphql-relay-windowed-pagination/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/01/15/ios-logout-button-at-last/">
        
        
          <h2 class="entry-title">At Long Last: A Log Out Button</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/ash">Ash Furrow<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/ashfurrow">@ashfurrow</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>In 2013, Artsy shipped the first version of our iOS app. Typical for an early-day startup, the app was a "minimum
viable product" (with a big emphasis on "minimum"). One of the features that didn't make the cut was something you
expect to see in most apps: a log out button.</p>

<p>When I joined Artsy a year later, there was still no log out button. And there would be no log out button for
another six years, until today.</p>

<p>I want to talk about this quirk of our app, from both product and technical perspectives. Why wasn't this already
in our app? Why was it so difficult to build? These are interesting questions, and their answers shed light on how
products mature over time. I also want to talk about how we finally managed to prioritize this kinda weird feature
request (spoilers: it was our company-wide hackathon). Let's go!</p>


        <p><a href="/blog/2020/01/15/ios-logout-button-at-last/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2020/01/13/graphql-custom-directives/">
        
        
          <h2 class="entry-title">Better GraphQL Error Handling I - Using Custom Directives</h2>
        
        <time datetime=""></time>
          <p class="meta-author">
  



  

  
    <div class="meta">
      <span class="byline author vcard"><a href ="/author/matt">Matt Zikherman<a/></span>
      
      <p class="fn">
        <a href="https://twitter.com/mzikherman">@mzikherman</a>
      </p>
      

    </div>
  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>This will be the first in a series of posts about how we used advanced GraphQL tooling and functionality to better
handle errors occurring during query resolution, and better equip clients to reason about such errors.</p>

<p>The goal is to describe our current approach, but also do a deep dive into specific ways we've extended our
<a href="https://github.com/artsy/metaphysics">GraphQL server</a> to help us accomplish that. If you are an interested GraphQL
user, you may find this useful, even if some of the larger context specifically around how we are using it to help
standardize error handling doesn't apply.</p>


        <p><a href="/blog/2020/01/13/graphql-custom-directives/">Read on â†’</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  

  <div class="pagination">
    <a href="/blog/archives">Blog Archives</a>
    <a href="/blog/categories">Categories</a>

    
    <span class="page_number ">Page: 1 of 26</span>

    
      <a href="/blog/2/" class="next">Older</a>
    
  </div>
</div>


    </div>
  </div>
  <footer id="main_footer"> <div class="footer-navigation">
  <ul>
    <li><a href="https://developers.artsy.net/">API</a></li>
    <li><a href="https://www.artsy.net/jobs">Careers</a></li>
    <li><a href="http://twitter.com/artsyopensource">@artsyopensource</a></li>
    <li><a href="http://www.artsy.net/">Artsy.net</a></li>
  </ul>
</div>



<script type="text/javascript">
      var disqus_shortname = 'artsy';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


</footer>
  <script type="text/javascript">
  $(function() {
    // TODO: Move this whole file to a javascript file that is included in the footer

    // Main sticky header
    if ($(window).width() >= 700) {
      var sticky = new Waypoint.Sticky({
        element: $("#banner"),
        offset: -100
      });
    }

    // Toggle hamburger menu
    $('.header-hamburger').click(function() {
      $('#banner, .cmn-toggle-switch').toggleClass('active');
      if (location.pathname == '/open-source') {
        $('.header-search span').hide();
        $('#page-sidebar').toggle();
      }
    });

    // Toggle search focus on mobile
    $('input.search').focus(function() {
      $('#header').addClass('search-focused');
    }).blur(function() {
      $('#header').removeClass('search-focused');
    });
  });
</script>

</body>
</html>
