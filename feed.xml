<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Artsy Engineering</title>
    <description></description>
    <link>http://artsy.github.io/</link>
    <atom:link href="http://artsy.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 04 Jul 2016 17:21:53 +0000</pubDate>
    <lastBuildDate>Mon, 04 Jul 2016 17:21:53 +0000</lastBuildDate>
    <generator>Jekyll v2.5.3</generator>
    
      <item>
        <title>Handling Large OSS Projects Defensively</title>
        <description>&lt;p&gt;I help maintain big OSS projects: ranging from a third-party &lt;a href=&quot;https://cocoapods.org&quot;&gt;dependency manager&lt;/a&gt; used in most iOS apps (&lt;a href=&quot;https://github.com/CocoaPods/cocoapods.org&quot;&gt;CocoaPods&lt;/a&gt;), to the most popular Objective-C &lt;a href=&quot;http://cocoapods.org/pods/Specta&quot;&gt;testing framework&lt;/a&gt; and the most popular Swift &lt;a href=&quot;http://cocoapods.org/pods/Moya&quot;&gt;networking API client&lt;/a&gt;. I&#39;ve been doing this for years.&lt;/p&gt;

&lt;p&gt;Projects with this much impact are big time-sinks. Ranging from ensuring infrastructure continues to work, support tickets need replies, new code needs reviewing and releases need coordinating.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-07-03-big-oss/danger_logo_black@2x.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Last September, almost a year ago, I started work on a new project, &lt;a href=&quot;https://github.com/danger/danger/&quot;&gt;Danger&lt;/a&gt;. Danger fixes a problem we were seeing as the Artsy mobile team around adding &quot;&lt;a href=&quot;https://github.com/artsy/mobile/issues/31&quot;&gt;process&lt;/a&gt;&quot; to our team.&lt;/p&gt;

&lt;p&gt;As a part of discussing Danger internally, I&#39;ve referenced that building CocoaPods has greatly influenced Danger. This blog post is about the way I&#39;ve built Danger, knowing fully well that I cannot afford the level of time to maintain it at the scale it can become.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;hr /&gt;

&lt;p&gt;Danger is a project that could end up with a lot more users than CocoaPods. So I want to be cautious about how I create the community around Danger. If you&#39;re interested in some of the baseline setup required to run a popular project, the post &quot;&lt;a href=&quot;https://ashfurrow.com/blog/building-popular-projects/&quot;&gt;Building Popular Projects&lt;/a&gt;&quot; by &lt;a href=&quot;/author/ash&quot;&gt;Ash&lt;/a&gt; is a great place to start, this builds on that.&lt;/p&gt;

&lt;p&gt;My maintenance time on CocoaPods resolves around:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Handling new issues&lt;/li&gt;
&lt;li&gt;Keeping infrastructure running&lt;/li&gt;
&lt;li&gt;Requests around user data&lt;/li&gt;
&lt;li&gt;Keeping disparate communities together&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Issues&lt;/h2&gt;

&lt;p&gt;From the ground up, Danger could not end up as complex as CocoaPods, the domain they cover is different and CocoaPods sits atop of an annually moving (and &lt;em&gt;somewhat&lt;/em&gt; hostile) &lt;a href=&quot;https://developer.apple.com/news/&quot;&gt;platform&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, get enough people using a product and you end up with three types of issues: Bug Reports, How Do I X? and Feature Requests.&lt;/p&gt;

&lt;p&gt;I wanted to keep bug-reports down, as much as possible, and so I built a system wherein the default error reporting system would also search GitHub issues &lt;a href=&quot;https://github.com/orta/gh_inspector&quot;&gt;for similar problems&lt;/a&gt;. Knowing this was a generic problem, I built it with running in &lt;a href=&quot;https://github.com/fastlane/fastlane/releases/tag/1.96.0&quot;&gt;other&lt;/a&gt; &lt;a href=&quot;https://github.com/CocoaPods/CocoaPods/pull/5421&quot;&gt;large&lt;/a&gt; ruby projects in mind too.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;How do I X?&lt;/code&gt; are issues that haven&#39;t appeared much on Danger. For CocoaPods we request people use the CocoaPods tag on StackOverflow. That saves us from 5 to 6 issues a day, and provides others a great place to get internet points by responding instead.&lt;/p&gt;

&lt;p&gt;Feature Requests issues are always fascinating, it gives you a chance to really see the difference between what you imagined a project&#39;s scope is, and how others perceive it. One thing that helps here, is that Danger has a &lt;a href=&quot;https://github.com/danger/danger/blob/master/VISION.md&quot;&gt;VISION.md&lt;/a&gt; file. This helped vocalise a lot of internal discussion, and let contributors understand the roadmap:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The core concept is that the Danger project itself creates a system that is extremely easy to build upon. The codebase for Danger should resolve specifically around systems for CI, communication with Peer Review tools and providing APIs to Source Control changes. For example: Travis CI - GitHub - git.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As well as providing a heuristic for determining whether something should be added to Danger:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This means that decisions on new code integrated into Danger should ask &quot;is this valid for every CI provider, every review system and source control type?&quot; by making this domain so big, we can keep the core of Danger small.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h3&gt;Infrastructure&lt;/h3&gt;

&lt;p&gt;CocoaPods has about 6 web properties, 3 of which are critical. The others can go down, or be behind the Xcode update schedules and people&#39;s projects will work fine. The 3 the critical projects are all simple, focused projects that only do one thing: &lt;a href=&quot;https://github.com/CocoaPods/trunk.cocoapods.org&quot;&gt;trunk&lt;/a&gt; (provide auth, and submitting new libraries) &lt;a href=&quot;https://github.com/CocoaPods/cocoapods.org&quot;&gt;cocoapods.org&lt;/a&gt;, and &lt;a href=&quot;https://github.com/CocoaPods/search.cocoapods.org&quot;&gt;search&lt;/a&gt;. We control everything there.&lt;/p&gt;

&lt;p&gt;Meanwhile the less critical ones like &lt;a href=&quot;https://github.com/CocoaPods/cocoadocs.org&quot;&gt;cocoadocs.org&lt;/a&gt; have dependencies all over the show: AppleDoc, CLOC, Xcode, Carthage, Jazzy - every one of these can, and has, been a source of unreliability for infrastructure that I maintain.&lt;/p&gt;

&lt;p&gt;With Danger, I wanted to avoid building any infrastructure that does not sit on top of solid, mature projects. The website is statically created in &lt;a href=&quot;https://middlemanapp.com&quot;&gt;Middleman&lt;/a&gt;, using &lt;a href=&quot;https://rubygems.org/gems/slim&quot;&gt;boring&lt;/a&gt; &lt;a href=&quot;https://rubygems.org/gems/sass&quot;&gt;old&lt;/a&gt; technology, this means no server to host.&lt;/p&gt;

&lt;p&gt;To support dynamic content on the website, I have a rake command to use &lt;a href=&quot;https://rubygems.org/gems/yard/versions&quot;&gt;a decade old&lt;/a&gt; documentation formatter to pull content from a &lt;a href=&quot;https://en.wikipedia.org/wiki/RubyGems&quot;&gt;13 year old&lt;/a&gt; dependency manager - that lets others describer their project&#39;s. In order to let them keep it up to date, I have a tiny 35 line web-server that allows specific projects to trigger a new CI build.&lt;/p&gt;

&lt;h3&gt;Plugins&lt;/h3&gt;

&lt;center&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en-gb&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Summary of every big OSS project. Monolith -&amp;gt; Plugin support.&lt;a href=&quot;https://t.co/7x4vuW4bRd&quot;&gt;https://t.co/7x4vuW4bRd&lt;/a&gt;&lt;/p&gt;&amp;mdash; Orta Therox (@orta) &lt;a href=&quot;https://twitter.com/orta/status/748561323164864512&quot;&gt;30 June 2016&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;/center&gt;


&lt;p&gt;&lt;br/&gt;&lt;/p&gt;

&lt;p&gt;It&#39;s almost inevitable that once a project becomes big, maintainers have to become a lot more conservative about how they introduce new code. You become good at saying &#39;no&#39;, but that a lot of people have legitimate needs. So, instead end up building your tool into a platform.&lt;/p&gt;

&lt;p&gt;Some of the most interesting ideas in the CocoaPods ecosystem comes from plugins.&lt;/p&gt;

&lt;p&gt;I wanted plugins to be a first class citizen within Danger from day one. It&#39;s in the &lt;a href=&quot;https://github.com/danger/danger/blob/master/VISION.md&quot;&gt;VISION&lt;/a&gt; file, and it&#39;s applied into how I&#39;ve designed a lot of the user-facing site. I was &lt;a href=&quot;https://github.com/danger/danger/issues/74&quot;&gt;torn&lt;/a&gt; after a few months of development &lt;a href=&quot;https://github.com/danger/danger/pull/156#issuecomment-205907128&quot;&gt;where things&lt;/a&gt; should go. Now the core of Danger is &lt;a href=&quot;https://github.com/danger/danger/pull/227&quot;&gt;built as plugins&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Documentation&lt;/h3&gt;

&lt;p&gt;My second big project on CocoaPods was collating documentation and scoping different types of documentation. In CocoaPods I ended with:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Highlight pages&lt;/strong&gt; (intro pages, app pages, team pages)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Guides&lt;/strong&gt; (tutorials, overviews, FAQs)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Reference&lt;/strong&gt; (Command-line interface, APIs for developers)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;These 3 buckets for documentation makes it pretty easy to separate where people should look depending on what they&#39;re looking for. This pattern I&#39;m stealing outright for Danger. Just not quite there yet, it&#39;s a blocker on 1.0 though.&lt;/p&gt;

&lt;p&gt;One trick I took from CocoaPods is to have as much documentation as possible generated from the source code. With Danger, all of the work gone into documenting the code is turned into public API documentation for end-users. This makes it really easy to ensure it&#39;s consistent and up-to-date. The same tools used to generate documentation for Danger are used for plugins. Any improvements there helps everyone.&lt;/p&gt;

&lt;h2&gt;User Data&lt;/h2&gt;

&lt;p&gt;Not storing any, phew! Though if &lt;a href=&quot;https://github.com/danger/danger/issues/42&quot;&gt;Danger as a Service&lt;/a&gt; happens, then it will.&lt;/p&gt;

&lt;h2&gt;People&lt;/h2&gt;

&lt;p&gt;People are hard, Ash said in &lt;a href=&quot;https://ashfurrow.com/blog/building-popular-projects/&quot;&gt;Building Popular Projects&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The biggest existential threat to your library is this: you get burned out and stop working on it – and no one else contributes to it –&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Understanding motivations, encouraging ownership and accommodating multiple viewpoints are vital parts of anyone who wants to make a project bigger than themselves. There &lt;a href=&quot;https://github.com/danger/danger/graphs/contributors&quot;&gt;are lots of times&lt;/a&gt; when I&#39;m not the lead developer on Danger.&lt;/p&gt;

&lt;p&gt;I owe a lot of this to the policy Ash and I created with Moya, the wordy &quot;&lt;a href=&quot;https://github.com/Moya/contributors&quot;&gt;Moya Community Continuity Guidelines&lt;/a&gt;&quot; which define the expectations of the maintainers of a project towards contributors.&lt;/p&gt;

&lt;p&gt;It&#39;s helped let a lot of other contributors make an impact. In the future, I hope those are the people that I get to hand Danger off to. Danger is bigger than me.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Maintaining big projects is a learned activity, for most people it&#39;s a spectator sport, but it&#39;s not too hard to jump from writing issues to helping out. It&#39;s how I ended up contributing to CocoaPods.&lt;/p&gt;
</description>
        <pubDate>Sun, 03 Jul 2016 12:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/07/03/handling-big-projects/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/07/03/handling-big-projects/</guid>
        
        
        <category>culture</category>
        
        <category>mobile</category>
        
        <category>oss</category>
        
      </item>
    
      <item>
        <title>Code Spelunking: Injection for Xcode Plugin</title>
        <description>&lt;p&gt;It was only three months ago that I came to the conclusion of just how much time I had wasted &lt;a href=&quot;http://artsy.github.io/blog/2016/03/05/iOS-Code-Injection/&quot;&gt;on code compilation cycles&lt;/a&gt;, once I started to play with &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode&quot;&gt;Injection for Xcode&lt;/a&gt;. I still feel guilt about the time I wasted. However, I&#39;m trying to turn that into something constructive. In order to do that, I need to have a solid understanding of the fundamentals on how Injection For Xcode works.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ashfurrow.com/&quot;&gt;Ash&lt;/a&gt; says one of the best ways to &lt;a href=&quot;https://ashfurrow.com/blog/teaching-learning/&quot;&gt;learn is to teach&lt;/a&gt;. So I&#39;m going to try take you through a guided tour of the code-base. You need some pretty reasonable Objective-C chops to get this, but anyone with an app or two under their belt should be able to &lt;a href=&quot;https://en.wikipedia.org/wiki/Grok&quot;&gt;grok&lt;/a&gt; it.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;&lt;img src=&quot;/images/2016-06-29-injection-overview/overview.png&quot; alt=&quot;Xcode Project Overview&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You might find it easier to clone the repo and have Xcode open along-side this article, to quickly do that, run these commands to put it in a temporary folder via the terminal:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;sh&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /tmp/
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;git clone https://github.com/johnno1962/injectionforxcode TempInjection
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;open TempInjection/InjectionPluginLite/InjectionPlugin.xcodeproj/
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;h2&gt;A note on code style&lt;/h2&gt;

&lt;p&gt;I am of the _why &lt;a href=&quot;https://www.smashingmagazine.com/2010/05/why-a-tale-of-a-post-modern-genius/#dont-be-afraid-to-take-risks&quot;&gt;camp of programming&lt;/a&gt; - the code we are spelunking through can feel foreign to modern Objective-C, and it&#39;s not got tests. &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; described it to me as being like 1997&#39;s Objective-C. The end result of all this code &lt;em&gt;is&lt;/em&gt; beautiful, whether the code is - is a matter of perspective. I&#39;m super happy it exists.&lt;/p&gt;

&lt;h2&gt;Targets&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;InjectionPlugin - The user facing Xcode plugin&lt;/li&gt;
&lt;li&gt;InjectionLoader - A Bundle used to skip patching a project for injection.&lt;/li&gt;
&lt;li&gt;iOSBundleTemplate - A folder to a reference implementation of a iOS Project&lt;/li&gt;
&lt;li&gt;OSXBundleTemplate - Same but for OSX Project&lt;/li&gt;
&lt;li&gt;unhide - A command line tool that extracts symbols from a Swift Framework&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Implementation Order&lt;/h2&gt;

&lt;p&gt;I want to go through the code-base from the perspective what happens when it:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Loads up inside Xcode.&lt;/li&gt;
&lt;li&gt;Recieves a call to inject.&lt;/li&gt;
&lt;/ul&gt;


&lt;h3&gt;Launch&lt;/h3&gt;

&lt;p&gt;All Xcode plugins have the exact same launch process, you &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Info.plist#L21-L22&quot;&gt;define a class&lt;/a&gt; in the info.plist, this class, &lt;code&gt;INPluginMenuController&lt;/code&gt;, gets &lt;code&gt;+ pluginDidLoad:&lt;/code&gt; called. This is where you &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L83-L94&quot;&gt;set up a shared instance&lt;/a&gt;, and can keep a reference to your bundle.&lt;/p&gt;

&lt;p&gt;This triggers the interesting stuff in &lt;code&gt;applicationDidFinishLaunching:&lt;/code&gt; this sets up the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L131-L137&quot;&gt;user interface from a nib file&lt;/a&gt;, which &lt;a href=&quot;http://artsy.github.io/blog/2016/06/27/dependency-injection-in-swift/&quot;&gt;DIs&lt;/a&gt; in a lot of the instance variables, and will send you to get a new version of Injection if it fails. It then sets up the menu ( note: &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L151-L154&quot;&gt;interesting use of c-structs here&lt;/a&gt; ) and starts a TCP server, then registers for when a &lt;code&gt;NSWindow&lt;/code&gt; becomes active.&lt;/p&gt;

&lt;h4&gt;Server&lt;/h4&gt;

&lt;p&gt;The server is a &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L512-L535&quot;&gt;c TCP socket&lt;/a&gt;, prior to digging in here, I&#39;d never needed to see one. I see a lot of references to Android injection, so I assume the low-level choice in a socket  was so the same code can do both platforms.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;c&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;startServer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr_in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_family&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INADDR_ANY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;htons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;INJECTION_PORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;optval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverSocket&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Could not open service socket: %s&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strerror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[...]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// skipping a bunch of error handling&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Service socket would not listen: %s&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strerror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;performSelectorInBackground&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundConnectionService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;withObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Assuming everything went well, then a &lt;a href=&quot;https://en.wikipedia.org/wiki/Bonjour_%28software%29&quot;&gt;Bonjour&lt;/a&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L539-L542&quot;&gt;service&lt;/a&gt; is created advertising the socket on the network. This then moves to a background thread and starts a infinite runloop checking for new connections on the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L545-L557&quot;&gt;socket every 0.5 seconds&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here is it &lt;a href=&quot;/images/2016-06-29-injection-overview/selected_bonjour.png&quot;&gt;running&lt;/a&gt; in &lt;a href=&quot;http://tildesoft.com&quot;&gt;Bonjour Browser&lt;/a&gt;. So, what does this server do? That&#39;s handled inside &lt;code&gt;INPluginClientController&lt;/code&gt;. It uses a MAC address so that you can have multiple non-competing services running on the same network.&lt;/p&gt;

&lt;p&gt;At its simplest, the server exists to send messages between running multiple applications and the injection plugin. We&#39;ll get back to what the server does later.&lt;/p&gt;

&lt;h4&gt;Inside Xcode&lt;/h4&gt;

&lt;p&gt;The plugin will keep track of the key editor window, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L214-L220&quot;&gt;this is done&lt;/a&gt; by making sure the window&#39;s controller is of the class &lt;code&gt;IDEWorkspaceWindowController&lt;/code&gt; and that it has a corresponding file.&lt;/p&gt;

&lt;p&gt;That&#39;s basically everything set up for the plugin now, until a user decides to start using Injection. So we&#39;re going to move to what happens when you press &lt;code&gt;ctrl + =&lt;/code&gt;.&lt;/p&gt;

&lt;h4&gt;On Preparing for Injection&lt;/h4&gt;

&lt;p&gt;The work starts at &lt;code&gt;injectSource&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L359&quot;&gt;from INPluginMenuController&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The first thing it does is grab the current file, then saves it. It then checks what type of file it is, as only &lt;code&gt;.m, .mm, .swift or .storyboard&lt;/code&gt; can be injected.&lt;/p&gt;

&lt;p&gt;Next, it pulls out a reference to the currently running LLDB session, the console in the bottom of Xcode. It checks if the server has any active clients.&lt;/p&gt;

&lt;p&gt;OK, to understand the next bit you need to understand what &lt;em&gt;&quot;unpatched injection&quot;&lt;/em&gt; is. In order to support code injection, your app has to have some way to communicate back to the TCP server hosted in Xcode. This can be done either by &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/documentation/patching_injection.md&quot;&gt;including some source code&lt;/a&gt; in your project, or by adding it in at runtime. Including the source code, is &quot;patching&quot; your project to allow injection. It&#39;s optional because of what comes next.&lt;/p&gt;

&lt;p&gt;If there are no clients connected, then requests a pause from LLDB, allowing the plugin to send messages to the running app, it then waits a few microseconds to give the debugger chance to load. Once it&#39;s loaded &lt;code&gt;loadBundle:&lt;/code&gt; is &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L404-L415&quot;&gt;called&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Injection then sends &lt;code&gt;expr -l objc++ -O -- (void)[[NSClassFromString(@&quot;NSBundle&quot;)  bundleWithPath:@&quot;/Users/orta/Library/Application Support/Developer/Shared/Xcode/Plug-ins/InjectionPlugin.xcplugin/Contents/Resources/InjectionLoader.bundle&quot;] load]&lt;/code&gt; into the debugger. Causing the same code as the patch to exist inside your app.  This code comes from the second target from the list at the top, and is hosted inside the plugin&#39;s bundle (meta...).&lt;/p&gt;

&lt;p&gt;With that verified, it&#39;s ready to inject the source code.&lt;/p&gt;

&lt;h4&gt;Code Injection Compilation&lt;/h4&gt;

&lt;p&gt;If everything is good, and ready to go, and we&#39;ve got confirmation that a client exists, Injection starts monitoring for file changes inside your Xcodeproject.&lt;/p&gt;

&lt;p&gt;A lot of the code injection work is done inside perl scripts, another new language for me. OK, so, at the end of &lt;code&gt;injectSource&lt;/code&gt; it runs &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl&quot;&gt;injectSource.pl&lt;/a&gt; with an argument of the file to inject.&lt;/p&gt;

&lt;p&gt;Note, a lot of ground-work for the perl scripts is done inside &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/common.pm&quot;&gt;common.pm&lt;/a&gt; - which is a module the other &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L15&quot;&gt;scripts import&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It is the role and responsibility of this script to setup, maintain and amend an xcodeproject that compiles just the class that has changed into a new bundle. Luckily for me this is pretty well documented &lt;code&gt;:D&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;It starts out by copying a template xcodeproject (either &lt;code&gt;iOSBundleTemplate&lt;/code&gt; or &lt;code&gt;OSXBundleTemplate&lt;/code&gt;) into your current project directory. I &lt;a href=&quot;https://github.com/artsy/eigen/pull/1236/files#diff-a084b794bc0759e7a6b77810e01874f2R46&quot;&gt;add this&lt;/a&gt; to the &lt;code&gt;.gitignore&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Next it pulls out the build settings for all these keys &lt;code&gt;FRAMEWORK_SEARCH_PATHS HEADER_SEARCH_PATHS USER_HEADER_SEARCH_PATHS GCC_VERSION ARCHS VALID_ARCHS GCC_PREPROCESSOR_DEFINITIONS GCC_ENABLE_OBJC_EXCEPTIONS&lt;/code&gt; from your project, into the sub-project.&lt;/p&gt;

&lt;p&gt;Next it determines how to handle code-signing on the app, as it supports both simulator and on-device, and you need to sign to run any code on a device.&lt;/p&gt;

&lt;p&gt;After that, if needs to understand how to compile an individual file, it gets a reference to the build log dirs for the &lt;a href=&quot;/images/2016-06-29-injection-overview/build_logs.png&quot;&gt;derived data&lt;/a&gt; for your app. They&#39;re zipped files, so it unzips them and parses the log. Here&#39;s an example of what &lt;a href=&quot;/images/2016-06-29-injection-overview/a_build_log.png&quot;&gt;compiling a single class from Eigen looks like&lt;/a&gt; (I&#39;ve highlighted the useful bits). Internally, this is called the learnt db.&lt;/p&gt;

&lt;p&gt;The learnt db is used to compile a class to be individually compiled into a &lt;code&gt;injecting_class.o&lt;/code&gt; file, I can&#39;t quite figure out where that file comes from though.&lt;/p&gt;

&lt;p&gt;To wrap up the compilation it needs to take the compiled object &lt;code&gt;injecting_class.o&lt;/code&gt; and statically link it to the bundle that is generated inside the sub-project. Here is the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L331-L365&quot;&gt;command line generation&lt;/a&gt;, building the script is a little bit &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L376-L467&quot;&gt;more involved&lt;/a&gt; - but that&#39;s generally because it&#39;s trying to support a lot of user options. The main class that exists in the bundle is &lt;code&gt;BundleContents&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The compiled bundle is then renamed so that you don&#39;t have name clashes, it&#39;s just incremental integers. My current sub-project I&#39;m using for debugging looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-06-29-injection-overview/injection_subproject.png&quot; alt=&quot;Injection Subproject&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With the &lt;code&gt;Logs&lt;/code&gt; dir being a symlink to the derived data folder.&lt;/p&gt;

&lt;p&gt;With that done, it will &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L487-L503&quot;&gt;include any nibs&lt;/a&gt; from compiling storyboards, and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L505-L512&quot;&gt;code-sign the bundle&lt;/a&gt; if it&#39;s going to a device. Finally it prints out &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L515&quot;&gt;the new bundle path&lt;/a&gt; in so the monitoring script can work with it.&lt;/p&gt;

&lt;h4&gt;Script Monitoring&lt;/h4&gt;

&lt;p&gt;The script to create the Xcode project, amend it, and compile is done as a separate process. It&#39;s &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L365&quot;&gt;done&lt;/a&gt; via the &lt;a href=&quot;http://linux.die.net/man/3/popen&quot;&gt;function&lt;/a&gt; &lt;code&gt;popen&lt;/code&gt;. This is then monitored in background, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L382&quot;&gt;listening for output lines&lt;/a&gt; that begins with &lt;code&gt;&amp;lt;&lt;/code&gt;, &lt;code&gt;&amp;gt;&lt;/code&gt;, &lt;code&gt;!&lt;/code&gt;, &lt;code&gt;%&lt;/code&gt; and &lt;code&gt;?&lt;/code&gt;. The one that we&#39;re most interested in, is the &lt;code&gt;!&lt;/code&gt; operator which tells the server the filepath of the now compiled &lt;code&gt;InjectionBundleX.bundle&lt;/code&gt;, in my most recent case, this looked like &lt;code&gt;/Users/orta/dev/ios/energy/iOSInjectionProject/build/Debug-iphonesimulator/InjectionBundle4.bundle&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L422-L423&quot;&gt;tells the&lt;/a&gt; server running inside Xcode that it has a file to send to the clients.&lt;/p&gt;

&lt;h4&gt;How the server works&lt;/h4&gt;

&lt;p&gt;Alright, back to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m&quot;&gt;the INPluginClientController&lt;/a&gt;. Skipping over the option setting &lt;code&gt;IBAction&lt;/code&gt;s and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L129-L185&quot;&gt;RTF-formatted logging&lt;/a&gt;. We come to the initial connection responder: &lt;code&gt;setConnection:&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;So, this is where I ended up a bit out of my comfort zone. This isn&#39;t a blog post about sockets and c though, so I&#39;ll annotate what&#39;s going on from the high level thoughout this &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L189&quot;&gt;connection setup function&lt;/a&gt;.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Grab some the main client file from socket, then if it&#39;s is an injection message, set the Injection console&#39;s info label to that filepath, this is the &lt;code&gt;BundleContents.m&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Otherwise inject all objects from a storyboard (not too sure whats going on there TBH)&lt;/li&gt;
&lt;li&gt;The server &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L216&quot;&gt;asks the client&lt;/a&gt; for the app&#39;s path e.g. &lt;code&gt;/Users/orta/Library/Developer/CoreSimulator/Devices/CDC9D8EF-AAAD-47F8-8D53-C3C69551E85A/data/Containers/Data/Application/1F636180-7113-406E-88F8-7E43EFAC13F6&quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;There&#39;s some more communication around the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L229-L230&quot;&gt;app&#39;s architecture&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;The app gets a &lt;a href=&quot;/images/2016-06-29-injection-overview/badge.png&quot;&gt;badge&lt;/a&gt; with the client count on it, so you know it&#39;s working.&lt;/li&gt;
&lt;li&gt;If checks if you want the File Watcher turned on.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;From that point the server&#39;s job is mainly to pass messages and files that come out of the scripts between the client and the host doing the compilation.&lt;/p&gt;

&lt;h4&gt;File Watcher&lt;/h4&gt;

&lt;p&gt;As an option you can set in the preferences toggles a File Watcher. I found a bunch of references to this in the code, so I wanted to at least dig into that. When you turn it on, any save will trigger an injection. This is done by looking for the folder that your &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L432-L436&quot;&gt;project resides in&lt;/a&gt;, then using Apple&#39;s &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/FileWatcher.m#L31&quot;&gt;file system event stream&lt;/a&gt; to monitor for save changes. Then when a new FS event is triggered, it re-injects that file. I bet it&#39;s turned off by default as you&#39;ll see errors when it&#39;s not compilable.&lt;/p&gt;

&lt;h2&gt;Client-Side&lt;/h2&gt;

&lt;p&gt;We&#39;ve hand-waved though the client-side of the app during the patching stage of installation, but to understand both parts of the system we need to cover the client side in a bit more depth. There&#39;s two aspects to it, the initial bundle/patch and incremental bundles that contain the new compiled code.&lt;/p&gt;

&lt;h4&gt;Client Setup&lt;/h4&gt;

&lt;p&gt;To understand this, we need to grok a 1,200 LOC header file &lt;code&gt;:D&lt;/code&gt;, it has a few responsibilities though. So we can try work through those, to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h&quot;&gt;BundleInjection.h&lt;/a&gt;. Interesting note, when you are patching your application - you&#39;re actually making a link to a copy of this file inside your &lt;code&gt;/tmp/&lt;/code&gt; dir.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;objc&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_inMainFilePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__FILE__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_inIPAddresses&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;10.12.1.67&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;127.0.0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#define INJECTION_ENABLED&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#import &amp;quot;/tmp/injectionforxcode/BundleInjection.h&amp;quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#endif&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;h4&gt;Client Socket Connection&lt;/h4&gt;

&lt;p&gt;Like the server, this has two responsibilities - using Bonjour to find the server, and raw socket communication. There is nothing unique about the Bonjour mutlicast work, so I&#39;m skipping that. Once the socket knows how to establish a connection between processes &lt;code&gt;+ bundleLoader&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L359&quot;&gt;is called&lt;/a&gt; on a background thread.&lt;/p&gt;

&lt;p&gt;So, what does &lt;code&gt;bundleLoad&lt;/code&gt; do?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It checks if it&#39;s a new Injection install in the app, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L366-L367&quot;&gt;if so&lt;/a&gt; it sets up &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/documentation/tunable_parameters.md&quot;&gt;INParameters and INColors&lt;/a&gt; for tunable parameters.&lt;/li&gt;
&lt;li&gt;It then determines the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L383-L400&quot;&gt;hardware architecture&lt;/a&gt; for it to be sent to the server for compilation later.&lt;/li&gt;
&lt;li&gt;Attempt to connect to the server, 5 times.&lt;/li&gt;
&lt;li&gt;If it succeeds, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L415&quot;&gt;write the location&lt;/a&gt; of the &lt;code&gt;BundleInjection&lt;/code&gt; file to the server. Triggering the first of the socket work on the server.&lt;/li&gt;
&lt;li&gt;Expect a response of the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L417&quot;&gt;server&#39;s&lt;/a&gt; version of &lt;code&gt;BundleInjection&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;If the bundle is compiling storyboards on iOS, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L424-L429&quot;&gt;swizzle some&lt;/a&gt; of the UINib init functions.&lt;/li&gt;
&lt;li&gt;Pass the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L443&quot;&gt;home directory of the app&lt;/a&gt; to the server.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;From there the socket goes into runloop mode on it&#39;s on thread.&lt;/p&gt;

&lt;h4&gt;Client Socket Runloop&lt;/h4&gt;

&lt;p&gt;As with server monitoring, the client listens for strings that begin with special prefixes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;~&lt;/code&gt; - Injects, then Re-creates the app degelate + view controller heirarchy.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/&lt;/code&gt; - &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L644&quot;&gt;Loads&lt;/a&gt; the bundle path that was sent in.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;gt;&lt;/code&gt; - Accepts a file or directory to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L476&quot;&gt;be sent through the socket&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;&lt;/code&gt; - Sends a requested file or directory to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L492&quot;&gt;through the socket&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#&lt;/code&gt; - &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L540&quot;&gt;Receives&lt;/a&gt; an &lt;code&gt;NS/UIImage&lt;/code&gt; via NSData for Tunable Parameters.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;!&lt;/code&gt; - Logs to console&lt;/li&gt;
&lt;li&gt;Otherwise, assume it&#39;s another Tunable Parameter.&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;Loading the Bundle&lt;/h4&gt;

&lt;p&gt;When the new bundle is loaded &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L303-L308&quot;&gt;it triggers&lt;/a&gt; this code:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;objc&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kt&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSClassFromString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&amp;quot;BundleInjection&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;autoLoadedNotify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;hook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;injectionHook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Which does the job of letting the running app know that instances have been updated with new code. Injection does three things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;A global NSNotification for .&lt;/li&gt;
&lt;li&gt;Sends all instances of classes injected a message that they&#39;ve been injected.&lt;/li&gt;
&lt;li&gt;Sends all classes that have been injected a message they&#39;ve been injected.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Which is where this goes from &quot;complex&quot;, to &quot;I would need to study up to do this.&quot; Let&#39;s start of quoting the README that &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; and I worked on for a while.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It can be tough to look through all of the memory of a running application. In order to determine the classes and instances to call the injected callbacks on, Injection performs a &quot;sweep&quot; to find all objects in memory. Roughly, this involves looking at an object, then recursively looking through objects which it refers to. For example, the object&#39;s instance variables and properties.&lt;/p&gt;

&lt;p&gt;This process is seeded using the application&#39;s delegate and all windows. Once all the in-memory reference are collected, Injection will then filter these references to ones that it has compiled and injected. Then sending them the messages referenced in the callbacks section.&lt;/p&gt;

&lt;p&gt;If no references are found, Injection will look through all objects that are referred to via sharedInstance. If that fails, well, Injection couldn&#39;t find your instance. This is one way in which you may miss callbacks in your app.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h4&gt;Class + Method Injections&lt;/h4&gt;

&lt;p&gt;So how does it pull that off? Calling &lt;code&gt;NSBundle&lt;/code&gt;&#39;s &lt;code&gt;- load&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L648&quot;&gt;here&lt;/a&gt;, calls the &lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSBundle_Class/index.html#//apple_ref/occ/instm/NSBundle/load&quot;&gt;load function to call on all classes&lt;/a&gt; inside that new bundle. This triggers the load function from the &lt;code&gt;InjectionBundle&lt;/code&gt; that is auto-generated during the Injection stage. Here&#39;s what one of mine looks like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;objc&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;InjectionBundle3&lt;/span&gt; : &lt;span class=&quot;bp&quot;&gt;NSObject&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;InjectionBundle3&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kt&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSClassFromString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&amp;quot;BundleInjection&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;autoLoadedNotify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;hook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;injectionHook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This is generated from the &lt;code&gt;injectSource.pl&lt;/code&gt; script &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L311-L315&quot;&gt;here&lt;/a&gt;] &lt;code&gt;[bundleInjection autoLoadedNotify:$flags hook:(void *)injectionHook];&lt;/code&gt; . It also comes with another function,&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;c&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;injectionHook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;injectionHook():&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InjectionBundle3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;What we care about is &lt;code&gt;&amp;amp;injectionHook&lt;/code&gt; which gets passed to &lt;code&gt;autoLoadedNotify&lt;/code&gt; as a pointer to a function. Oddly enough, I&#39;m a tad confused about the fact that the injection hook contains a reference to the function that calls it, but lets roll with it for now. Perhaps it&#39;s never actually called, &lt;em&gt;I asked&lt;/em&gt; -it&#39;s for Android support, and isn&#39;t used.&lt;/p&gt;

&lt;p&gt;So, we&#39;ve had a fairly typical &lt;code&gt;NSBundle&lt;/code&gt; &lt;code&gt;- load&lt;/code&gt; load our classes into the runtime. This triggered the &lt;code&gt;InjectionBundle.bundle&lt;/code&gt; to have it&#39;s classes created, and the first thing it does is pass a reference back to the &lt;code&gt;BundleInjection&lt;/code&gt; class instance for the &lt;code&gt;injectionHook&lt;/code&gt; function that calls the &lt;code&gt;load&lt;/code&gt; on the new classes.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; terminology changes here, I&#39;ve talked about a bundle, but now that the code is in the runtime, we start talking about it as a dynamic library. These bundles contain 2 files &lt;code&gt;Info.plist&lt;/code&gt;, &lt;code&gt;InjectionBundleX&lt;/code&gt; - so when I say dynamic library, I&#39;m referring to the code that is inside the bundle that is linked ar runtime (and thus dynamically linked in.)&lt;/p&gt;

&lt;p&gt;Next, Injection creates a &lt;a href=&quot;https://github.com/davetroy/astmanproxy/blob/f4b952a717b7e982b585bf0daa86398add394a88/src/include/dlfcn-compat.h#L44-L54&quot;&gt;dynamic library info&lt;/a&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L944-L946&quot;&gt;struct&lt;/a&gt; and uses &lt;a href=&quot;http://linux.die.net/man/3/dladdr&quot;&gt;dladdr&lt;/a&gt; to fill the struct, based on the function pointer. This lets Injection know where in memory the library exists. It&#39;s now safe in the knowledge that the code has been injected into the runtime. Injection will re-create the app structure, if requested - like when it receives a socket event of &lt;code&gt;~&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;We&#39;re getting into Mach-O binary APIs, so put on your crash helmets. Injection is going to use the dynamic library info, and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L959-L981&quot;&gt;ask for the Objective-C&lt;/a&gt; &lt;code&gt;__classlist&lt;/code&gt; via &lt;a href=&quot;http://www.manpagez.com/man/3/getsectdatafromheader/&quot;&gt;getsectdatafromheader&lt;/a&gt; for the new dynamic library. This works fine for Swift too, it &lt;em&gt;mostly&lt;/em&gt; has to be exposed to the Objective-C runtime. If you want to understand more about what this looks like, read &lt;a href=&quot;https://blog.zynamics.com/2010/07/02/objective-c-reversing-ii/&quot;&gt;this blog post&lt;/a&gt; from &lt;a href=&quot;https://zynamics.com&quot;&gt;Zynamics&lt;/a&gt;. Injection then loops through the classes inside the library, via the most &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L988&quot;&gt;intensely casted&lt;/a&gt; line in of code in here: &lt;code&gt;Class *classReferences = (Class *)(void *)((char *)info.dli_fbase+(uint64_t)referencesSection);&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;These classes are then iterated though, and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L836-L845&quot;&gt;new implementations of functions are swizzled&lt;/a&gt; to reference the new implementations. With Swift you have no guarantee that the methods are &lt;code&gt;dynamic&lt;/code&gt; so all their &lt;code&gt;vtable&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L847-L855&quot;&gt;data is switched&lt;/a&gt;. If you don&#39;t know what a vtable is check this &lt;a href=&quot;https://en.wikipedia.org/wiki/Virtual_method_table&quot;&gt;page on Wikipedia&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Once all of the classes have had their methods switched, the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L911-L937&quot;&gt;class table is updated&lt;/a&gt; to ensure that functions that rely on the class table ( e.g. &lt;code&gt;NSClassFromSelector&lt;/code&gt; ) return the new values.&lt;/p&gt;

&lt;p&gt;With valid class tables, and the newly injected functions added. Injection starts the memory sweep to send updated notifications.&lt;/p&gt;

&lt;h4&gt;Class + Instance Notifications&lt;/h4&gt;

&lt;p&gt;At &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L1028&quot;&gt;this point&lt;/a&gt; Injected does a run through the new class list again, if that class responds to the selector &lt;code&gt;+ injected&lt;/code&gt; it runs it. It then does a check to see if the class&#39;s instances reponds to &lt;code&gt;- injected&lt;/code&gt; if it does, it looks to see if it has any instances of the objects in it&#39;s liveObjects array. If the array hasn&#39;t been set up, then it needs to do a full memory sweep.&lt;/p&gt;

&lt;p&gt;Injection has an &lt;a href=&quot;https://github.com/johnno1962/Xprobe&quot;&gt;Xprobe&lt;/a&gt;-lite included inside it. This lives in &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h&quot;&gt;BundleSweeper.h&lt;/a&gt;. The quote opening this notification section above gave the start away, BundleSweeper &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L47&quot;&gt;looks at the app delegate&lt;/a&gt; ( or a &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L55&quot;&gt;Cocos2D director object&lt;/a&gt;) and then starts to recursively look at every object that it&#39;s related to. This is done by adding a &lt;code&gt;bwseep&lt;/code&gt; function to &lt;code&gt;NSObject&lt;/code&gt; then individually customizing it for known container classes, and &quot;reference&quot; classes e.g &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L228&quot;&gt;NSBlock&lt;/a&gt;, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L221&quot;&gt;NSData&lt;/a&gt;, NSString, NSValue etc. The &lt;code&gt;bsweep&lt;/code&gt; function adds itself to the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L113-L117&quot;&gt;shared list&lt;/a&gt; of &quot;objects seen&quot;, checks for an it being a &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L119-L124&quot;&gt;private class or a transition&lt;/a&gt;, if it&#39;s not then it loops through the &lt;a href=&quot;http://stackoverflow.com/questions/16304483/debug-obtain-a-list-of-all-instance-variables-of-an-object-unknown-type&quot;&gt;IvarList&lt;/a&gt; and runs &lt;code&gt;bsweep&lt;/code&gt; on all of those. With that done, it casually tests to see if there are any weakly held objects that &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L148-L160&quot;&gt;tend to use common selectors&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let that simmer for a bit ( I jest, it&#39;s super fast. ) and then you have &lt;em&gt;almost&lt;/em&gt; every object in your object graph being told that they&#39;ve been updated. I say almost because of the above caveat. Can&#39;t find all objects this way. Singletons that never are referenced strongly from another object inside the findable graph wouldn&#39;t get a notification this way for example.&lt;/p&gt;

&lt;p&gt;With all the fancy class an instance nofications sorted, there is a good old reliable &lt;code&gt;NSNotification&lt;/code&gt; - &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/master/InjectionPluginLite/Classes/BundleInjection.h#L1065&quot;&gt;here&lt;/a&gt;. Which is what I based my &lt;a href=&quot;https://github.com/artsy/eigen/pull/1236&quot;&gt;work on for Eigen&lt;/a&gt;, super simple, extremely reliable and great for re-use.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/49038/13548868/131cbb1e-e2c8-11e5-9f61-4acdfd10b6aa.gif&quot; alt=&quot;https://cloud.githubusercontent.com/assets/49038/13548868/131cbb1e-e2c8-11e5-9f61-4acdfd10b6aa.gif&quot; /&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;Phew!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;So, this covered the majority of how Injection for Xcode works. It&#39;s a &lt;em&gt;really&lt;/em&gt; powerful tool, that can vastly improve your day-to-day programming. When I showed a draft of this post to &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; he reminded me that &lt;a href=&quot;https://github.com/johnno1962/Diamond&quot;&gt;Diamond&lt;/a&gt; - his Swift scripting improvement tool, had it&#39;s own version of Injector inside that, that is much &lt;a href=&quot;https://github.com/johnno1962/Diamond/blob/master/Reloader/Reloader.m&quot;&gt;simpler and a easier read&lt;/a&gt; at 120 LOC. However, can&#39;t understand the future without understanding the past.&lt;/p&gt;

&lt;p&gt;A lot of the most complicated code is around:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The client-server architecture, and about passing files/folders between the running application and the Xcode plugin.&lt;/li&gt;
&lt;li&gt;The recursive memory sweeping required to get a notification that it&#39;s done.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The actual work involved in &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L807-L938&quot;&gt;doing the injection, and replacing the classes&lt;/a&gt; isn&#39;t particularly complicated, and is easy to understand without c/Mach-o domain knowledge. It&#39;s making sure the environment is set up and supporting useful features like Storyboards, Android via Apportable, ARC and no-ARC, 32bit vs 64bit and iOS vs Mac where things start to become more complex.&lt;/p&gt;

&lt;p&gt;As of Xcode 8, Xcode Plugins are on the way out, though there are hacks to work around the system to install them, doing so might not be the smartest of moves yet. It&#39;s hard to see where the future lies here. However,&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://media2.giphy.com/media/VHW0X0GEQQjiU/giphy.gif&quot; alt=&quot;Giphy&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we&#39;ll see in a few months.&lt;/p&gt;

&lt;p&gt;If you&#39;re interested in this kind of stuff, follow &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; on Twitter, he&#39;s &lt;a href=&quot;https://twitter.com/Injection4Xcode&quot;&gt;@Injection4Xcode&lt;/a&gt; - Chris Lattner follows him, so you know it&#39;s good stuff. He&#39;s always got some project that is pushing a boundry or two.&lt;/p&gt;
</description>
        <pubDate>Wed, 29 Jun 2016 12:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/06/29/code-spelunking-injection/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/06/29/code-spelunking-injection/</guid>
        
        
        <category>mobile</category>
        
        <category>swift</category>
        
        <category>tooling</category>
        
        <category>xcode</category>
        
      </item>
    
      <item>
        <title>Depedency Injection in Swift</title>
        <description>&lt;p&gt;Dependency Injection (DI) is a &lt;a href=&quot;http://www.jamesshore.com/Blog/Dependency-Injection-Demystified.html&quot;&gt;$25 word for a 5¢ idea&lt;/a&gt;, but it&#39;s an idea that has become wholly foundation to how I write software. I want to take a look at some of the ways our team have been using DI in Swift.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;DI users in Swift (and Objective-C) are generally in one of a few camps:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Use &lt;a href=&quot;https://www.natashatherobot.com/unit-testing-swift-dependency-injection/&quot;&gt;initializer injection&lt;/a&gt; to provide objects with their dependencies.&lt;/li&gt;
&lt;li&gt;Use property injection (&lt;a href=&quot;https://ashfurrow.com/blog/lazy-property-setup-in-swift/&quot;&gt;with laziness even!&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;Use &lt;a href=&quot;https://github.com/Swinject/Swinject&quot;&gt;frameworks like Swinject&lt;/a&gt; to build dependency graphs at run time.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If you&#39;ve used storybards or nibs before, you have probably already used property injection via IBOutlets. I actually consider initializer injection and property injection to be roughly the equivalent, just with different timing.&lt;/p&gt;

&lt;p&gt;If I had to pick a favourite, I like the initializer injection because it fits appropriately with the level of dynamism Swift offers. But Swift is still &lt;em&gt;super&lt;/em&gt; young and there&#39;re lots of programming techniques to explore, so I&#39;ve been experimenting with something new.&lt;/p&gt;

&lt;p&gt;The idea is similar to initializer injection, where you provide an instance&#39;s dependencies, but instead of providing the dependencies directly, you provide closures that return a dependency. It sounds odd, and is best explained using an example that starts without any DI at all.&lt;/p&gt;

&lt;p&gt;Okay, we&#39;ve got a network layer that communicates with an API. We&#39;re writing the class that takes the parsed data from the &lt;code&gt;NetworkProvider&lt;/code&gt; class and turns it into models consumable by the rest of the app. Right now it looks like this.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;networkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;n&quot;&gt;networkProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;https://api.wherever.com&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;There are some limitations to this, specifically around testing it. It would be better to have the &lt;code&gt;networkProvider&lt;/code&gt; passed in as an argument to &lt;code&gt;init()&lt;/code&gt;. That&#39;s initializer injection, and my opposition to it is that we&#39;ve moved the responsibility for creating the &lt;code&gt;networkProvider&lt;/code&gt; up the stack.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;networkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;networkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;networkProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;networkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stateManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nl&quot;&gt;networkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;https://api.wherever.com&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;The thing is, now some &lt;em&gt;other&lt;/em&gt; object has to know how to do create the &lt;code&gt;NetworkProvider&lt;/code&gt;. Hrm. You can repeat this process of injecting dependencies from further up the stack until you have a general-purpose DI framework, and that&#39;s not my bag.&lt;/p&gt;

&lt;p&gt;My approach passes a closure that &lt;em&gt;returns&lt;/em&gt; a network provider instead of passing in a &lt;code&gt;networkProvider&lt;/code&gt; instance directly. The parameter can be given a default implementation, too.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;networkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nl&quot;&gt;networkProviderCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;defaultNetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;n&quot;&gt;networkProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;networkProviderCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaultNetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;            &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;https://api.wherever.com&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;There&#39;s a lot to unpack here, so let&#39;s take it slowly. The initializer has a new &lt;code&gt;networkProviderCreator&lt;/code&gt;, a closure that returns a &lt;code&gt;NetworkProvider&lt;/code&gt;. In the initializer, we set our property to the return value of the closure. We also have a class method that gives us a default implementation that&#39;s used in production.&lt;/p&gt;

&lt;p&gt;But in tests, we can initialize the &lt;code&gt;StateManager&lt;/code&gt; with a stub closure, something like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fakeNetworkProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;testSubject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fakeNetworkProvider&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Now you get the benefits of initializer injection, but the flexibility to only use DI when you need to.&lt;/p&gt;

&lt;p&gt;Note: we should still test the &lt;code&gt;defaultNetworkCreator()&lt;/code&gt; function to make sure it works, too. Having code behave differently specifically while being tested is not generally a good idea.&lt;/p&gt;

&lt;p&gt;Applying the advice on using &lt;code&gt;typealias&lt;/code&gt; from &lt;a href=&quot;http://artsy.github.io/blog/2016/06/24/typealias-for-great-good/&quot;&gt;my last post&lt;/a&gt;, we can tidy our code up a little bit.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;17&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;18&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;19&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;20&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;NetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;networkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nl&quot;&gt;networkProviderCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkCreator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;defaultNetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;n&quot;&gt;networkProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;networkProviderCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClassFunctions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClassFunctions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaultNetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkCreator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;            &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;https://api.wherever.com&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;h3&gt;But wait, there&#39;s more!&lt;/h3&gt;

&lt;p&gt;The other benefits of passing in a closure instead of an instance is that it lets the initializer customize the dependency based on other data. For example, let&#39;s say the state manager uses an &lt;code&gt;enum&lt;/code&gt; to differentiate between staging and production API endpoints (btw, &lt;a href=&quot;https://ashfurrow.com/blog/the-wrong-binary/&quot;&gt;two-case enums are great at this&lt;/a&gt;). How might our initializer change?&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;17&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;18&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;19&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;20&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;21&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;22&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;23&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;24&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;25&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;26&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;27&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;28&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;29&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;30&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;31&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;32&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;33&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;APIEnvironment&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Staging&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Production&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;NetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;networkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nl&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;APIEnvironment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nl&quot;&gt;networkProviderCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkCreator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;defaultNetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;baseURLString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;environment&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Staging&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;            &lt;span class=&quot;n&quot;&gt;baseURLString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;https://staging-api.wherever.com&amp;quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Production&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;            &lt;span class=&quot;n&quot;&gt;baseURLString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;https://api.wherever.com&amp;quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;n&quot;&gt;networkProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;networkProviderCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;baseURLString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClassFunctions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StateManager&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClassFunctions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;defaultNetworkCreator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NetworkCreator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;baseURLString&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;            &lt;span class=&quot;n&quot;&gt;NetworkProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;baseURLString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;I really dig this. The closure to create the dependency is close to the code that uses it, but is insulated from any specific instance, so we get the benefits of using DI.&lt;/p&gt;

&lt;p&gt;You could argue that picking a base URL for an API shouldn&#39;t belong here, and you could probably convince me. But my point isn&#39;t that this specific example is ideal, it&#39;s that the pattern of using closures for initializer injection is pretty neat.&lt;/p&gt;

&lt;p&gt;The logic to create dependencies has to go &lt;em&gt;somewhere&lt;/em&gt;. I think it makes sense to keep it close to the code that actually uses the dependency, but isolated in a &lt;code&gt;class&lt;/code&gt; function so no actual instance is involved in its creation. As a result, developers get the benefits of initializer injection and none of the added cognitive overhead when writing your production code.&lt;/p&gt;

&lt;p&gt;It may not be a perfect pattern (what is?) but we&#39;ve been using it on &lt;a href=&quot;https://github.com/artsy/eidolon&quot;&gt;eidolon&lt;/a&gt; and &lt;a href=&quot;https://github.com/artsy/eigen&quot;&gt;eigen&lt;/a&gt; for nearly two years and – combined with generous use of protocols – we&#39;ve been really happy with the results.&lt;/p&gt;

&lt;p&gt;Now that I have more free time to explore the pattern, I want to take it a step further and see where it could be used outside of unit testing. It&#39;s possible that using this approach could make all our types less tightly coupled and provide a more modular codebase.&lt;/p&gt;
</description>
        <pubDate>Mon, 27 Jun 2016 12:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/06/27/dependency-injection-in-swift/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/06/27/dependency-injection-in-swift/</guid>
        
        
        <category>eidolon</category>
        
        <category>eigen</category>
        
        <category>mobile</category>
        
        <category>swift</category>
        
      </item>
    
      <item>
        <title>Swift Type Aliases: Use Early and Often</title>
        <description>&lt;p&gt;It&#39;s been so fun to watch the Swift developer community experiment with Swift and to experiment with what idiomatic Swift will look like. No one really knows the answer yet, but we&#39;re starting to see some design patterns used more than others. We&#39;re seeing some language features used in key ways that define idiomatic Swift, and other language features that are being mostly ignored.&lt;/p&gt;

&lt;p&gt;Regrettably, one of my favourite features of Swift has not enjoyed the meteoric rise in popularity I believe it deserves: &lt;code&gt;typealias&lt;/code&gt;.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;Type aliases allow developers to define synonyms for pre-existing types. It might sound dull because it &lt;em&gt;is&lt;/em&gt; dull. In fact, its usefulness isn&#39;t even apparent when &lt;em&gt;writing&lt;/em&gt; code, mostly when &lt;em&gt;maintaining&lt;/em&gt; it.&lt;/p&gt;

&lt;p&gt;But before I dig into how &lt;code&gt;typealias&lt;/code&gt; is useful, let&#39;s review what it is to make sure we&#39;re all on the same page. Developers use &lt;code&gt;typealias&lt;/code&gt; to create a new type identifier that&#39;s a synonym for another type. For example, we can declare &lt;code&gt;typealias BigNumber = Int64&lt;/code&gt; and use &quot;BigNumber&quot; any place we could have used &quot;Int64&quot;.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;multiply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;lhs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BigNumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;rhs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BigNumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BigNumber&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BigNumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BigNumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;You can use &lt;code&gt;typealias&lt;/code&gt; for most any type: classes, enums, structs, tuples, closures, etc. Here are a few examples.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Employees&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Employee&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GridPoint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CompletionHandler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ErrorType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Void&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Now that we&#39;re familiar with &lt;code&gt;typealias&lt;/code&gt;, I want to discuss four examples that show how &lt;code&gt;typealias&lt;/code&gt; has helped us maintain code.&lt;/p&gt;

&lt;h3&gt;Promoting Existing Types Semantics&lt;/h3&gt;

&lt;p&gt;When writing web socket communication for eigen, Orta and I were using &lt;a href=&quot;https://jwt.io&quot;&gt;JSON Web Tokens&lt;/a&gt; to authenticate the user. If you&#39;ve never used JWTs before, don&#39;t worry, here&#39;s the tl;dr JWTs are a way to authenticate users in a way that clients can cryptographically verify. It&#39;s &lt;em&gt;basically&lt;/em&gt; a base64 encoded string of JSON.&lt;/p&gt;

&lt;p&gt;Clients don&#39;t need to verify the JWT in order to use them, and in fact when Orta and I began using them, we treated them only as strings retrieved from one API and sent to another (like an access token). However, instead of using the &lt;code&gt;String&lt;/code&gt; type, I decided to define a &lt;code&gt;JWT&lt;/code&gt; type alias.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JWT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;I used the new &lt;code&gt;JWT&lt;/code&gt; type throughout the code as a hint to other developers about what &lt;em&gt;kind&lt;/em&gt; of string it is. This gave it some semantic meaning on top of being a string. Neat. Only later, when we needed to start decoding the JWT itself did this really come in handy.&lt;/p&gt;

&lt;p&gt;After deleting the &lt;code&gt;typealias&lt;/code&gt; and replacing it with a class of the same name, we didn&#39;t have to worry about changing function definitions and property types all throughout our codebase. We made the changes locally, in one file, and most all the rest of our code still compiled. Pretty cool! Here&#39;s the &lt;a href=&quot;https://github.com/artsy/eigen/pull/1638/files/911473424849240bb71b89c412b0a1887e5c1418#diff-6d73ebd58fdd2d00c32813f60608fbd1R10&quot;&gt;relevant portion of the pull request&lt;/a&gt; that made that change.&lt;/p&gt;

&lt;h3&gt;Consolidating Tuple Types&lt;/h3&gt;

&lt;p&gt;I &lt;a href=&quot;https://ashfurrow.com/blog/uicollectionview-unjustly-maligned/&quot;&gt;recently wrote about UICollectionView&lt;/a&gt; and how I used them to solve a difficult layout problem. I detailed how I created a pipeline of simple math functions that used previous results to calculate the next step of the layout. What I didn&#39;t mention was that I used tuples to help, specifically tuples with &lt;code&gt;typealias&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Tuples are useful for composing several different values into a lightweight type. Think of tuples as junior structs. I was writing functions to do some calculations and return their result as a tuple. Something like this:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layoutMetricsForPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CellPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;aspectRatio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;restingWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;restingHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;targetWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;targetHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;And because of how the layout pipeline worked, I then needed to use the &lt;em&gt;same&lt;/em&gt; tuple as a parameter for the next function.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;centersForPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CellPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;metrics&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;restingWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;restingHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;targetWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;targetHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Any time you use the same tuple type more than once, consider making a &lt;code&gt;typealias&lt;/code&gt;. In this case, the code became a lot shorter and easier to skim and understand.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LayoutMetrics&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;restingWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;restingHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;targetWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;targetHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CenterXPositions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;restingCenterX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;targetCenterX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;layoutMetricsForPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CellPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;aspectRatio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGFloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LayoutMetrics&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;centersForPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CellPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;metrics&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LayoutMetrics&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CenterXPositions&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;If we need to change something about the tuple later on, we only need to change it in one place. We&#39;ve also made it easier to promote this tuple to a struct or class later on, just like in the JWT example, because all the functions are already referring to it as its own type. You can check out how we used type alias&#39;d tuples &lt;a href=&quot;https://github.com/artsy/eigen/blob/12eac80948bcfd1e5c6fc2aa85b22ccb2a4421dd/Artsy/View_Controllers/Live_Auctions/Views/LiveAuctionFancyLotCollectionViewLayout.swift#L104&quot;&gt;in the code&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Defining Closures Signatures&lt;/h3&gt;

&lt;p&gt;Objective-C developers, burdened with &lt;a href=&quot;http://goshdarnblocksyntax.com&quot;&gt;arcane syntax for blocks&lt;/a&gt;, use C&#39;s &lt;code&gt;typedef&lt;/code&gt; to isolate that syntax strangeness in one place. And even though Swift&#39;s closure syntax is &lt;em&gt;awesome&lt;/em&gt;, we can still benefit from Objective-C&#39;s example – we can use type aliases for closure signatures.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Moya/Moya&quot;&gt;Moya&lt;/a&gt; uses this technique quite a bit, because it has so many closures. Let&#39;s take a look at the &lt;code&gt;StubClosure&lt;/code&gt;, which &lt;a href=&quot;https://github.com/Moya/Moya/blob/6666947219f231091d5c3e0b9d5f63ac4091718d/Source/Moya.swift#L78-L79&quot;&gt;defines if (and how) a network request should be stubbed&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StubClosure&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StubBehavior&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;We use this type as an initializer parameter instead of the full closure syntax, making our code a lot shorter and more legible. Nice! Since the user usually doesn&#39;t want to customize this parameter, so we&#39;ve &lt;a href=&quot;https://github.com/Moya/Moya/blob/6666947219f231091d5c3e0b9d5f63ac4091718d/Source/Moya.swift#L97&quot;&gt;defined a default value&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nl&quot;&gt;stubClosure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StubClosure&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MoyaProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NeverStub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;...)&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;MoyaProvider&lt;/code&gt; has a class function on it called &lt;code&gt;NeverStub&lt;/code&gt; &lt;a href=&quot;https://github.com/Moya/Moya/blob/6666947219f231091d5c3e0b9d5f63ac4091718d/Source/Moya.swift#L246-L248&quot;&gt;whose type&lt;/a&gt; matches our closure.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NeverStub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Moya&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StubBehavior&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Never&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This particular function doesn&#39;t use the &lt;code&gt;typealias&lt;/code&gt;, but another one does. We have a function named &lt;code&gt;DelayedStub&lt;/code&gt; that returns the &lt;code&gt;typealias&lt;/code&gt; instead of the raw closure. Take a look!&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DelayedStub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;seconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSTimeInterval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Moya&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StubClosure&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Delayed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;seconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Super cool! Closures are a powerful tool in Swift already, but by using a &lt;code&gt;typealias&lt;/code&gt;, we refer to it as &lt;code&gt;StubClosure&lt;/code&gt; throughout our code.&lt;/p&gt;

&lt;p&gt;In isolation, this gain may not seem significant, but the dividends have accrued dramatically for the project. &lt;code&gt;typealias&lt;/code&gt; has made it easy to maintain Moya as it has evolved alongside Swift. Check out more examples of type aliasing closures &lt;a href=&quot;https://github.com/artsy/eigen/blob/12eac80948bcfd1e5c6fc2aa85b22ccb2a4421dd/Artsy/View_Controllers/Live_Auctions/LiveAuctionStateManager.swift#L20-L21&quot;&gt;in this eigen class&lt;/a&gt;, which uses them for dependency injection.&lt;/p&gt;

&lt;h3&gt;Extending Typealiases&lt;/h3&gt;

&lt;p&gt;The last example I want to discuss is extensions, specifically extensions to &lt;em&gt;your own&lt;/em&gt; types.&lt;/p&gt;

&lt;p&gt;When writing classes, especially view controllers, developers have a habit of writing long, unwieldy files that are difficult to navigate and maintain. Preventing such files is far easier than fixing them, which is why I use &lt;code&gt;typealias&lt;/code&gt; early, and I use it often.&lt;/p&gt;

&lt;p&gt;I recommend using a descriptive &lt;code&gt;typealias&lt;/code&gt; that is private to your file, and then extending that &lt;code&gt;typealias&lt;/code&gt; so you can keep things neat and tidy. It&#39;s a bit confusing, so let&#39;s take a look at an example.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;swift&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PrivateHelperFunctions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MyViewController&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PrivateHelperFunctions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;typealias&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TableViewMethods&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MyViewController&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;TableViewMethods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;UITableViewDelegate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;UITableViewDataSource&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;We&#39;re still extending the view controller, but specifically we&#39;re extending the &lt;code&gt;typealias&lt;/code&gt; so that the extension has a helpful name. This is another way that &lt;code&gt;typealias&lt;/code&gt; can help add semantic meaning to your code.&lt;/p&gt;

&lt;p&gt;Beyond helping you find code quickly, having code in extensions also makes it &lt;em&gt;way&lt;/em&gt; easier to move that extension to another file or create a new helper class altogether. So not only does it keep classes tidy, but it also helps you keep classes &lt;em&gt;small&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;This technique can also serve as a workaround for Swift&#39;s &lt;a href=&quot;http://stackoverflow.com/questions/24017316/pragma-mark-in-swift&quot;&gt;awful Xcode sectioning syntax&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-06-24-typealias-for-great-good/jumpbar.png&quot; alt=&quot;Xcode Jumpbar&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You can &lt;a href=&quot;https://github.com/artsy/eigen/search?l=swift&amp;amp;q=private+typealias&amp;amp;utf8=%E2%9C%93&quot;&gt;search through eigen&lt;/a&gt; for more examples of using a private &lt;code&gt;typealias&lt;/code&gt; to divide your code into manageable pieces.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Look, I&#39;m not saying that using &lt;code&gt;typealias&lt;/code&gt; more is universally a good idea. You might disagree with some of the use cases in this post, which is fine! And this isn&#39;t meant to be an exhaustive list of examples, either.&lt;/p&gt;

&lt;p&gt;My point is, used in a few key ways, &lt;code&gt;typealias&lt;/code&gt; has helped me maintain my code more easily. It&#39;s a good tool to be familiar with. Even if it won&#39;t revolutionize the way you write software, &lt;code&gt;typealias&lt;/code&gt; can help make your job a smidgen easier, and who could argue with that?&lt;/p&gt;
</description>
        <pubDate>Fri, 24 Jun 2016 12:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/06/24/typealias-for-great-good/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/06/24/typealias-for-great-good/</guid>
        
        
        <category>eigen</category>
        
        <category>mobile</category>
        
        <category>swift</category>
        
      </item>
    
      <item>
        <title>GraphQL for iOS Developers</title>
        <description>&lt;p&gt;GraphQL is something you may have heard in passing, usually from the web team. It&#39;s a Facebook API technology, that describes itself as a &lt;em&gt;A Data Query Language and Runtime&lt;/em&gt;. GraphQL is a &lt;a href=&quot;http://facebook.github.io/graphql/&quot;&gt;spec&lt;/a&gt;, and there are &lt;a href=&quot;https://github.com/chentsulin/awesome-graphql#libraries&quot;&gt;multiple implementation&lt;/a&gt; of it. As mobile engineers, we can consider it an API, where the front-end team have as much control as the backend.&lt;/p&gt;

&lt;p&gt;This blog post covers our usage of GraphQL, and what I&#39;ve learned in the last 3 months of using it in &lt;a href=&quot;https://github.com/artsy/eigen/&quot;&gt;Eigen&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h3&gt;So what is GraphQL&lt;/h3&gt;

&lt;p&gt;You can get the full explanation on &lt;a href=&quot;http://graphql.org&quot;&gt;the GraphQL website&lt;/a&gt;. Though, I found running through &lt;a href=&quot;https://learngraphql.com&quot;&gt;Learn GraphQL&lt;/a&gt; site to really hammer down how it works. Reading the &lt;a href=&quot;https://facebook.github.io/react/blog/2015/05/01/graphql-introduction.html&quot;&gt;introduction blog post&lt;/a&gt; can be useful too.&lt;/p&gt;

&lt;p&gt;GraphQL is an API middle-layer. It acts as an intermediate layer between multiple front-end clents and multiple back-end APIs. This means it can easily coalesce multiple API calls into a single request, this can be a &lt;em&gt;massive&lt;/em&gt; user experience improvement when you have a screen that requires information from multiple sources before you can present anything to a user.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-06-19-graphql-for-iOS-devs/graphQL.svg&quot; width=100%&gt;&lt;/p&gt;

&lt;p&gt;As a client, you &lt;a href=&quot;https://github.com/artsy/eigen/blob/dac7c80b66b600f9a45aaae6095544fe420f0bbc/Artsy/Networking/ARRouter.m#L1011&quot;&gt;send&lt;/a&gt; a &quot;&lt;a href=&quot;http://graphql.org/docs/getting-started/#queries&quot;&gt;JSON-shaped query&lt;/a&gt;&quot; structure, which is heirarchical and easy to read:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;json&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;err&quot;&gt;artwork(id:&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;quot;kimber-berry-as-close-to-magic-as-you-can-get&amp;quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;err&quot;&gt;id&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;err&quot;&gt;additional_information&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;err&quot;&gt;is_price_hidden&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;err&quot;&gt;is_inquireable&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;blockquote&gt;&lt;p&gt;This will search for a &lt;a href=&quot;https://www.artsy.net/artwork/kimber-berry-as-close-to-magic-as-you-can-get&quot;&gt;specific artwork&lt;/a&gt;, sending back the Artwork&#39;s &lt;code&gt;id&lt;/code&gt;, &lt;code&gt;additional_information&lt;/code&gt;, &lt;code&gt;is_price_hidden&lt;/code&gt; and &lt;code&gt;is_inquireable&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&#39;s important to note here, the data being sent &lt;em&gt;back&lt;/em&gt; is only what you ask for. This is not defined on the server as a &lt;em&gt;short&lt;/em&gt; or &lt;em&gt;embedded&lt;/em&gt; version of a model, but the specific data the client requested. When bandwidth and speed is crucial, this is the other way in which GraphQL improves the app-user experience.&lt;/p&gt;

&lt;p&gt;That&#39;s the two killer features:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Coalesce Multiple Network Requests. Reducing the amount of network requests that need to be made.&lt;/li&gt;
&lt;li&gt;Only Send The Data You Want. Only sending the data you are interested in.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;With mobile apps you&#39;re working with unreliable, slow networks with high bandwidth costs. Optimising towards less networking with richer data means your app is more resiliant to things outside of your control.&lt;/p&gt;

&lt;p&gt;This is in stark contrast to existing API concepts, like &lt;a href=&quot;http://stateless.co/hal_specification.html&quot;&gt;HAL&lt;/a&gt; and &lt;a href=&quot;http://jsonapi.org&quot;&gt;JSON-API&lt;/a&gt; - both of which are optimised for caching, and rely on &quot;one model, one request&quot; types of API access. E.g. a list of Artworks would actually contain a list of hrefs instead of the model data, and you have to fetch each model as a separate request.&lt;/p&gt;

&lt;h3&gt;Using GraphQL&lt;/h3&gt;

&lt;p&gt;Artsy&#39;s GraphQL server is (unsurprisingly) open-source, it&#39;s at &lt;a href=&quot;https://github.com/artsy/metaphysics&quot;&gt;artsy/metaphysics&lt;/a&gt;. However, it&#39;s not publicly accessible, (&lt;a href=&quot;https://github.com/artsy/metaphysics/issues/279&quot;&gt;yet?&lt;/a&gt;). One of the coolest things about developing against a GraphQL server is GraphiQL - an IDE for exploring your API. I can&#39;t show you ours, but I can send you to &lt;a href=&quot;http://clayallsopp.com&quot;&gt;Clay Allsop&#39;s&lt;/a&gt; &lt;a href=&quot;https://www.graphqlhub.com&quot;&gt;GraphQLHub&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.graphqlhub.com/playground?query=%23%20Hit%20the%20Play%20button%20above!%0A%23%20Hit%20%22Docs%22%20on%20the%20right%20to%20explore%20the%20API%0A%0A%7B%0A%20%20graphQLHub%0A%20%09reddit%20%7B%0A%20%20%20%20user(username%3A%20%22orta%22)%20%7B%0A%20%20%20%20%20%20username%0A%20%20%20%20%20%20commentKarma%0A%20%20%20%20%20%20createdISO%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20subreddit(name%3A%20%22swift%22)%7B%0A%20%20%20%20%20%20newListings(limit%3A%202)%20%7B%0A%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20comments%20%7B%0A%20%20%20%20%20%20%20%20%20%20body%0A%20%20%20%20%20%20%20%20%20%20author%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20username%0A%20%20%20%20%20%20%20%20%20%20%09commentKarma%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D&quot;&gt;Here&lt;/a&gt; ( I strongly recommend pausing to open that link in a new window. Press cmd + enter to see the results. We also have an example of refactoring that request &lt;a href=&quot;https://www.graphqlhub.com/playground?query=%23%20Hit%20the%20Play%20button%20above!%0A%23%20Hit%20%22Docs%22%20on%20the%20right%20to%20explore%20the%20API%0A%0A%7B%0A%20%20graphQLHub%0A%20%09reddit%20%7B%0A%20%20%20%20user(username%3A%20%22orta%22)%20%7B%0A%09%09%09...userFields%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20subreddit(name%3A%20%22swift%22)%20%7B%0A%20%20%20%20%20%20newListings(limit%3A%202)%20%7B%0A%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20comments%20%7B%0A%20%20%20%20%20%20%20%20%20%20body%0A%20%20%20%20%20%20%20%20%20%20author%20%7B%20%0A%09%09%09%20%20%20%20%20%20...userFields%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0Afragment%20userFields%20on%20RedditUser%20%7B%0A%20%20username%0A%20%20commentKarma%0A%20%20createdISO%0A%7D&quot;&gt;here&lt;/a&gt;. )&lt;/p&gt;

&lt;p&gt;GraphQL comes with a playground for the API! It&#39;s amazing! Clay called it the &lt;a href=&quot;https://medium.com/the-graphqlhub/graphiql-graphql-s-killer-app-9896242b2125#.6ht6374bq&quot;&gt;&quot;Killer App&quot; of GraphQL&lt;/a&gt; - I&#39;m inclined to concur. I&#39;ve never had API docs this useful. This is built on top of the schema/docs/type reflection APIs inside the GraphQL spec.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/2016-06-19-graphql-for-iOS-devs/graphiql.png&#39;&gt;&lt;img src=&quot;/images/2016-06-19-graphql-for-iOS-devs/graphiql.png&quot; title=&quot;Selection diagram&quot; &gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;h3&gt;How GraphQL Changed How We Write Native Code&lt;/h3&gt;

&lt;h4&gt;View Models&lt;/h4&gt;

&lt;p&gt;Our GraphQL server is owned by the &lt;a href=&quot;http://artsy.github.io/blog/2016/03/28/artsy-engineering-organization-stack/&quot;&gt;web-practice&lt;/a&gt; and the mobile practice also help out occasionally. This ownership distinction is important, an API like this would normally be handled by our platform team.&lt;/p&gt;

&lt;p&gt;Because of Metaphysics&#39; ownership as a &quot;front-end&quot; product, it can contain additional information that is specific to front-end needs. For example, in our first example of a request to our GraphQL server we requested &lt;code&gt;id&lt;/code&gt;, &lt;code&gt;additional_information&lt;/code&gt;, &lt;code&gt;is_price_hidden&lt;/code&gt; and &lt;code&gt;is_inquireable&lt;/code&gt; - only two of these items come from the database. Both is &lt;code&gt;is_price_hidden&lt;/code&gt; and &lt;code&gt;is_inquireable&lt;/code&gt; are derived from the API results on the server.&lt;/p&gt;

&lt;p&gt;This is &lt;em&gt;awesome&lt;/em&gt;, because before a &lt;a href=&quot;https://github.com/artsy/eigen/blob/dac7c80b66b600f9a45aaae6095544fe420f0bbc/Artsy/Views/Artwork/ARArtworkActionsView.m#L310-L362&quot;&gt;lot of this logic&lt;/a&gt; existed in a &lt;a href=&quot;https://github.com/artsy/eigen/blob/dac7c80b66b600f9a45aaae6095544fe420f0bbc/Artsy/Views/Artwork/ARArtworkActionsView.m#L108-L109&quot;&gt;Google Doc&lt;/a&gt; which needed to be re-implemented in 3-4 clients. On the native side we would find we were out-of-date mid-release cycle and needed to rush to catch up.&lt;/p&gt;

&lt;p&gt;So, what does this mean for view models? It lessens the need for them. If you can move a lot of your derived data to the server - this handles the logic that goes in a view model for you. Now it is provided server-side, and is consistent across platforms.&lt;/p&gt;

&lt;p&gt;We&#39;ve not stopped writing view models, but now discussions on them includes &quot;should this move to Metaphysics?&quot;.&lt;/p&gt;

&lt;h4&gt;React Native&lt;/h4&gt;

&lt;p&gt;We&#39;ve already &lt;a href=&quot;https://twitter.com/orta/status/734880605322776576&quot;&gt;shipped one full view controller&lt;/a&gt; in &lt;a href=&quot;https://facebook.github.io/react-native/&quot;&gt;React Native&lt;/a&gt; for our flagship app, &lt;a href=&quot;https://github.com/artsy/eigen/&quot;&gt;Eigen&lt;/a&gt;. The advantages that came from GraphQL were a big part of the discussion around using React Native.&lt;/p&gt;

&lt;p&gt;There will be longer articles on the &quot;why&quot; and &quot;how&quot; we choose to work this way. However, the key thing that we&#39;re excited about in using React Native is Relay. Using Relay, our &lt;a href=&quot;https://github.com/artsy/emission/tree/2ac6e9fc0f85ca81483bcbd6c841841104f07833/lib/components/artist&quot;&gt;views&lt;/a&gt; can declare a fragment of the GraphQL query that each respective &lt;a href=&quot;https://github.com/artsy/emission/blob/2ac6e9fc0f85ca81483bcbd6c841841104f07833/lib/components/artist/biography.js#L60-L69&quot;&gt;view needs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So, in our Artist View Controller, the Biography &quot;View&quot; (&lt;a href=&quot;https://facebook.github.io/react-native/docs/native-components-ios.html&quot;&gt;component&lt;/a&gt;) declares &quot;when I am in the view heirarchy, you need to grab a &lt;code&gt;bio&lt;/code&gt;, and &lt;code&gt;blurb&lt;/code&gt;&quot;&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Relay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createContainer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Biography&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;fragments&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;artist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Relay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;QL&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;fragment&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Artist&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nx&quot;&gt;bio&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nx&quot;&gt;blurb&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Once your views are declaring what data they need, and are acting on that data - you see less of a need to use models.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;GraphQL is having a massive impact in the way that we write our apps. It means we can make much faster mobile apps, as the network is our critical path. Faster apps means happier users, happier users means happier developers. I want to be happy. So I&#39;m thankful that the &lt;a href=&quot;https://github.com/artsy/metaphysics/graphs/contributors&quot;&gt;Web practice&lt;/a&gt; gave GraphQL a try, and &lt;a href=&quot;https://github.com/artsy/metaphysics/pull/243&quot;&gt;welcome&#39;d&lt;/a&gt; &lt;a href=&quot;https://github.com/artsy/metaphysics/pull/313&quot;&gt;us&lt;/a&gt; &lt;a href=&quot;https://github.com/artsy/metaphysics/pull/226&quot;&gt;to&lt;/a&gt; &lt;a href=&quot;https://github.com/artsy/metaphysics/pull/302&quot;&gt;the&lt;/a&gt; &lt;a href=&quot;https://github.com/artsy/metaphysics/issues/2&quot;&gt;party&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Sun, 19 Jun 2016 12:09:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/06/19/graphql-for-mobile/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/06/19/graphql-for-mobile/</guid>
        
        
        <category>eigen</category>
        
        <category>graphql</category>
        
        <category>mobile</category>
        
      </item>
    
      <item>
        <title>Why does my team&#39;s Podfile.lock Podspec checksums change?</title>
        <description>&lt;p&gt;We use CocoaPods, and &lt;a href=&quot;https://github.com/artsy/eigen/issues/418&quot;&gt;we don&#39;t check in our Pods&lt;/a&gt; directory for one of our fastest moving apps, &lt;a href=&quot;https://github.com/artsy/eigen/&quot;&gt;Eigen&lt;/a&gt;. This sometimes can cause an &lt;a href=&quot;https://github.com/artsy/eigen/pull/1464&quot;&gt;interesting data churn&lt;/a&gt; inside the &lt;code&gt;Podfile.lock&lt;/code&gt; when developers have different sha checksums for their Pods. This is weird, what gives?&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h3&gt;What are the Lockfiles?&lt;/h3&gt;

&lt;p&gt;First off, to ensure we&#39;re talking about the same thing, this is our &lt;a href=&quot;https://github.com/artsy/eigen/blob/master/Podfile.lock&quot;&gt;Podfile.lock&lt;/a&gt;. The lockfile is used on &lt;code&gt;pod install&lt;/code&gt; to ensure all the members of your team have the &lt;em&gt;exact same&lt;/em&gt; version of the libraries as each other. Otherwise, with a Podfile like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;ruby&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;platform&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:ios&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;9.3&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;pod&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;AFNetworking/Serialization&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;~&amp;gt; 3.0&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;MyApp&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;A developer running &lt;code&gt;pod install&lt;/code&gt; would get the latest &lt;code&gt;3.x&lt;/code&gt; version, which could be &lt;code&gt;3.1&lt;/code&gt; originally, but then 6 months later they could get &lt;code&gt;3.4&lt;/code&gt; - without a lockfile there is no way to keep track of the specific build. This is why it should always be in your code repo. In the case above my lockfile looks like this:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;yaml&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;PODS&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;AFNetworking/Serialization (3.1.0)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;DEPENDENCIES&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;AFNetworking/Serialization (~&amp;gt; 3.0)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;SPEC CHECKSUMS&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;AFNetworking&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;5e0e199f73d8626b11e79750991f5d173d1f8b67&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;PODFILE CHECKSUM&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;876ceaa409f4ade2b3d58d310dbe026393824bcc&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;COCOAPODS&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;1.0.0.beta.8&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;`&lt;/p&gt;

&lt;h3&gt;What do the Spec Checksums do?&lt;/h3&gt;

&lt;p&gt;With the CocoaPods Master Specs repo, we do our best &lt;a href=&quot;https://github.com/CocoaPods/Specs/pull/12199&quot;&gt;to try&lt;/a&gt; and ensure a write-once repository of Podspecs for the public. However, there are many times when you cannot guarantee that every you have the same version of a Podspec as everyone else in your team.&lt;/p&gt;

&lt;p&gt;So, CocoaPods makes a checksum of the JSON representation of your Podspec and keeps that in the lockfile. You can easily &lt;a href=&quot;https://github.com/CocoaPods/CocoaPods/issues/3371&quot;&gt;replicate&lt;/a&gt; the work to generate a checksum with:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;sh&#39;&gt;&lt;span class=&#39;line&#39;&gt;~/D/MyApp ⏛  pod ipc spec ~/.cocoapods/repos/master/Specs/AFNetworking/3.1.0/AFNetworking.podspec.json  &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; openssl sha1
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;5e0e199f73d8626b11e79750991f5d173d1f8b67
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;h3&gt;So why am I seeing churn?&lt;/h3&gt;

&lt;p&gt;A normal git development flow when working with libraries is to:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Fork a library, change your Podfile to reflect that change&lt;/li&gt;
&lt;li&gt;Make some changes&lt;/li&gt;
&lt;li&gt;Commit them back to the main repo&lt;/li&gt;
&lt;li&gt;Update the Podspec, then make changes bringing your Podfile back to a real (tagged) release&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CocoaPods is smart about updating your libraries behind the scenes, but it&#39;s not perfect. In order to avoid re-creating your entire Pods folder every time it will check whether your libraries are at the expected version and skip re-creating the whole process.&lt;/p&gt;

&lt;p&gt;In the example above, we used the CocoaPods&#39; Specs repo version of the Podspec. In forked repos, e,g,&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;ruby&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;n&quot;&gt;pod&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;AFNetworking/Serialization&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:git&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;https://github.com/orta/AFNetworking.git&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:commit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;6f31b5c7bcbd59d4dac7e92e215d3c2c22f3400e&amp;quot;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;The Podspec is saved into the &lt;code&gt;Pods&lt;/code&gt; directory in JSON format at &lt;code&gt;Pods/Local\ Podspecs/AFNetworking.podspec.json&lt;/code&gt;, this is to ensure there&#39;s always access within the CocoaPods sandbox for the Podspecs, and speed probably. This is the podspec used for generating the checksum.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;So how can this get out of sync?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;During the development cycle, when working with a library you would have used &lt;code&gt;pod update [library]&lt;/code&gt; to update just that library you were working on.  This could happen multiple times as you build your changes.&lt;/li&gt;
&lt;li&gt;You continued working against your fork till it was ready for review. At this point you have a working version, you submit a PR for code review on the library.&lt;/li&gt;
&lt;li&gt;There are changes that affect the podspec that come up in review, you don&#39;t do a &lt;code&gt;pod update [library]&lt;/code&gt; but send the code back to review ( maybe you changed some metadata for example, which doesn&#39;t warrant another update to pass CI. )&lt;/li&gt;
&lt;li&gt;Once all code is reviewed, everything is merged back into master.&lt;/li&gt;
&lt;li&gt;You &lt;code&gt;pod install&lt;/code&gt; - which continues to use the older version of the Podspec inside the Pods dir, e.g. &lt;code&gt;Pods/Local\ Podspecs/AFNetworking.podspec.json&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;You now have the older &lt;code&gt;AFNetworking.podspec.json&lt;/code&gt; inside your local Pods folder, when the next person runs &lt;code&gt;pod install&lt;/code&gt; with your changes merged, they get a different SHA, as they&#39;ve got the version with the metadata changes.&lt;/li&gt;
&lt;/ul&gt;


&lt;h3&gt;Simple Fix&lt;/h3&gt;

&lt;p&gt;The best option is to run &lt;code&gt;pod update [library]&lt;/code&gt; on the computer which is causing churn, this will tell CocoaPods specifically to request a new version of the library. If that fails to give the same checksum as the rest of your team, there&#39;s the good old fasioned &lt;code&gt;rm -rf Pods &amp;amp;&amp;amp;  pod install&lt;/code&gt;.&lt;/p&gt;
</description>
        <pubDate>Tue, 03 May 2016 12:09:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/05/03/podspec-checksums/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/05/03/podspec-checksums/</guid>
        
        
        <category>cocoapods</category>
        
        <category>dependencies</category>
        
        <category>mobile</category>
        
      </item>
    
      <item>
        <title>Using Paw with Per-Developer Settings</title>
        <description>&lt;p&gt;I am a big fan of developer tooling, as spending time upfront on improving your process can pay a lot of dividends over time. I want to talk about one in particular: &lt;a href=&quot;https://luckymarmot.com/paw&quot;&gt;Paw&lt;/a&gt;. Paw is a native HTTP client with a bunch of features. I want to cover one that means that we can now &lt;a href=&quot;https://github.com/artsy/energy/pull/192&quot;&gt;introduce&lt;/a&gt; &lt;code&gt;[AppName].paw&lt;/code&gt; files in our mobile projects, making it easy for us to discuss networking requests.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h3&gt;OK, what is Paw?&lt;/h3&gt;

&lt;p&gt;Paw is a tool that stores collections of API endpoints, along with all the metadata required to call them. We first started using Paw during the creation &lt;a href=&quot;https://github.com/artsy/eidolon/blob/master/Kiosk/Stubbed%20Responses/Me.json&quot;&gt;of Eidolon&lt;/a&gt; as a way to keep track of the auction-related API calls we would need to stub for &lt;a href=&quot;http://cocoapods.org/pods/moya&quot;&gt;Moya&lt;/a&gt;, an iOS networking library that required stubbed data. It made it easy for us to keep track of how all the different API routes work together, and to verify that we were doing things right.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/2016-04-14-Paw/eidolon.png&#39;&gt;&lt;img src=&quot;/images/2016-04-14-Paw/eidolon.png&quot; title=&quot;paw tokens&quot; &gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;We used environment variables to keep track of things we wanted to change, but in using them this way we couldn&#39;t publicise our Paw files, the real versions contained secrets that should stay secret.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-14-Paw/eidolon-env.png&quot; alt=&quot;Environments for Eidolon&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The environment tooling made it easy to change the routes, users and settings easily, but were also the thing keeping us from being able to share the files in source. Because of this, we stopped using Paw to keep track of our routes as we had to ad-hoc share the file over chat.&lt;/p&gt;

&lt;h3&gt;A Second Shot&lt;/h3&gt;

&lt;p&gt;This week, roughly a year and a half later, I started work on a &lt;a href=&quot;https://github.com/artsy/energy/pull/189&quot;&gt;large project&lt;/a&gt; that I knew would involve using new networking APIs. So I took the time to look for ways to interpret what I was going to be working with. After exploring some alternatives, I came back to Paw, and discovered they had a &lt;a href=&quot;https://blog.luckymarmot.com/posts/paw-23-keep-it-secret-keep-it-safe/&quot;&gt;new feature&lt;/a&gt;: Keychain integration. This stopped my search.&lt;/p&gt;

&lt;p&gt;In our iOS projects, as they are all open source, we use &lt;a href=&quot;https://github.com/orta/cocoapods-keys&quot;&gt;CocoaPods-Keys&lt;/a&gt; to ensure that our development configuration secrets are kept safe and outside of the project&#39;s source code. It stores the per-project keys inside a developer&#39;s Keychain. This means they can be accessed from inside the iOS app, but also from the &lt;a href=&quot;/images/2016-04-14-Paw/keychain.png&quot;&gt;developer&#39;s computer&lt;/a&gt; via a determinate location in the Keychain app.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;&#39;&gt;&lt;span class=&#39;line&#39;&gt;~/d/i/a/energy (master) ⏛  bundle exec pod keys
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;Keys for Folio
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  ArtsyAPIClientSecret - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  ArtsyAPIClientKey - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  HockeyAppBetaID - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  HockeyAppLiveID - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  IntercomAppID - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  IntercomAPIKey - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  SegmentProduction - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; ├  SegmentBeta - [***********]
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt; └  SegmentDev - [***********]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This means that we can use CocoaPods-Keys with Paw in order to use the same &lt;code&gt;ArtsyAPIClientSecret&lt;/code&gt; and &lt;code&gt;ArtsyAPIClientKey&lt;/code&gt; environment config variables. Great. This is almost enough to make the first API call to to get an access token.&lt;/p&gt;

&lt;p&gt;I re-used this idea to allow developers to have unique username and passwords. I created two more entries in Keychain, username and &lt;a href=&quot;/images/2016-04-14-Paw/keychain-password.png&quot;&gt;password&lt;/a&gt;. This is something that every developer using our Paw file has to do, otherwise Paw won&#39;t know who to log you in as.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-14-Paw/keychain-username.png&quot; alt=&quot;Keychain Email&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With these all hooked up, I could set up Paw to use all of our Keychain entities:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-14-Paw/paw-adding-keychain.png&quot; alt=&quot;Paw Adding Keychain&quot; /&gt;
&lt;img src=&quot;/images/2016-04-14-Paw/paw-setting-password.png&quot; alt=&quot;Paw Setting Password&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tada! Now I can run my route, and I&#39;ve got an access token to use with our API.&lt;/p&gt;

&lt;h3&gt;Route Resolving&lt;/h3&gt;

&lt;p&gt;Automating the route to get an access token is the first step because Paw allows you to use the output of one route inside any new route. I&#39;ll show you, then talk it through.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/2016-04-14-Paw/paw-tokens.png&#39;&gt;&lt;img src=&quot;/images/2016-04-14-Paw/paw-tokens.png&quot; title=&quot;paw tokens&quot; &gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;I made it so that my new request ( for the route &lt;code&gt;api/v1/me&lt;/code&gt;)  passes in an header of &lt;code&gt;X-Access-Token&lt;/code&gt;, with the value being the &lt;code&gt;access_token&lt;/code&gt; from the route we just made called &lt;code&gt;Auth&lt;/code&gt;. This means that when the token expires, it will automatically re-generate a new one and we&#39;re never storing the token explicitly inside the Paw file. Our secrets stay secret, and per-developer - I don&#39;t want to know other people&#39;s passwords.&lt;/p&gt;

&lt;p&gt;Once those two routes were set up, it was a matter of looking up what routes I would need and added them to the paw file for the project. I used the group system to make it easy to show / hide sections, and experimented with using environments to differentiate between staging and production servers. Not quite figured that yet.&lt;/p&gt;

&lt;h3&gt;Wrap up&lt;/h3&gt;

&lt;p&gt;It&#39;s easier to talk about your API when any other developer can open this one file and shoot off requests at the same time as you. One of my favourite nice-touches is to be able to easily convert any request into a cURL command.&lt;/p&gt;

&lt;p&gt;I am using this event as a reminder to myself that tools evolve, and maybe your first impression on a developer tool may require re-interpreting in light of software evolution.&lt;/p&gt;
</description>
        <pubDate>Thu, 14 Apr 2016 12:09:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/04/14/net-working-with-paw/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/04/14/net-working-with-paw/</guid>
        
        
        <category>development</category>
        
        <category>mobile</category>
        
        <category>web</category>
        
      </item>
    
      <item>
        <title>Using Xcode&#39;s Schemes to run a subset of your tests</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://github.com/artsy/eigen&quot;&gt;Eigen&lt;/a&gt; has hit the point where testing is a chore. This is a positive sign, the app has grown in terms of size, complexity, and number of developers considerably over the last 3 years. The test suite makes us feel comfortable making changes.&lt;/p&gt;

&lt;p&gt;On my fastest computer, we&#39;re just under a minute - &lt;code&gt;Executed 1105 tests, with 1 failure (0 unexpected) in 43.221 (48.201) seconds&lt;/code&gt;  for the whole suite. I think I could probably live with 20 seconds max. So I studied how &lt;a href=&quot;https://www.jetbrains.com/objc/&quot;&gt;AppCode&lt;/a&gt; handles running tests, and this will be an illustrated guide as to how you can easily run the subset of tests in Xcode based on their techniques.&lt;/p&gt;

&lt;p&gt; I &lt;a href=&quot;https://github.com/orta/life/issues/71&quot;&gt;have ideas&lt;/a&gt; on how to improve time for testing in general, based on &lt;a href=&quot;http://artsy.github.io/blog/2016/03/05/iOS-Code-Injection/&quot;&gt;Code Injection&lt;/a&gt;, but they aren&#39;t fully fleshed out and I expect it to be time-intensive to pull off. Time I haven&#39;t made yet.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h3&gt;What are Schemes?&lt;/h3&gt;

&lt;blockquote&gt;&lt;p&gt;An Xcode scheme defines a collection of targets to build, a configuration to use when building, and a collection of tests to execute.&lt;/p&gt;

&lt;p&gt;You can have as many schemes as you want, but only one can be active at a time. You can specify whether a scheme should be stored in a project—in which case it’s available in every workspace that includes that project, or in the workspace—in which case it’s available only in that workspace. When you select an active scheme, you also select a run destination (that is, the architecture of the hardware for which the products are built).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To &lt;a href=&quot;https://developer.apple.com/library/ios/featuredarticles/XcodeConcepts/Concept-Schemes.html&quot;&gt;quote Apple&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Hatching a Scheme&lt;/h3&gt;

&lt;p&gt;The Eigen Test Suite is around 50 test classes, these look a bit like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/tests.png&quot; alt=&quot;Tests&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Before you start, you want to be able to say, &quot;I want to only run tests for the Fairs section of Eigen&quot;, as that is where I will be working for the next few days. To get started, I need to create a new Scheme. You will have seen the schemes before when you click on the Target side of this Targer/Sim button in the top left of Xcode.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/empty_scheme.png&quot; alt=&quot;Empty Scheme&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is what it looks like on mine, we want to create a new scheme. This brings up a modal window where you need to choose your App&#39;s target (this is so you can continue running by pressing &lt;code&gt;cmd + r&lt;/code&gt;.)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/new_scheme.png&quot; alt=&quot;New Scheme&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I&#39;ve called mine &quot;Artsy just for Fairs&quot;, as I&#39;m the only person who would see it, I can name it whatever I want. Clicking &quot;OK&quot; selects it, and hides the modal. You now need to go back to the target selector, and go to &quot;Edit Schemes ...&quot; to continue though.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/edit_schemes.png&quot; alt=&quot;Edit Schemes&quot; /&gt;&lt;/p&gt;

&lt;h3&gt;Making Amends&lt;/h3&gt;

&lt;p&gt;OK, click on &quot;Test&quot; in the sidebar, and now you&#39;re in the Schemes Test editor. This is where you do the work.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/empty_edit_schemes.png&quot; alt=&quot;Empty Edit Schemes&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You need to hit the &quot;+&quot; in order to add your Test Target to the Scheme&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/test_scheme.png&quot; alt=&quot;Test Scheme&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Select and &quot;Add&quot; you Targets. This adds the target, you then need to click the disclosure arrow in order to show all the Test Classes.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;OK, here&#39;s some magic&lt;/em&gt;. Hold &lt;code&gt;alt&lt;/code&gt; and click on the blue tickbox to the right of your test target to turn it off. Then click again, without &lt;code&gt;alt&lt;/code&gt;. It should then deselect all of the classes. This is standard in all Mac apps, so go wild there.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/deselect_all.png&quot; alt=&quot;Deselect All&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This means you can go find the classes you do want to run, in my case that is the Test Classes relating to Fairs.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-04-06-Testing-Schemes/just_the_good_tests.png&quot; alt=&quot;Just The Good Tests&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now when I press &lt;code&gt;cmd + u&lt;/code&gt; it will only run those test classes.&lt;/p&gt;

&lt;h3&gt;Wrapping Up&lt;/h3&gt;

&lt;p&gt;Which means I can now get back to work at a reasonable pace. &lt;code&gt;Executed 15 tests, with 0 failures (0 unexpected) in 0.277 (0.312) seconds&lt;/code&gt;. I can then run the full suite whenever I go and make a cup of tea.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; If you want to avoid using the mouse to change scheme, the &lt;a href=&quot;/images/2016-04-06-Testing-Schemes/next_prev.png&quot;&gt;key commands&lt;/a&gt; to change between visible schemes is &lt;code&gt;cmd + ctrl + [&lt;/code&gt; and  &lt;code&gt;cmd + ctrl + ]&lt;/code&gt;.&lt;/p&gt;
</description>
        <pubDate>Wed, 06 Apr 2016 12:09:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/04/06/Testing-Schemes/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/04/06/Testing-Schemes/</guid>
        
        
        <category>mobile</category>
        
        <category>xcode</category>
        
      </item>
    
      <item>
        <title>Artsy&#39;s Engineering Organization Stack, 2016</title>
        <description>&lt;div style=&quot;max-width: 50%; text-align: center; float: right; padding: 0 0 10px 10px; line-height: 1;&quot;&gt;&lt;img src=&quot;/images/2016-03-28-artsy-engineering-organization-stack/stack.jpg&quot;&gt;&lt;br&gt;&lt;font size=&quot;2px&quot;&gt;&lt;em&gt;The Artsy Engineering Organization &quot;Stack&quot; in 2012&lt;br&gt;from &lt;a target=&quot;_blank&quot; href=&quot;http://code.dblock.org/2011/07/12/sitting-is-killing-you-move-to-new-york.html&quot;&gt;&quot;Sitting is Killing You? Move to New York&quot;&lt;/a&gt;&lt;/em&gt;&lt;/font&gt;&lt;/div&gt;


&lt;p&gt;Artsy has now grown past 140 team members and our Engineering organization is a nimble 25. We&#39;ve recently performed a large organizational change (I highly recommend reading &lt;a href=&quot;https://www.artsy.net/article/robert-lenne-the-secret-s-to-company-re-orgs&quot;&gt;&quot;The Secret(s) to Company Re-Orgs&quot;&lt;/a&gt;), so this is a good time to describe our updated Engineering organization, starting from the top - Artsy as a company and business.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h2&gt;The Company&lt;/h2&gt;

&lt;p&gt;Artsy’s mission is to make all the world’s art accessible to anyone with an Internet connection. We are a resource for art collecting and education. Artsy features the world’s leading galleries, museum collections, foundations, artist estates, art fairs, and benefit auctions, all in one place. Our growing database of 350,000 images of art, architecture, and design by 50,000 artists spans historical, modern, and contemporary works, and includes the largest online database of contemporary art. Artsy is used by art lovers, museum-goers, patrons, collectors, students, and educators to discover, learn about, and collect art.&lt;/p&gt;

&lt;h2&gt;The Artsy Businesses&lt;/h2&gt;

&lt;p&gt;Artsy has 3 businesses: &lt;em&gt;Listings&lt;/em&gt;, &lt;em&gt;Marketplace&lt;/em&gt; and &lt;em&gt;Content&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Listings&lt;/strong&gt;: Artsy &lt;a href=&quot;https://www.artsy.net/galleries&quot;&gt;gallery partners&lt;/a&gt; pay a flat monthly subscription fee to list an unlimited number of artworks for sale, plus a host of other benefits. They do not pay a commission fee on sales made through Artsy.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Marketplace&lt;/strong&gt;: In 2015 Artsy expanded into hosting commercial auctions on our platform. Much like our Listings business, we work with top auction houses. The latter pay commissions from sales. Check out &lt;a href=&quot;https://www.artsy.net/auctions&quot;&gt;current auctions on Artsy&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Content&lt;/strong&gt;: We are also working on making Artsy a go-to platform for brands to co-create and distribute content that engages a global arts and culture audience. In 2015 we debuted our first sponsored content feature on Artsy, a &lt;a href=&quot;https://www.artsy.net/venice-biennale-2015&quot;&gt;series of 11 educational short films about the Venice Biennale in partnership with UBS&lt;/a&gt; (if anything, &lt;a href=&quot;https://www.artsy.net/article/artsy-editorial-behind-the-venice-biennale-2015-a-short-history-of-the-world-s-most-important-art-exhibition&quot;&gt;watch this amazing video&lt;/a&gt;).&lt;/p&gt;

&lt;h2&gt;A Product Engineering Organization&lt;/h2&gt;

&lt;p&gt;We think of &lt;em&gt;Engineering&lt;/em&gt; as a service of the &lt;em&gt;Product&lt;/em&gt; organization. Products serve customers and product teams serve businesses. Each product team may contribute to one or several businesses. To make our goals crystal clear, we developed Key Performance Indicators (KPIs) for each business. For example, &lt;em&gt;churn&lt;/em&gt; is a KPI for the Listings business - a low churn shows how well we&#39;re serving our existing subscribers. Furthermore, we designed each product team to own all necessary resources to accomplish their goals. In some ways, our product teams operate like small start-ups.&lt;/p&gt;

&lt;p&gt;Each product team consists of one or more &lt;em&gt;Business People&lt;/em&gt;, a &lt;em&gt;Product Owner&lt;/em&gt; (often a &lt;em&gt;Product Manager&lt;/em&gt;), a &lt;em&gt;Designer&lt;/em&gt;, an &lt;em&gt;Engineering Lead&lt;/em&gt; and several &lt;em&gt;Engineers&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Our product teams map directly into our businesses and inherit the same KPIs.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Partner Success&lt;/strong&gt;: The Partner Success team focuses on products that serve the Listings business. These include our Content Management system and &lt;a href=&quot;http://folio.artsy.net&quot;&gt;Artsy Folio&lt;/a&gt;, an iPad app used by our partners.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Auctions&lt;/strong&gt;: The Auctions product team builds all auction systems across web and mobile.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Collector GMV&lt;/strong&gt;: GMV stands for &lt;em&gt;Gross Merchandising Volume&lt;/em&gt;, a measure of artworks traded on the platform. We have two collector product teams, web and mobile, focused on various customer experiences across all our web and mobile properties.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Publishing&lt;/strong&gt;: The publishing team works on the platform used to produce and distribute all our online editorial content.&lt;/p&gt;

&lt;h2&gt;Practices&lt;/h2&gt;

&lt;p&gt;While there&#39;re many advantages of product teams operating independently, it&#39;s also very easy to create vertical inefficiencies. Multiple teams could choose to achieve similar outcomes in many different ways, creating a lot of redundant work and making it impossible for team members to move between organizations.&lt;/p&gt;

&lt;p&gt;To address this problem we&#39;ve created a separate &lt;em&gt;Platform Engineering Team&lt;/em&gt; and &lt;em&gt;Practices&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The Platform Engineering Team is responsible for systems and shared infrastructure that help product teams work smarter, scale our operations, and much more. Our &lt;em&gt;Design&lt;/em&gt; team is similar in nature to Platform Engineering, creating a consistent visual language and user experience across all products.&lt;/p&gt;

&lt;p&gt;Our &lt;em&gt;Practices&lt;/em&gt;, specifically &lt;em&gt;Web&lt;/em&gt; and &lt;em&gt;Mobile&lt;/em&gt;, are run by a handful of experienced Engineers working independently and floating between product teams to build features, while evangelizing best practices of making software or our &lt;a href=&quot;http://artsy.github.io/open-source&quot;&gt;commitment to open-source&lt;/a&gt; at the same time. Engineerers on product teams may also belong to a practice - mobile engineers on the Auctions team are members of the Mobile practice, but don&#39;t report to the Director of Mobile.&lt;/p&gt;

&lt;h2&gt;Reporting Structure&lt;/h2&gt;

&lt;p&gt;We believe that in order to help our team members grow professionally, their manager must understand their work. Engineers report to Engineering Leads in product teams. Engineering and Engineering Practice Leads report to the Head of Engineering. Product Managers report to the Head of Product. Designers report to the Design Lead, who reports to the Head of Product. It&#39;s important to note that, while preserving top-down authority and responsibility, we try to practice bottom-up leadership - the job of team leads is to help individual contributors do their best work.&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We have a very complex business, and we think our structure works well for a company that does many things at once. Your mileage may vary, so don&#39;t try to apply the same structure in your company just because this works for us! And always remember that evolving an organization is a disruptive process. It may yield better focus and can be transformational to a group. It may also produce the opposite effect, since moving individuals between teams is much more involved than drag-and-dropping a headcount in an organizational chart.&lt;/p&gt;
</description>
        <pubDate>Mon, 28 Mar 2016 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/03/28/artsy-engineering-organization-stack/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/03/28/artsy-engineering-organization-stack/</guid>
        
        
        <category>people</category>
        
      </item>
    
      <item>
        <title>Public Speaking - Part 2: Where To Start?</title>
        <description>&lt;p&gt;So you’ve decided &lt;a href=&quot;http://artsy.github.io/blog/2016/03/09/public-speaking-part1-is-it-for-me/&quot;&gt;you’d like to give speaking a go&lt;/a&gt;, or perhaps you were always interested. By now you’re probably wondering where to start.&lt;/p&gt;

&lt;p&gt;There are various options depending on what you’re looking for. Would you prefer a smaller, intimate audience or would you like to reach far and wide? Is the topic of your choice suited for a quick talk or would you rather discuss it at length? Let’s have a look.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h3&gt;In-house / Workplace Knowledge Share&lt;/h3&gt;

&lt;p&gt;Lots of workplaces dedicate some time to knowledge sharing nowadays (and if yours doesn’t, see if you can start one!). They can be technical, for instance at Artsy we host a technical Lunch and Learn weekly. They could also be on any topic, like &lt;a href=&quot;https://www.artsy.net/article/natalia-maldonado-introduction-to-office-meditation-5-steps-to-peace-of-mind-at-work&quot;&gt;meditation&lt;/a&gt;. Anywhere between 5 and 15 minutes in length is common, and they are a perfect opportunity to talk about things you know well. This could be centred around your day to day work, spreading the knowledge to decrease &lt;a href=&quot;https://en.wikipedia.org/wiki/Bus_factor&quot;&gt;the bus factor&lt;/a&gt;, or something from your personal life. I’ve given a talk on &lt;a href=&quot;https://speakerdeck.com/mennenia/colour-theory&quot;&gt;colour theory in painting&lt;/a&gt; once.&lt;/p&gt;

&lt;p&gt;If you have a workplace you feel comfortable at, this is definitely a good place to start.&lt;/p&gt;

&lt;p&gt;One of the key elements in public speaking that is often forgotten is the fact that the audience wants you to succeed. They’re not there to poke holes or boo you off stage. They are curious to see what you have to say and learn from you. Give them that opportunity.&lt;/p&gt;

&lt;p&gt;Even if your goal is towards speaking at bigger events, any chance at practicing and putting together a well flowing talk is good and shouldn’t be ignored.&lt;/p&gt;

&lt;h3&gt;Local meet-ups&lt;/h3&gt;

&lt;p&gt;If you’re in a city that has a thriving meet-up scene, you may want to put your name forward to speak on a certain topic. A UK meet-up, &lt;a href=&quot;http://www.meetup.com/NSLondon/&quot;&gt;NSLondon&lt;/a&gt;, is a great example of this. Many different members of the community have spoken, and it’s created a lovely atmosphere where it feels like you’re exchanging interesting tidbits of information continuously. Also for newcomers it’s created a welcoming atmosphere, as the people speaking are often people they know or “just like them”.&lt;/p&gt;

&lt;p&gt;If you have a meet-up with a similar positive vibe, there’s no reason not to have a chat with the organisers and see what the next steps would be. It might even be well worth practicing a talk here, for when you’ve got a bigger event coming up and you would like feedback. Bare in mind, the audience wants you to succeed!&lt;/p&gt;

&lt;p&gt;Sidenote — if your city does not (yet) have a great meet-up, it’s well worth starting one.&lt;/p&gt;

&lt;h3&gt;Conferences&lt;/h3&gt;

&lt;p&gt;Often considered the most intimidating of all. People have purchased tickets and possibly travelled from far. The audience is usually in the hundreds, occasionally even more than a thousand. Even the most experienced speakers can get a bit nervous for this.&lt;/p&gt;

&lt;p&gt;Funnily enough, my first ever talk, since starting out as a developer, was at a &lt;a href=&quot;http://www.iosdevuk.com/&quot;&gt;conference&lt;/a&gt;. It happened to have a very friendly atmosphere and really wasn’t that scary. I can’t stress enough that, yes, the audience wants you to succeed. I remember talking through my introduction and seeing all the curious, attentive faces. They were there because they were interested. They cared for what I had to say.&lt;/p&gt;

&lt;p&gt;I will say that this doesn’t necessarily mean you should go talk about anything your heart desires. Ultimately the attendees are there to learn, so it’s only fair that as speakers you’d tailor your presentation towards your audience. But more on that in Part 3.&lt;/p&gt;

&lt;p&gt;To be considered, often conference organisers ask people to submit a CfP (Call for Papers / Call for Proposals). This is your chance to submit details on what you’d like to present on, although they may &lt;a href=&quot;http://www.osfeels.com/talk-ideas/&quot;&gt;give you suggestions&lt;/a&gt;. You usually want to include a preliminary talk title, an abstract, and a bit of background on yourself. If you’ve done any talks before and they happen to have been recorded, it’s worth including the video or otherwise previous slidedecks.&lt;/p&gt;

&lt;p&gt;As for how CfPs then get chosen depends on the conference. Most of the time the organisational committee selects talks from the proposal list. Some conferences have &lt;a href=&quot;http://www.altconf.com&quot;&gt;an independent panel&lt;/a&gt; review anonymised proposals or have a system in place where &lt;a href=&quot;http://cfp.uikonf.com/about&quot;&gt;the community votes&lt;/a&gt;. Once it’s been decided, they will get back in touch with you.&lt;/p&gt;

&lt;p&gt;Usually conferences are swarmed with CfPs so please don’t be discouraged if it takes a few tries to get picked. It’s understandable to feel rejected and give up, but bare in mind that a friend of mine felt this way yet kept applying. He got his break at NSSpain 2014, and now is incredibly active in the &lt;a href=&quot;http://www.meetup.com/swift-language/&quot;&gt;San Francisco Swift&lt;/a&gt; meet-up scene. All of this got the ball rolling and now he&#39;s given talks all around the world. &lt;a href=&quot;https://twitter.com/simjp&quot;&gt;You might even have heard of him&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Lightning talks&lt;/h3&gt;

&lt;p&gt;If a CfP is a bit too much to prepare at the moment (we’re all busy) or you didn’t get in, another option is to give a lightning talk if the conference of your choice has slots. When done well, they are great.&lt;/p&gt;

&lt;p&gt;A lightning talk is usually capped at 5 minutes, and gives you the time and space to cover one thing well. The best ones I’ve heard, have had one main message to convey and did so excellently.&lt;/p&gt;

&lt;p&gt;They require a bit of planning as you &lt;a href=&quot;http://quoteinvestigator.com/2012/04/28/shorter-letter/&quot;&gt;want to be concise&lt;/a&gt;, but will be done before you know it and gives the audience a great point of reference to engage with you. Not to mention that sometimes you might get asked to do a full talk based off these.&lt;/p&gt;

&lt;h3&gt;Preparing content&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://artsy.github.io/blog/2016/03/09/public-speaking-part1-is-it-for-me/&quot;&gt;Choosing to publicly speak&lt;/a&gt; and where is only half the battle. Deciding the content, formulating an abstract, talk title, and slides are not trivial. But fear not, Part 3 in this series will have you covered. Stay tuned!&lt;/p&gt;
</description>
        <pubDate>Mon, 14 Mar 2016 11:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/03/14/public-speaking-part2-where-to-start/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/03/14/public-speaking-part2-where-to-start/</guid>
        
        
        <category>community</category>
        
        <category>learning</category>
        
        <category>oss</category>
        
        <category>speaking</category>
        
        <category>teaching</category>
        
      </item>
    
  </channel>
</rss>
