<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Artsy Engineering</title>
    <description></description>
    <link>http://artsy.github.io/</link>
    <atom:link href="http://artsy.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 31 Aug 2016 13:16:18 +0000</pubDate>
    <lastBuildDate>Wed, 31 Aug 2016 13:16:18 +0000</lastBuildDate>
    <generator>Jekyll v2.5.3</generator>
    
      <item>
        <title>macOS Keyboard Shortcuts workshop video</title>
        <description>&lt;p&gt;Hey all, I was asked to talk internally about ways in which anyone can improve their day-to-day computer usage. For me, using keyboard shortcuts shows a greater level of control of your machine - and more importantly can be considerably faster.&lt;/p&gt;

&lt;p&gt;I have all of my notes, annotated with images inside a personal GitHub repo: &lt;a href=&quot;https://github.com/orta/keyboard_shortcuts&quot;&gt;orta/keyboard_shortcuts&lt;/a&gt;. We covered:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Pressing menu items via keyboard&lt;/li&gt;
&lt;li&gt;Window Management&lt;/li&gt;
&lt;li&gt;Text Management, e.g. jumping between words etc.&lt;/li&gt;
&lt;li&gt;Searching for text&lt;/li&gt;
&lt;li&gt;Taking Screenshots&lt;/li&gt;
&lt;li&gt;Slack and Chrome&lt;/li&gt;
&lt;li&gt;Using a Window Manager and Clipboard History Manager&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Jump &lt;a href=&quot;https://www.youtube.com/watch?v=1mIRCL_lGbg&quot;&gt;to YouTube&lt;/a&gt; for the video, or click more for a smaller inline preview.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;iframe width=&#39;100%&#39; height=&#39;600&#39; src=&#39;https://www.youtube.com/embed/1mIRCL_lGbg &#39; frameborder=&#39;0&#39; allowfullscreen&gt;&lt;/iframe&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;
</description>
        <pubDate>Wed, 31 Aug 2016 12:09:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/31/Keyboard-Shortcuts-workshop/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/31/Keyboard-Shortcuts-workshop/</guid>
        
        
        <category>video</category>
        
        <category>workshop</category>
        
      </item>
    
      <item>
        <title>On our implementation of React Native</title>
        <description>&lt;center&gt;
 &lt;img src=&quot;/images/emission/emission-logo-artsy.svg&quot; style=&quot;height:300px;&quot;&gt;
&lt;/center&gt;


&lt;p&gt;I arrived fashionably late to the &lt;a href=&quot;/blog/2016/08/15/React-Native-at-Artsy/&quot;&gt;React Native party&lt;/a&gt; in Artsy. I had been a part of our &lt;a href=&quot;/blog/2016/08/09/the-tech-behind-live-auction-integration/&quot;&gt;Auctions Team&lt;/a&gt;, where we worked in Swift with &lt;a href=&quot;https://cocoapods.org/pods/Interstellar&quot;&gt;some light-FRP&lt;/a&gt;. We were not affected by the 4 months of simultaneous work on moving to React Native, at all.&lt;/p&gt;

&lt;p&gt;It was a quiet revolution. I did not have to install &lt;code&gt;npm&lt;/code&gt;, I made zero changes to the code for auctions and the whole app&#39;s infrastructure barely changed. Yet we moved to making all new code inside our 3 year old iOS app use React Native. What gives?&lt;/p&gt;

&lt;p&gt;Well, first up we weren&#39;t planning a re-write, we don&#39;t have that kind of luxury and the scope of our app is too big compared to the team working on it. Second, we reused existing dependency infrastructure to support JavaScript based apps. Read on to find out what that looks like.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h3&gt;Why we were in a good position to do this&lt;/h3&gt;

&lt;p&gt;Let&#39;s talk a little about the Artsy flagship app, &lt;a href=&quot;https://github.com/artsy/eigen/&quot;&gt;Eigen&lt;/a&gt;. It&#39;s an app that aimed to comprehensively cover the art world. From &lt;a href=&quot;https://www.artsy.net/shows&quot;&gt;Shows&lt;/a&gt; to &lt;a href=&quot;https://www.artsy.net/galleries&quot;&gt;Galleries&lt;/a&gt;, &lt;a href=&quot;https://www.artsy.net/art-fairs&quot;&gt;Fairs&lt;/a&gt; to &lt;a href=&quot;https://www.artsy.net/auctions&quot;&gt;Auctions&lt;/a&gt;, &lt;a href=&quot;https://www.artsy.net/institutions&quot;&gt;Museums&lt;/a&gt; to &lt;a href=&quot;https://www.artsy.net/articles&quot;&gt;Magazines&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It all looks a bit like this:&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/emission/eigen-overview.jpg&#39;&gt;&lt;img src=&quot;/images/emission/eigen-overview.jpg&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;Our app neatly splits into two areas of view controllers, ones that act as a browser chrome, and individual view controllers that normally map 1:1 to &lt;a href=&quot;https://github.com/artsy/eigen/blob/master/Artsy/App/ARSwitchBoard.m#L122&quot;&gt;routes&lt;/a&gt; on the Artsy website.&lt;/p&gt;

&lt;p&gt;For example, the route &lt;code&gt;artsy.net/artwork/glenn-brown-suffer-well&lt;/code&gt; maps to the native &lt;code&gt;ARArtworkViewController&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/emission/eigen.svg&#39;&gt;&lt;img src=&quot;/images/emission/eigen.svg&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;Just as a browser knows very little about the individual content of the pages that it&#39;s rendering, the eigen chrome exists &lt;em&gt;relatively&lt;/em&gt; independent of the view controllers that are showing.&lt;/p&gt;

&lt;p&gt;Each view controller also knows very little about each-other, so actions that trigger a new view controller are generally done by creating a string route and passing it through the routing system. I&#39;ve wrote about this pattern in &lt;a href=&quot;https://artsy.github.io/blog/2015/08/15/Cocoa-Architecture-Router-Pattern/&quot;&gt;Cocoa Architecture: Router Pattern&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Interestingly, if the router cannot route a view controller, it will pass through to a web view. This is why we consider the app a &lt;a href=&quot;http://artsy.github.io/blog/2015/08/24/Cocoa-Architecture-Hybrid-Apps/&quot;&gt;hybrid app&lt;/a&gt;. This pattern means adding new view controllers is extremely easy.&lt;/p&gt;

&lt;h3&gt;Introducing Emission&lt;/h3&gt;

&lt;p&gt;Emission is what we use to contain all of our React Native components. Our flagship app Eigen, can depend on and use without needing to bother with the implementation details of React Native. At it&#39;s core, Emission is:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;A node module.&lt;/li&gt;
&lt;li&gt;A CocoaPod.&lt;/li&gt;
&lt;li&gt;An iOS App.&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;The Node Module&lt;/h4&gt;

&lt;p&gt;Emission itself, is a node module. In our case, it is a JavaScript library that exposes 3 JavaScript objects.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cm&quot;&gt;/* @flow */&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;use strict&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Containers&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./lib/containers&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Components&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./lib/components&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Routes&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./lib/relay/routes&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./lib/relay/config&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./lib/app_registry&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;Containers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;Components&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;Routes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Another node project can have Emission as a dependency - then can access our &lt;code&gt;Container&lt;/code&gt;s, &lt;code&gt;Component&lt;/code&gt;s and &lt;code&gt;Route&lt;/code&gt;s. A container is a &lt;a href=&quot;https://facebook.github.io/relay/docs/api-reference-relay-container.html&quot;&gt;Relay container&lt;/a&gt;, a component is a &lt;a href=&quot;https://facebook.github.io/react/docs/component-api.html&quot;&gt;React Component&lt;/a&gt; and a Route is a &lt;a href=&quot;https://facebook.github.io/relay/docs/guides-routes.html#content&quot;&gt;Relay Route&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The thing that&#39;s interesting from the integration side, is that each &lt;code&gt;Container&lt;/code&gt; is effectively a View Controller that Emission provides to a host application. React Native ignores  the concept of view controllers from the Cocoa world, so we have an &lt;a href=&quot;https://github.com/artsy/emission/blob/eb9d0f6ca0edd3eb9f07dd9ff3b8499f095bc45b/Pod/Classes/ViewControllers/ARComponentViewController.m&quot;&gt;ARComponentViewController&lt;/a&gt; which is subclassed for each exposed &lt;code&gt;Component&lt;/code&gt; class.&lt;/p&gt;

&lt;h4&gt;The iOS App&lt;/h4&gt;

&lt;p&gt;The iOS app acts as a host target for the CocoaPod, and provides an instance of an &lt;a href=&quot;https://github.com/artsy/emission/blob/master/Pod/Classes/Core/AREmission.m&quot;&gt;AREmission&lt;/a&gt; object to the view controllers using React Native. The app is nothing special, it is the default app that is created using &lt;code&gt;pod lib create&lt;/code&gt;. We then &lt;a href=&quot;https://github.com/artsy/emission/blob/eb9d0f6ca0edd3eb9f07dd9ff3b8499f095bc45b/Example/Podfile&quot;&gt;use CocoaPods&lt;/a&gt; to bring in React from inside the &lt;code&gt;node_modules/&lt;/code&gt; folder the Emission node module creates.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;AREmission&lt;/code&gt; instance is the intermediary between the host-app (&lt;a href=&quot;https://github.com/artsy/emission/blob/eb9d0f6ca0edd3eb9f07dd9ff3b8499f095bc45b/Example/Emission/AppDelegate.m#L56&quot;&gt;The Emission Example app&lt;/a&gt;, or &lt;a href=&quot;https://github.com/artsy/eigen/blob/41b00f6fe497de9e902315104089370dea417017/Artsy/App/ARAppDelegate%2BEmission.m&quot;&gt;Eigen&lt;/a&gt;.) It has an API for handling routing, and passing authentication credentials into the React Native world.&lt;/p&gt;

&lt;p&gt;We use the example app to do development inside React Native. As of right now, it is simply a tableview that provides a list of view controllers &lt;a href=&quot;https://github.com/artsy/emission/blob/eb9d0f6ca0edd3eb9f07dd9ff3b8499f095bc45b/Example/Emission/AppDelegate.m#L159-L169&quot;&gt;that represent an exposed Container&lt;/a&gt;. Once you are in the right view controller, you can rely on &lt;a href=&quot;http://facebook.github.io/react-native/releases/0.31/docs/debugging.html#automatic-reloading&quot;&gt;Hot Reloading&lt;/a&gt; to simplify your work.&lt;/p&gt;

&lt;h4&gt;The Pod&lt;/h4&gt;

&lt;p&gt;An important part of working with React Native, is that you can choose to use native code when appropriate. The &lt;a href=&quot;https://github.com/artsy/emission/blob/eb9d0f6ca0edd3eb9f07dd9ff3b8499f095bc45b/Emission.podspec&quot;&gt;Pod for&lt;/a&gt; Emission, created entirely in Objective-C, provides:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Communication between React Native and the host app objects via &lt;a href=&quot;https://facebook.github.io/react-native/docs/native-modules-ios.html&quot;&gt;native modules&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;UIViewController&lt;/code&gt; subclasses for Host apps to consume.&lt;/li&gt;
&lt;li&gt;Bridges for existing native views (like our &lt;a href=&quot;https://github.com/artsy/extraction/blob/d6a32186f7098eb2ec5d05e2fb5302a8378eff70/Extraction/Classes/ARSwitchView.m&quot;&gt;SwitchView&lt;/a&gt;) into React Native.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The choice of Objective-C is for simplicity, and language stability. Swift is technically an option, but it&#39;s not  worth the complications for &lt;a href=&quot;https://github.com/artsy/emission/tree/eb9d0f6ca0edd3eb9f07dd9ff3b8499f095bc45b/Pod/Classes&quot;&gt;a few simple objects&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In order to share native views with our host app, Eigen, we created a library to just hold the shared UI components, &lt;a href=&quot;https://github.com/artsy/extraction&quot;&gt;Extraction&lt;/a&gt;. These are &lt;a href=&quot;https://github.com/artsy/extraction/tree/d6a32186f7098eb2ec5d05e2fb5302a8378eff70/Extraction/Classes&quot;&gt;factored out of Eigen&lt;/a&gt;, and into a pod. Emission and Eigen have this as a dependency.&lt;/p&gt;

&lt;h4&gt;Pod Deployment&lt;/h4&gt;

&lt;p&gt;What makes this work well, from the perspective of Eigen is that the React Native comes in atomically. The Podspec &lt;a href=&quot;https://github.com/artsy/emission/blob/master/Emission.podspec#L17-L18&quot;&gt;references&lt;/a&gt; the few native classes, and a single JavaScript file.&lt;/p&gt;

&lt;p&gt;This JavaScript file is the bundled version of all our React Native code. It&#39;s &lt;a href=&quot;https://github.com/artsy/emission/blob/eb9d0f6ca0edd3eb9f07dd9ff3b8499f095bc45b/package.json#L7&quot;&gt;updated  by running&lt;/a&gt; &lt;code&gt;npm run bundle&lt;/code&gt;. This generates both the minified JS, and a source map so that we can transcribe the error reports into the code we write.&lt;/p&gt;

&lt;p&gt;Using the CocoaPod, Emission can provide native view controllers that use React Native under the hood. The host app does not need to know the underlying details like &lt;code&gt;npm&lt;/code&gt;.&lt;/p&gt;

&lt;h3&gt;On Emission&lt;/h3&gt;

&lt;p&gt;Whether this is a pattern other apps can follow is hard to say, we were in a great position to do this. Our app has view controllers that have very little communication with each other and the host app does not need to bridge large amounts of information.&lt;/p&gt;

&lt;p&gt;As ever, our work is open source, and we ensure that anyone can download and run Emission, so if you&#39;d like to understand more, clone &lt;a href=&quot;https://github.com/artsy/emission#reactions--emissions&quot;&gt;artsy/emission&lt;/a&gt; and study the implementation.&lt;/p&gt;
</description>
        <pubDate>Wed, 24 Aug 2016 12:17:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/24/On-Emission/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/24/On-Emission/</guid>
        
        
        <category>eigen</category>
        
        <category>mobile</category>
        
        <category>node</category>
        
        <category>reactnative</category>
        
        <category>tooling</category>
        
      </item>
    
      <item>
        <title>Learn Swift at Artsy, Beginners Lesson Two</title>
        <description>&lt;p&gt;And we&#39;re back! With lesson two of the beginners&#39; Swift-at-Artsy course. To recap, Orta and I &lt;a href=&quot;http://artsy.github.io/blog/2016/01/26/swift-at-artsy/&quot;&gt;led a course at Artsy&lt;/a&gt; to teach our colleagues Swift &lt;em&gt;last&lt;/em&gt; August, and we&#39;re doing it again. I&#39;m leading the stream for people who&#39;ve never programmed before.&lt;/p&gt;

&lt;p&gt;Yesterday was lesson two and I have a &lt;a href=&quot;https://youtu.be/EBtzqx1YRBg&quot;&gt;screen recording&lt;/a&gt; of my walkthrough of &lt;a href=&quot;https://github.com/artsy/Swift-at-Artsy/tree/master/Beginners/Lesson%20Two&quot;&gt;the material&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;iframe width=&#39;100%&#39; height=&#39;600&#39; src=&#39;https://www.youtube.com/embed/EBtzqx1YRBg &#39; frameborder=&#39;0&#39; allowfullscreen&gt;&lt;/iframe&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;
</description>
        <pubDate>Tue, 23 Aug 2016 09:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/23/swift-at-artsy-beginners-lesson-two/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/23/swift-at-artsy-beginners-lesson-two/</guid>
        
        
        <category>code</category>
        
        <category>ios</category>
        
        <category>mobile</category>
        
        <category>oss</category>
        
        <category>swift</category>
        
        <category>teaching</category>
        
        <category>video</category>
        
      </item>
    
      <item>
        <title>Using VS Code for JavaScript</title>
        <description>&lt;center&gt;
 &lt;img src=&quot;/images/vscode/vscode_logo_artsy.svg&quot; style=&quot;width:300px;&quot;&gt;
&lt;/center&gt;


&lt;p&gt;I&#39;m an old school TextMate user, who has also been using Xcode for the last decade. These two sit at a very opposite ends of an &quot;editor&quot; spectrum.&lt;/p&gt;

&lt;p&gt;TextMate is extremely bare bones at the core, but introduced the idea of bundles as plugins. Making it really easy for others to build their own plugins for their own contexts. Xcode on the other-hand includes a 3D scene editor, the best interface builder I&#39;ve seen, super rich debugging tools and close to zero support for improving it yourself.&lt;/p&gt;

&lt;p&gt;As we agreed on moving to React Native, we needed to decide what the team should use for &lt;a href=&quot;https://github.com/artsy/emission/blob/master/docs/vscode.md&quot;&gt;working in that environment&lt;/a&gt;. After experimentation with many editors, we decided on Microsoft&#39;s &lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;Visual Studio Code&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We wanted to keep a lot of the best features from Xcode, while working in a completely JavaScript environment. For example: debuggers, inline errors, auto-complete, symbol mapping and to ideally have them all inside a single editor.&lt;/p&gt;

&lt;p&gt;Let&#39;s dig into the principals of how Visual Studio Code works, what makes it a better option for us, and what parts of it really shine.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;hr /&gt;

&lt;h3&gt;What is Visual Studio Code?&lt;/h3&gt;

&lt;p&gt;Visual Studio Code (VS Code) is &lt;em&gt;yet another&lt;/em&gt;, JavaScript-based text editor. It&#39;s built atop of GitHub&#39;s &lt;a href=&quot;http://electron.atom.io&quot;&gt;Electron&lt;/a&gt;. Electron is a framework for writing native apps as easy as building websites. It started as a web component for some Microsoft web-service, and eventually evolved into a fully-fledged text editor.&lt;/p&gt;

&lt;h4&gt;IDE - Editor hybrid&lt;/h4&gt;

&lt;p&gt;Visual Studio Code (VS Code) believes that the sweet-spot between and IDE and a plain Text Editor, is somewhere a little bit closer to the IDE side.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/vscode/editors.png&#39;&gt;&lt;img src=&quot;/images/vscode/editors.png&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;This means instead of the Text-Editor style folder based approach, VS Code expects to set up a project structure per-project to start supporting from of the more useful IDE-like features.&lt;/p&gt;

&lt;p&gt;It supports TextMate style plugins (called Extensions) through a controlled, but expanding &lt;a href=&quot;https://code.visualstudio.com/docs/extensions/overview&quot;&gt;extension API&lt;/a&gt;. The extension API work takes an &lt;a href=&quot;https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingXPCServices.html&quot;&gt;Apple-like&lt;/a&gt; approach to ensuring stability by having all extensions run outside of the host process. &lt;a href=&quot;https://code.visualstudio.com/docs/extensions/our-approach&quot;&gt;This approach&lt;/a&gt; ensures any extension crash does not take down the editor.&lt;/p&gt;

&lt;p&gt;It&#39;s also smart about deciding when to load an extension, for example, my &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=Orta.vscode-danger&quot;&gt;Danger&lt;/a&gt; extension will &lt;a href=&quot;https://github.com/orta/vscode-danger/blob/a21ccc101b2b1c1be595b10565bca9c88242fb6f/package.json#L18-L20&quot;&gt;only load&lt;/a&gt; if there is a &lt;code&gt;Dangerfile&lt;/code&gt; in the root of the workspace.&lt;/p&gt;

&lt;p&gt;These two approaches to extensions are specifically aimed at &lt;a href=&quot;https://discuss.atom.io/t/why-is-atom-so-slow/11376&quot;&gt;addressing issues&lt;/a&gt; seen inside Atom, where any user actions can be / are blocked by extensions, and extensions have full-reign to make any change they want. Even on my Mac Pro, there is a noticable lag. I initially assumed this was the &quot;JavaScript tax&quot; for all Electron apps, but VS Code is fast.&lt;/p&gt;

&lt;h3&gt;Making Intellisense&lt;/h3&gt;

&lt;p&gt;By default a JavaScript project does not have a way to provide auto-completion, or in VS Code&#39;s terminology: Intellisense. Trying to make auto-complete based on a &lt;a href=&quot;https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop&quot;&gt;REPL&lt;/a&gt; can only get you so far, because it has to be wary against functions with side-effects. Other alternatives are to build an &lt;a href=&quot;http://jointjs.com/demos/javascript-ast&quot;&gt;AST&lt;/a&gt; from the code, and then introspect that.&lt;/p&gt;

&lt;p&gt;In Xcode the auto-complete tools are powered by the type systems of Objective-C and Swift. This means that you can know the structure of an object, without having to dig inside it, potentially breaking it in the process. Vanilla JavaScript does not have a type system. There are a few root classes though: String, Object, Number etc.&lt;/p&gt;

&lt;p&gt;To work around this problem, VS Code uses &lt;a href=&quot;http://www.typescriptlang.org&quot;&gt;TypeScript&lt;/a&gt; behind the scenes. TypeScript is a language that compiles down to JavaScript which provides a typing structure on top of JavaScript. This is a similar approach to how &lt;a href=&quot;https://flowtype.org&quot;&gt;Flow works&lt;/a&gt; too, which is the language &lt;a href=&quot;https://github.com/artsy/emission/pull/220&quot;&gt;we write React Native&lt;/a&gt; in.&lt;/p&gt;

&lt;p&gt;This can work out really well for your own classes if you are declaring your types, but the npm ecosystem is &lt;em&gt;full&lt;/em&gt; of untyped JavaScript, and a lot of your work is about sitting atop those abstractions. The fix for this is offered via &lt;a href=&quot;http://definitelytyped.org&quot;&gt;DefinitelyTyped&lt;/a&gt; which provides type definitions for popular npm modules. For example here is &lt;a href=&quot;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/redux/redux.d.ts&quot;&gt;one for Redux&lt;/a&gt; - these act like &lt;a href=&quot;https://github.com/artsy/eigen/blob/master/Artsy/App/ARSwitchBoard.h&quot;&gt;header files in Objective-C&lt;/a&gt; - offering inline documentation, and the shape of the object.&lt;/p&gt;

&lt;p&gt;I use an extension to keep these up to date and to have them installed in every project I work in: &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=jvitor83.types-autoinstaller&quot;&gt;Types auto installer&lt;/a&gt;. Here&#39;s an example of auto-complete for &lt;a href=&quot;http://redux.js.org/docs/api/Store.html&quot;&gt;a Redux store&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/vscode/redux.png&#39;&gt;&lt;img src=&quot;/images/vscode/redux.png&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;It&#39;ll also provide information about the parameters, which is a life-saver for me. Having grown up with &lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/Functions.html&quot;&gt;named&lt;/a&gt; &lt;a href=&quot;https://robots.thoughtbot.com/ruby-2-keyword-arguments&quot;&gt;parameters&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/vscode/redux-params.png&#39;&gt;&lt;img src=&quot;/images/vscode/redux-params.png&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;h3&gt;Runtime&lt;/h3&gt;

&lt;p&gt;Using console logs to debug isn&#39;t an acceptable answer when debugging for me anymore. &lt;a href=&quot;http://blog.cleancoder.com/uncle-bob/2016/07/27/TheChurn.html&quot;&gt;That&#39;s churn&lt;/a&gt; that I&#39;m not willing to lose time to. Luckily for me, VS Code supports debugging across many languages.&lt;/p&gt;

&lt;p&gt;It does this by having a generic VS Code &lt;a href=&quot;https://code.visualstudio.com/docs/extensions/example-debuggers&quot;&gt;Debug Protocol&lt;/a&gt; which lets extensions use their own processes to run the debugger. So the ruby debugger runs on the &lt;a href=&quot;https://github.com/rubyide/vscode-ruby#debugger&quot;&gt;&lt;code&gt;ruby-debug-ide&lt;/code&gt;&lt;/a&gt; gem, and for node-based projects it uses the debugger built into node.&lt;/p&gt;

&lt;p&gt;So, here is a common case. I want to start up my web-server, so I need to run &lt;code&gt;npm dev&lt;/code&gt;. I can run this from VS Code:&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/vscode/start.png&#39;&gt;&lt;img src=&quot;/images/vscode/start.png&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;Once that&#39;s running - I can attach a debugger. This is listing all of the available node processes on my computer:&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/vscode/attatch.png&#39;&gt;&lt;img src=&quot;/images/vscode/attatch.png&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;Then I can add a breakpoint, and when it is triggered, I have a full stack trace and REPL. The REPL is very barebones, for example - there&#39;s no auto-complete. However, it&#39;s good for quick exploration. I keep &lt;a href=&quot;https://www.objc.io/issues/19-debugging/lldb-debugging/#printing-objects&quot;&gt;accidentally prefixing&lt;/a&gt; my REPL code with &lt;code&gt;po&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;a href=&#39;/images/vscode/debug.png&#39;&gt;&lt;img src=&quot;/images/vscode/debug.png&quot;&gt;&lt;/a&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;date-container&#39;&gt;&amp;nbsp;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;

&lt;p&gt;The breakpoint works through a &lt;a href=&quot;http://blog.teamtreehouse.com/introduction-source-maps&quot;&gt;source map&lt;/a&gt;, and so the line you expect is the one that you&#39;re working in. That stuff is all pretty magic to me. Good on Microsoft, and the node community for pulling that off.&lt;/p&gt;

&lt;h3&gt;Wrapup&lt;/h3&gt;

&lt;p&gt;I still feel a little bit uncomfortable in JavaScript projects, as a long-time native developer. However feel like VS Code is a nice mix of the freeform &quot;just do something&quot; style of Text Editors, which work across a lot of systems and the tight-knit IDEs that are bound to a specific domain. It can be a bridge between worlds.&lt;/p&gt;

&lt;p&gt;VS Code has become my main editor in Ruby and JavaScript, due to having great support for the projects and being an OSS project which I feel like I can contribute to. No more being &lt;a href=&quot;https://github.com/alcatraz/Alcatraz/issues/475&quot;&gt;locked out&lt;/a&gt; of improving my editor. Awesome!&lt;/p&gt;
</description>
        <pubDate>Mon, 15 Aug 2016 22:17:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/15/vscode/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/15/vscode/</guid>
        
        
        <category>danger</category>
        
        <category>node</category>
        
        <category>reactnative</category>
        
        <category>tooling</category>
        
      </item>
    
      <item>
        <title>Learn Swift at Artsy, Beginners Lesson One</title>
        <description>&lt;p&gt;Last August, Orta and I &lt;a href=&quot;http://artsy.github.io/blog/2016/01/26/swift-at-artsy/&quot;&gt;led a course at Artsy&lt;/a&gt; to teach our colleagues Swift. There were two parallel groups of learners: a &quot;beginners&quot; group who had never coded before, and an &quot;informed&quot; group who already knew how to code. This year, we&#39;re leading the course again with a slight twist: we&#39;re repeating the course for absolute beginners, and we&#39;re introduce a new course for anyone who completed last year&#39;s beginner course.&lt;/p&gt;

&lt;p&gt;We&#39;re really excited both to help new colleagues take their first steps into programming, and to help returning colleagues continue their journey.&lt;/p&gt;

&lt;p&gt;Today was lesson one of the beginner group, and I have a &lt;a href=&quot;https://youtu.be/OLdSg0XpFqA&quot;&gt;screen recording&lt;/a&gt; of my walkthrough of &lt;a href=&quot;https://github.com/artsy/Swift-at-Artsy/tree/master/Beginners/Lesson%20One&quot;&gt;lesson one&#39;s material&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;iframe width=&#39;100%&#39; height=&#39;600&#39; src=&#39;https://www.youtube.com/embed/OLdSg0XpFqA &#39; frameborder=&#39;0&#39; allowfullscreen&gt;&lt;/iframe&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;
</description>
        <pubDate>Mon, 15 Aug 2016 21:18:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/15/swift-at-artsy-beginners-lesson-one/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/15/swift-at-artsy-beginners-lesson-one/</guid>
        
        
        <category>code</category>
        
        <category>ios</category>
        
        <category>mobile</category>
        
        <category>oss</category>
        
        <category>swift</category>
        
        <category>teaching</category>
        
        <category>video</category>
        
      </item>
    
      <item>
        <title>React Native at Artsy</title>
        <description>&lt;center&gt;
&lt;img src=&quot;/images/react-native/artsy_react_logo.svg&quot; style=&quot;width:300px;&quot;&gt;
&lt;/center&gt;


&lt;p&gt;As &lt;a href=&quot;https://github.com/artsy/eigen&quot;&gt;the Artsy iOS app&lt;/a&gt; grew larger, we started hitting pain
points:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;We want to support other future platforms such as Android without creating more teams.&lt;/li&gt;
&lt;li&gt;We want different business teams to work on the app without disrupting each other.&lt;/li&gt;
&lt;li&gt;We want our architecture to evolve in order to increase programmer efficiency.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It took us &lt;a href=&quot;https://github.com/artsy/mobile/issues/22&quot;&gt;about a year&lt;/a&gt; to start resolving these issues.
Ideally, we wanted to find a solution to our architectural issues that would also improve the user
experience. Notably we wanted more efficient networking, due to mobile device constraints.&lt;/p&gt;

&lt;p&gt;It would have been an easy leap to start using Swift and, as a matter of fact, we do use Swift in parts of
our flagship application and entirely in &lt;a href=&quot;http://artsy.github.io/blog/2014/11/13/eidolon-retrospective/&quot;&gt;2 other apps&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, while Swift is a great language, it’s also just that: &lt;em&gt;another&lt;/em&gt; language. It does not do much in terms of new
paradigms that solved our architectural needs, it does not help in terms of cross-platform - as most of our code is
building views and thus very framework specific, and it did not really offer anything in terms of more efficient network
data fetching.&lt;/p&gt;

&lt;p&gt;We&#39;ve seen that the web teams integrate React in their projects with really great results. We&#39;ve been
&lt;a href=&quot;https://github.com/artsy/mobile/issues/22&quot;&gt;paying attention&lt;/a&gt; to React Native since it came out; the solutions provided
by the React ecosystem ticked all of our boxes.&lt;/p&gt;

&lt;p&gt;Six months ago we took the plunge, and last month we formalized that this is the direction we want to go.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;h1&gt;Cons&lt;/h1&gt;

&lt;p&gt;So you decided to read the full post and the first thing you got confronted with is a list of cons… &lt;em&gt;boo&lt;/em&gt;. Let’s just get
these out of the way first, it will only get better afterwards.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Dependencies, dependencies, dependencies, both in libraries and tooling. Once you open this can, you’ll have worms
&lt;em&gt;everywhere&lt;/em&gt; in no time; 593 packages to be exactly, at the time of writing, for a new React Native project. Good luck
maintaining that.&lt;/p&gt;

&lt;p&gt;Having created &lt;a href=&quot;https://cocoapods.org&quot;&gt;a dependency manager&lt;/a&gt;, I’m not afraid of some dependencies and don’t subscribe
to NIH, but the JavaScript community has gone &lt;em&gt;way&lt;/em&gt; overboard for my taste. If, like me, you subscribe to the idea
that dependencies are &lt;em&gt;part&lt;/em&gt; of your application and you want to be able to know what packages are being pulled in so
you can maintain them, then you probably won’t like this aspect very much either.&lt;/p&gt;

&lt;p&gt;I’m not quite sure yet how I feel about this in the long run and what we can do about it, short of trying to get the
maintainers of the packages we directly depend on to accept changes that simplify their dependency graphs.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;As is often the case, error reporting does not always receive the attention it should get. With the amount of tools
and libs that make up the full stack you need to work with, this lack in attention to failure resolution can quickly
cascade into deep rabbit holes.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;React Native is still very young and fast moving. If you don’t like living on the edge (i.e. lots of updating and
dealing with breaking changes) nor have an interest in shaping an unfinished framework, this currently is not for you.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;All Facebook open-source code is made to solve the problems that Facebook has first, thus with young projects you may
well need to put in a bunch of time to make it work for your problem set. React Native provides a lot of basic view
building blocks, but you do lose a lot that you would get with UIKit for free, e.g. &lt;code&gt;UICollectionView&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;However, it is important to note that this is only a heads-up for those that might think they can solve any problem
out-of-the-box; in terms of open-source code I prefer code used in production over other code &lt;em&gt;any&lt;/em&gt; day.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;There are currently many more people trying to get help, with often arguably simple questions in the context of iOS
development, compared to those willing to spend time on answering questions. Most forums I’ve seen suffer from the
tragedy of the commons problem, which can be a real problem if you have incidental framework specific questions, but
jumping to React-Native probably is a complete disaster if you know very little about iOS development yet.&lt;/p&gt;

&lt;p&gt;If you’re not already knowledgable about iOS development, are not motivated to put in the time to learn about the
platform specific details, and think making rich iOS applications with React Native will be a breeze, you’ll
&lt;a href=&quot;http://www.dwotd.nl/2008/06/443-van-een-kouwe-kermis-thuiskomen.html&quot;&gt;come home from a very cold fair&lt;/a&gt; indeed.&lt;/p&gt;

&lt;p&gt;While you can definitely make applications that way, in my experience those often end up not feeling like proper
citizens of the platform they inhibit.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Due to React Natives immaturity, you will not be able to find nuanced post-mortems on the subject. The project
is only at the beginning of the &lt;a href=&quot;https://en.wikipedia.org/wiki/Hype_cycle&quot;&gt;hype cycle&lt;/a&gt;, meaning there is a lot
to gain in writing about how great it is, but less incentive to discuss where it doesn&#39;t work out well.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h1&gt;Pros, why we wanted to use React Native&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;From &lt;a href=&quot;https://facebook.github.io/react/&quot;&gt;the React website&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;React will efficiently update and render just the right components when your data changes.
Build encapsulated components that manage their own state, then compose them to make complex UIs.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The functional model that React introduces that allows you to reason about the state of your views in much simpler
ways has for us been a welcome change that should make it much easier to write decoupled code going forward.&lt;/p&gt;

&lt;p&gt;I’m by no means a functional programming purist, nor do I really care for being one. I found the React/React Native
communities to be very welcome to functional enthusiasts and pragmatists alike, a healthy mix that I find leads to
more productive outcomes.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Relay. From &lt;a href=&quot;https://facebook.github.io/relay/&quot;&gt;its website&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Queries live next to the views that rely on them, so you can easily reason about your app.
Relay aggregates queries into efficient network requests to fetch only what you need.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The clarity this brings to the view codebase - coupled with its smart caching, networking is just ground-breaking.
No more multiple levels of model code in your application that you need to trace, just a single file with
&lt;a href=&quot;https://github.com/artsy/emission/blob/a2e4dbdb/lib/components/artist/header.js#L87&quot;&gt;the view component&lt;/a&gt; &lt;em&gt;and&lt;/em&gt;
&lt;a href=&quot;https://github.com/artsy/emission/blob/a2e4dbdb/lib/components/artist/header.js#L143-L144&quot;&gt;the data it needs&lt;/a&gt;. Neat.&lt;/p&gt;

&lt;p&gt;We do still have ‘view models’, however, those now pretty much all live in
&lt;a href=&quot;http://artsy.github.io/blog/2016/06/19/graphql-for-mobile/&quot;&gt;our GraphQL service&lt;/a&gt;. The added benefit here is that we
share that model logic with Artsy’s other (web) clients.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;“Learn once, write anywhere.” is the neo-cross-platform slogan deployed by React, which is a play on the tried
“Write once, run anywhere.” slogan of yesteryear. The difference being that you can use the same paradigms to create
products on various platforms, rather than pure code-reuse.&lt;/p&gt;

&lt;p&gt;While we haven’t put this to the test yet at Artsy, we do plan to team up people across platforms to implement single
features on each respective platform, rather than having multiple people implement the same feature &lt;em&gt;on their own&lt;/em&gt;.
The hope is that this will lead to better understanding of features and thus the implementations thereof, while still
taking each platform’s unique nature into account. The added benefit would be that people learn to understand and
appreciate those unique platform traits, thus making them more well-rounded engineers.&lt;/p&gt;

&lt;p&gt;In the long run, we hope to extend this way of working as we start work on a React Native Android client.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;While Auto Layout is a great step up from manual frame calculation, most of our views don’t need the granularity that
Auto Layout offers. React Native ditches Auto Layout and instead uses
&lt;a href=&quot;https://en.wikipedia.org/wiki/CSS_Flex_Box_Layout&quot;&gt;flexbox&lt;/a&gt; for its layout. While my head has never been able to
fully wrap around classic CSS, I find that flexbox is an abstraction that nicely fits most of our needs.&lt;/p&gt;

&lt;p&gt;I can definitely imagine situations in which more granularity would be required, however, in those cases we can always
decide to ‘drop down’ to native view code, so I don’t really worry too much about that.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Layout calculations are performed on a background thread, the so-called ‘shadow’ thread. This can make a big
difference when e.g. scrolling through a large complex list view.&lt;/p&gt;

&lt;p&gt;Granted, you &lt;em&gt;can&lt;/em&gt; do this with &lt;code&gt;UIView&lt;/code&gt;, but the pattern is not as ingrained in UIKit thus usually leading to more holistic
replacements such as &lt;a href=&quot;http://asyncdisplaykit.org&quot;&gt;AsyncDisplayKit&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Great separation of declarative view layout (JS, single-threaded) and technical details (native code, multi-threaded).
Because of the hard constraint of having a JS/native bridge, there really is no way to take shortcuts (e.g. spaghetti
code) that in the long run would only lead to technical debt. Constraints are great.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Because there’s very little code that needs to be compiled and how the isolated component nature of React makes it
it very easy to reload code in-process, development velocity lies much higher than with your typical native UIKit-based
development.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;While, as mentioned above, there are definitely issues with the tooling and libs, on the flip-side it is all
open-source software and you &lt;em&gt;can&lt;/em&gt; (officially) dive in and figure it out, unlike e.g. Xcode and UIKit. (Granted, you
still need to deal with these when using React Native, but it can be kept to a minimal surface.)&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Because React Native is still young, fast moving, and open-source, this is a great time to help shape the framework
you’d &lt;em&gt;want&lt;/em&gt; to use.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h1&gt;Things we learned&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;When we started out with React Native, I didn&#39;t want to have to re-write our application in order to take advantage of
the technology. To address this I worked within our existing application structure. We consider the App to
&lt;a href=&quot;https://artsy.github.io/blog/2015/08/24/Cocoa-Architecture-Hybrid-Apps/&quot;&gt;be a browser&lt;/a&gt; of native and web view controllers. So,
we added routes &lt;a href=&quot;http://artsy.github.io/blog/2015/08/19/Cocoa-Architecture-Switchboard-Pattern/&quot;&gt;to our SwitchBoard&lt;/a&gt; for
view controllers which are created in React Native. To the rest of the app, there is no difference between a Swift view controller,
or one with React Native inside.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;All of the React Native code is kept in a completely separate repo, &lt;a href=&quot;https://github.com/artsy/emission&quot;&gt;Emission&lt;/a&gt;, which
when deployed generates a minified version of the JavaScript. This means to build the Artsy iOS app you do not need to have
a JavaScript development environment.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;We reused a lot of our existing native views, starting with loading indicators and native switch views.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;We used new native classes to improve integration, for example the &lt;code&gt;&amp;lt;OpaqueImageView&amp;gt;&lt;/code&gt;
&lt;a href=&quot;https://github.com/artsy/emission/blob/master/lib/components/opaque_image_view.js&quot;&gt;component&lt;/a&gt; is a
&lt;a href=&quot;https://github.com/artsy/emission/tree/master/Pod/Classes/OpaqueImageViewComponent&quot;&gt;native&lt;/a&gt; &lt;code&gt;UIImageView&lt;/code&gt;
subclass that works with our application-wide &lt;a href=&quot;https://cocoapods.org/pods/SDWebImage&quot;&gt;SDWebImage&lt;/a&gt; image cache.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h1&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;To really shine with React Native, you need native experience. JavaScript has not eaten everything yet. However,
you don&#39;t need a team of native experts. For example, we expect to be able to get quite far with Android support based on
our work in React Native, but to make it amazing, we will need someone with history and context in the space.&lt;/p&gt;

&lt;p&gt;This frees up our engineers to widen their &lt;a href=&quot;https://artsy.github.io/blog/2016/01/30/iOS-Junior-Interviews/&quot;&gt;T-shaped skills&lt;/a&gt;,
and to help remove the idea that the mobile team has to be a completely separate team with foreign tools and ideas.&lt;/p&gt;

&lt;p&gt;This is only the tip of the iceberg for our writings about React Native. Follow &lt;a href=&quot;https://twitter.com/ArtsyOpenSource&quot;&gt;@ArtsyOpenSource&lt;/a&gt;
to stay up to date.&lt;/p&gt;
</description>
        <pubDate>Mon, 15 Aug 2016 21:17:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/15/React-Native-at-Artsy/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/15/React-Native-at-Artsy/</guid>
        
        
        <category>eigen</category>
        
        <category>mobile</category>
        
        <category>react</category>
        
      </item>
    
      <item>
        <title>Dev Interviews: Craig Spaeth</title>
        <description>&lt;p&gt;Hello everyone! Orta here, over the summer I&#39;ve started a series of interviews with the entire development team at Artsy. They&#39;re all on different topics, notably around technical and cultural issues. I&#39;ve recorded a few of them already, and will be sporadically releasing them. I&#39;m still getting the hang of editing and recording side of this, so give me some slack.&lt;/p&gt;

&lt;p&gt;Anyway, I&#39;m pumped to introduce the first in the series - &lt;a href=&quot;http://craigspaeth.com/&quot;&gt;Craig Spaeth&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Craig has been at Artsy for 6 years, moving from the first on-site developer to Director of Web. Our interview covered how Artsy&#39;s development team has adapted over time to the changing demands of a growing company. When he joined, Artsy was 6 people, we&#39;re now at ~145 people, ~20 developers and 3 businesses.&lt;/p&gt;

&lt;p&gt;Jump &lt;a href=&quot;https://www.youtube.com/watch?v=-0WK1Ebis3M&quot;&gt;to YouTube&lt;/a&gt; for the video, or click more for a inline video.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;&lt;/div&gt;&lt;/div&gt;&lt;iframe width=&#39;100%&#39; height=&#39;600&#39; src=&#39;https://www.youtube.com/embed/-0WK1Ebis3M &#39; frameborder=&#39;0&#39; allowfullscreen&gt;&lt;/iframe&gt;&lt;div class=&#39;meta-container&#39;&gt;&lt;header&gt;&amp;nbsp;&lt;/header&gt;&lt;/div&gt;&lt;div class=&#39;content-container&#39;&gt;&lt;div class=&#39;entry-content&#39;&gt;&lt;/p&gt;
</description>
        <pubDate>Tue, 09 Aug 2016 12:11:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/09/Dev-Interview-Craig-Spaeth/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/09/Dev-Interview-Craig-Spaeth/</guid>
        
        
        <category>culture</category>
        
        <category>interview</category>
        
        <category>video</category>
        
      </item>
    
      <item>
        <title>The Tech Behind Live Auction Integration</title>
        <description>&lt;p&gt;In late June, the &lt;a href=&quot;https://www.artsy.net/auctions/&quot;&gt;Artsy auctions&lt;/a&gt; team launched our Live Auction Integration (LAI) product. It allows people to participate online in live sales held at auction houses &lt;a href=&quot;https://www.artsy.net/auction-partnerships&quot;&gt;that partner with Artsy&lt;/a&gt;. It was a big project, begun in December, involving both brand new software and extensive integration work with the rest of our systems. This is the first in what will be a series of blog posts discussing the engineering work we did to get a complex product from inception to launch in such a brief time window, with a go-live deadline set in stone weeks in advance. In this, I’ll dig into what we shipped on a high level, as well as some of the overarching technical decisions.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;LAI raised challenges that were novel to our engineering team. The product is a real-time experience from the perspectives of the bidder and the auction house. Producing that experience requires a complex human + computer system. There are two main flows of information: from auction house to bidder, and vice versa. These are mediated by our systems and staff as follows:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;As bids occur in the auction house sale room, an Artsy operator working on-site inputs that activity into a web interface so that online participants can keep track of what’s happening.&lt;/li&gt;
&lt;li&gt;As online participants place bids, our system records those as “prospective bids”, and an Artsy bidding clerk on site at the auction house bids on their behalf in the auction house. As those bids are recognized, they are reflected back to all participants, through the prior flow.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To make this easier to visualize:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-08-09-the-tech-behind-live-auction-integration/Artsy%20Live%20Auction%20Integration%20flow.png&quot; alt=&quot;Artsy Live Auction Integration Flow&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This needs to happen in a tight loop to allow online bidders to be competitive with those in the room and via auction house phone clerks. The architecture and UX of the LAI product were optimized for that goal. In addition, we built the system to integrate with live events hosted by our partners. As the events are outside our direct control, there are many, many ways things can deviate from this idealized flow. We had to carefully account for these situations.&lt;/p&gt;

&lt;p&gt;Where possible, we leveraged our existing auctions technology. But we took the opportunity to upgrade that technology in some places and chose new approaches in others. Meanwhile, we were running the busiest Artsy auction season to date, and we had to ensure that we weren’t disrupting our existing stack. Below, I discuss the pieces of the end-to-end product.&lt;/p&gt;

&lt;h1&gt;The Live user experience&lt;/h1&gt;

&lt;p&gt;When the live auction actually begins, participants and Artsy staff interact with the system with front-end software developed from scratch. Web users (desktop and mobile) and staff use a new, dedicated Artsy Live web application, which is implemented in a project we call Prediction. iOS Artsy App users can also participate with newly developed UX within that app.&lt;/p&gt;

&lt;h2&gt;The web app: Prediction&lt;/h2&gt;

&lt;p&gt;Our bidder and operator web interfaces are implemented in an application we call Prediction, a &lt;a href=&quot;https://medium.com/@mjackson/universal-javascript-4761051b7ae9#.ev1yd3juy&quot;&gt;universal&lt;/a&gt; &lt;a href=&quot;https://facebook.github.io/react/&quot;&gt;React&lt;/a&gt;+&lt;a href=&quot;http://redux.js.org/&quot;&gt;Redux&lt;/a&gt; Javascript app, served from an &lt;a href=&quot;http://expressjs.com/&quot;&gt;Express&lt;/a&gt; server. Using React allowed us to completely share our view layer code for prerendering in the server and making updates in the client.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-08-09-the-tech-behind-live-auction-integration/Prediction%20Bidder%20Screenshot.png&quot; alt=&quot;Prediction Bidder UI&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Keeping our state management and transition code organized with Redux allowed us to achieve a massive amount of reuse of model and controller code between our web interfaces. To solve Redux&#39;s &lt;a href=&quot;http://stackoverflow.com/q/34570758/807674&quot;&gt;async&lt;/a&gt; and &lt;a href=&quot;http://stackoverflow.com/q/34299460/807674&quot;&gt;data conveyance&lt;/a&gt; “problems&quot;, we built an integration layer for React and Redux called &lt;a href=&quot;https://github.com/artsy/react-redux-controller&quot;&gt;React Redux Controller&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-08-09-the-tech-behind-live-auction-integration/Prediction%20Operator%20Screenshot.png&quot; alt=&quot;Prediction Operator UI&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We found the React+Redux approach to model-view-controller app development to be a major win in what it gave us for maintainability, code reuse, easy testability, and the ability to reason about our code.&lt;/p&gt;

&lt;h2&gt;The iOS native app: Eigen&lt;/h2&gt;

&lt;p&gt;For users of the Artsy iOS app, known to our engineering team as &lt;a href=&quot;https://github.com/artsy/eigen&quot;&gt;Eigen&lt;/a&gt;, a touch-optimized LAI experience was coded in Swift. It shares the same app with existing Objective-C code as well as &lt;a href=&quot;https://facebook.github.io/react-native/&quot;&gt;React Native&lt;/a&gt; code used for other aspects of the iOS experience. We considered using React Native for this, but we decided to go with more familiar technology to contain the risk.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-08-09-the-tech-behind-live-auction-integration/Eigen%20Bidder%20Screenshot.png&quot; alt=&quot;Eigen Bidder UI&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Both of these applications interact with our central Artsy back-end service to pull in artist, artwork, and sale metadata when the user enters the auction. These queries are mediated by a &lt;a href=&quot;http://graphql.org/&quot;&gt;GraphQL&lt;/a&gt; middleware service we call &lt;a href=&quot;https://github.com/artsy/metaphysics&quot;&gt;Metaphysics&lt;/a&gt; (also discussed &lt;a href=&quot;/blog/2016/06/19/graphql-for-mobile/&quot;&gt;here&lt;/a&gt;), which vastly simplified the fetching process in the front-end services. But from that point forward, the apps interact with a brand new auction state management system over a bidirectional &lt;a href=&quot;https://en.wikipedia.org/wiki/WebSocket&quot;&gt;WebSocket&lt;/a&gt; API for live updating.&lt;/p&gt;

&lt;h1&gt;The auction state management service: Causality&lt;/h1&gt;

&lt;p&gt;The other recently launched piece of software delivered for LAI was a new auction state management system we call Causality. It processes bids and other auction events, computes the derived state of a sale, and hosts the bidirectional WebSocket API.&lt;/p&gt;

&lt;p&gt;Causality was developed in Scala, using the &lt;a href=&quot;http://doc.akka.io/docs/akka/current/intro/what-is-akka.html&quot;&gt;Akka&lt;/a&gt; technology suite for distributed computing. At its core is an append-only storage engine, based on &lt;a href=&quot;http://doc.akka.io/docs/akka/current/scala/persistence.html&quot;&gt;Akka Persistence&lt;/a&gt;, with a small library we developed called &lt;a href=&quot;https://github.com/artsy/atomic-store&quot;&gt;Atomic Store&lt;/a&gt; that allowed us to achieve strict consistency, at the cost of maximal throughput -- a trade-off that is explored in the readme of that project.&lt;/p&gt;

&lt;p&gt;Lastly, Causality has an &lt;a href=&quot;http://doc.akka.io/docs/akka/current/scala/http/introduction.html&quot;&gt;Akka HTTP&lt;/a&gt;-based API layer, with a WebSocket server implemented using &lt;a href=&quot;http://doc.akka.io/docs/akka/current/scala/stream/stream-introduction.html&quot;&gt;Akka Streams&lt;/a&gt;. Asynchronous updates generated in the event processing logic are published across the cluster using &lt;a href=&quot;http://doc.akka.io/docs/akka/current/scala/distributed-pub-sub.html&quot;&gt;Akka Distributed Pub/Sub&lt;/a&gt;, and they are merged into the WebSocket outflow.&lt;/p&gt;

&lt;h1&gt;Pre-bidding, tooling, and other concerns&lt;/h1&gt;

&lt;p&gt;In addition to accepting bids placed during a live sale, we also allow users to place bids before the event begins. In practice, this is almost the same workflow as our existing timed auction experience. For this reason, we chose to leverage all of our existing technology. The work of preparing our preexisting tech for LAI involved widespread modifications to our front-end UI, messaging services, admin tooling, and monitoring to make them appropriate for a live sale, as well as a reliable handoff of responsibility from these preexisting front- and back-end services to the new ones at the time the sale goes live.&lt;/p&gt;

&lt;p&gt;We relied on our automated test suites, as well as thorough manual testing by the entire Artsy auctions team, to ensure that this handoff functioned smoothly under various circumstances. We will eventually eliminate this duplication. But this will require delicate refactoring of our preexisting tooling, which we will take on, even as we execute a fall auction season significantly busier than the last.&lt;/p&gt;

&lt;h1&gt;Reflection&lt;/h1&gt;

&lt;p&gt;In the process of architecting our LAI product, we had to make some tough decisions in the face of new challenges. Chief among these were the decisions on where on the spectrum of bleeding-edge technology versus tried-and-true choices to land, for many of our subcomponents. Bleeding-edge tech often offers more elegant and performant solutions, but at the cost of learning curve and risk of immaturity. We also had to carefully prioritize functionality. Choosing wisely througout the process was critical to shipping on time. The rationale behind these decisions and their outcomes will be the result of future pieces.&lt;/p&gt;

&lt;p&gt;To close, I want to express huge thanks to the auctions product &amp;amp; engineering team for putting in long hours to design, implement, and troubleshoot the software; the auctions arts team for providing the domain knowledge and operational feedback; and our broader Artsy engineering team, at least half of whom directly contributed code to this effort.&lt;/p&gt;
</description>
        <pubDate>Tue, 09 Aug 2016 11:30:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/08/09/the-tech-behind-live-auction-integration/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/08/09/the-tech-behind-live-auction-integration/</guid>
        
        
        <category>akka</category>
        
        <category>architecture</category>
        
        <category>auctions</category>
        
        <category>engineering</category>
        
        <category>javascript</category>
        
        <category>launch</category>
        
        <category>lifecycle</category>
        
        <category>react</category>
        
        <category>redux</category>
        
        <category>scala</category>
        
        <category>swift</category>
        
      </item>
    
      <item>
        <title>Handling Large OSS Projects Defensively</title>
        <description>&lt;p&gt;I help maintain big OSS projects: from a third-party &lt;a href=&quot;https://cocoapods.org&quot;&gt;dependency manager&lt;/a&gt; used in most iOS apps (&lt;a href=&quot;https://github.com/CocoaPods/cocoapods.org&quot;&gt;CocoaPods&lt;/a&gt;), to the most popular Objective-C &lt;a href=&quot;http://cocoapods.org/pods/Specta&quot;&gt;testing framework&lt;/a&gt; and the most popular Swift &lt;a href=&quot;http://cocoapods.org/pods/Moya&quot;&gt;networking API client&lt;/a&gt;. I&#39;ve been doing this for years.&lt;/p&gt;

&lt;p&gt;Projects with this much impact are big time-sinks. This time comes from ensuring infrastructure continues to work, support tickets need replies, new code needs reviewing and releases need coordinating.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-07-03-big-oss/danger_logo_black@2x.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Last September, almost a year ago, I started work on a new project, &lt;a href=&quot;https://github.com/danger/danger/&quot;&gt;Danger&lt;/a&gt;. Danger fixes a problem we were seeing in the Artsy mobile team around adding &quot;&lt;a href=&quot;https://github.com/artsy/mobile/issues/31&quot;&gt;process&lt;/a&gt;&quot; to our team.&lt;/p&gt;

&lt;p&gt;As a part of discussing Danger internally, I&#39;ve referenced that building CocoaPods has greatly influenced Danger. This blog post is about the way I&#39;ve built Danger, knowing fully well that I cannot afford the level of time to maintain it at the scale it may get to.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;hr /&gt;

&lt;p&gt;Danger is a project that could end up with a lot more users than CocoaPods. So I want to be cautious about how I create the community around Danger. If you&#39;re interested in some of the baseline setup required to run a popular project, the post &quot;&lt;a href=&quot;https://ashfurrow.com/blog/building-popular-projects/&quot;&gt;Building Popular Projects&lt;/a&gt;&quot; by &lt;a href=&quot;/author/ash&quot;&gt;Ash&lt;/a&gt; is a great place to start, this builds on that.&lt;/p&gt;

&lt;p&gt;My maintenance time on CocoaPods resolves around:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Handling new issues&lt;/li&gt;
&lt;li&gt;Keeping infrastructure running&lt;/li&gt;
&lt;li&gt;Requests around user data&lt;/li&gt;
&lt;li&gt;Keeping disparate communities together&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Issues&lt;/h2&gt;

&lt;p&gt;From the ground up, Danger could not end up as complex as CocoaPods, the domain they cover is different and CocoaPods sits atop of an annually moving (and &lt;em&gt;somewhat&lt;/em&gt; hostile) &lt;a href=&quot;https://developer.apple.com/news/&quot;&gt;platform&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, get enough people using a product and you end up with three types of issues: Bug Reports, How Do I X? and Feature Requests.&lt;/p&gt;

&lt;p&gt;I wanted to keep bug-reports down, as much as possible, and so I built a system wherein the default error reporting system would also search GitHub issues &lt;a href=&quot;https://github.com/orta/gh_inspector&quot;&gt;for similar problems&lt;/a&gt;. Knowing this was a generic problem, I built it with &lt;a href=&quot;https://github.com/fastlane/fastlane/releases/tag/1.96.0&quot;&gt;other&lt;/a&gt; &lt;a href=&quot;https://github.com/CocoaPods/CocoaPods/pull/5421&quot;&gt;large&lt;/a&gt; ruby projects in mind too.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;How do I X?&lt;/code&gt; are issues that haven&#39;t appeared much on Danger. For CocoaPods we request people use the CocoaPods tag on StackOverflow. That saves us from 5 to 6 issues a day, and provides others a great place to get internet points by responding instead.&lt;/p&gt;

&lt;p&gt;Feature Requests issues are always fascinating, it gives you a chance to really see the difference between what you imagined a project&#39;s scope is, and how others perceive it. One thing that helps here is that Danger has a &lt;a href=&quot;https://github.com/danger/danger/blob/master/VISION.md&quot;&gt;VISION.md&lt;/a&gt; file. This helped vocalise a lot of internal discussion, and let contributors understand the roadmap:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The core concept is that the Danger project itself creates a system that is extremely easy to build upon. The codebase for Danger should resolve specifically around systems for CI, communication with Peer Review tools and providing APIs to Source Control changes. For example: Travis CI - GitHub - git.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As well as providing a heuristic for determining whether something should be added to Danger:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This means that decisions on new code integrated into Danger should ask &quot;is this valid for every CI provider, every review system and source control type?&quot; by making this domain so big, we can keep the core of Danger small.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h3&gt;Infrastructure&lt;/h3&gt;

&lt;p&gt;CocoaPods has about 6 web properties, 3 of which are critical. The others can go down, or be behind the Xcode update schedules and people&#39;s projects will work fine. The 3 the critical projects are all simple, focused projects: &lt;a href=&quot;https://github.com/CocoaPods/trunk.cocoapods.org&quot;&gt;trunk&lt;/a&gt; (provide auth, and submitting new libraries) &lt;a href=&quot;https://github.com/CocoaPods/cocoapods.org&quot;&gt;cocoapods.org&lt;/a&gt;, and &lt;a href=&quot;https://github.com/CocoaPods/search.cocoapods.org&quot;&gt;search&lt;/a&gt;. We control everything there.&lt;/p&gt;

&lt;p&gt;Meanwhile the less critical ones like &lt;a href=&quot;https://github.com/CocoaPods/cocoadocs.org&quot;&gt;cocoadocs.org&lt;/a&gt; have dependencies all over the show: AppleDoc, CLOC, Xcode, Carthage, Jazzy - every one of these can, and has, been a source of unreliability for infrastructure that I maintain.&lt;/p&gt;

&lt;p&gt;With Danger, I wanted to avoid building any infrastructure that does not sit on top of solid, mature projects. The website is statically created in &lt;a href=&quot;https://middlemanapp.com&quot;&gt;Middleman&lt;/a&gt;, using &lt;a href=&quot;https://rubygems.org/gems/slim&quot;&gt;boring&lt;/a&gt; &lt;a href=&quot;https://rubygems.org/gems/sass&quot;&gt;old&lt;/a&gt; technology, this means no server to host.&lt;/p&gt;

&lt;p&gt;To support dynamic content on the website, I have a rake command to use &lt;a href=&quot;https://rubygems.org/gems/yard/versions&quot;&gt;a decade old&lt;/a&gt; documentation formatter to pull content from a &lt;a href=&quot;https://en.wikipedia.org/wiki/RubyGems&quot;&gt;13 year old&lt;/a&gt; dependency manager - that lets others describer their project&#39;s. In order to let them keep it up to date, I have a tiny 35 line web-server that allows specific projects to trigger a new CI build.&lt;/p&gt;

&lt;h3&gt;Plugins&lt;/h3&gt;

&lt;center&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en-gb&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Summary of every big OSS project. Monolith -&amp;gt; Plugin support.&lt;a href=&quot;https://t.co/7x4vuW4bRd&quot;&gt;https://t.co/7x4vuW4bRd&lt;/a&gt;&lt;/p&gt;&amp;mdash; Orta Therox (@orta) &lt;a href=&quot;https://twitter.com/orta/status/748561323164864512&quot;&gt;30 June 2016&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;/center&gt;


&lt;p&gt;&lt;br/&gt;&lt;/p&gt;

&lt;p&gt;It&#39;s almost inevitable that once a project becomes big, maintainers have to become a lot more conservative about how they introduce new code. You become good at saying &#39;no&#39;, but a lot of people have legitimate needs. So, instead you end up converting your tool into a platform.&lt;/p&gt;

&lt;p&gt;Some of the most interesting ideas in the CocoaPods ecosystem come from plugins.&lt;/p&gt;

&lt;p&gt;I wanted plugins to be a first class citizen within Danger from day one. It&#39;s in the &lt;a href=&quot;https://github.com/danger/danger/blob/master/VISION.md&quot;&gt;VISION&lt;/a&gt; file, and it&#39;s applied into how I&#39;ve designed a lot of the user-facing site. I was &lt;a href=&quot;https://github.com/danger/danger/issues/74&quot;&gt;torn&lt;/a&gt; after a few months of development &lt;a href=&quot;https://github.com/danger/danger/pull/156#issuecomment-205907128&quot;&gt;where things&lt;/a&gt; should go. Now the core of Danger is &lt;a href=&quot;https://github.com/danger/danger/pull/227&quot;&gt;built as plugins&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Documentation&lt;/h3&gt;

&lt;p&gt;My second big project on CocoaPods was collating documentation and scoping different types of documentation. In CocoaPods I ended with:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Highlight pages&lt;/strong&gt; (intro pages, app pages, team pages)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Guides&lt;/strong&gt; (tutorials, overviews, FAQs)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Reference&lt;/strong&gt; (Command-line interface, APIs for developers)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;These 3 buckets for documentation makes it pretty easy to separate where people should look depending on what they&#39;re looking for. This pattern I&#39;m stealing outright for Danger. Just not quite yet, it&#39;s a blocker on 1.0 though.&lt;/p&gt;

&lt;p&gt;One trick I took from CocoaPods is to have as much documentation as possible generated from the source code. With Danger, all of the work that&#39;s gone into documenting the code is turned into public API documentation for end-users. This makes it really easy to ensure it&#39;s consistent and up-to-date. The same tools used to generate documentation for Danger are used for plugins. Any improvements there helps everyone.&lt;/p&gt;

&lt;h2&gt;User Data&lt;/h2&gt;

&lt;p&gt;Not storing any, phew! Though if &lt;a href=&quot;https://github.com/danger/danger/issues/42&quot;&gt;Danger as a Service&lt;/a&gt; happens, then it will.&lt;/p&gt;

&lt;h2&gt;People&lt;/h2&gt;

&lt;p&gt;People are hard, Ash said in &lt;a href=&quot;https://ashfurrow.com/blog/building-popular-projects/&quot;&gt;Building Popular Projects&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The biggest existential threat to your library is this: you get burned out and stop working on it – and no one else contributes to it –&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Understanding motivations, encouraging ownership and accommodating multiple viewpoints are vital parts of anyone who wants to make a project bigger than themselves. There &lt;a href=&quot;https://github.com/danger/danger/graphs/contributors&quot;&gt;are lots of times&lt;/a&gt; when I&#39;m not the lead developer on Danger.&lt;/p&gt;

&lt;p&gt;I owe a lot of this to the policy Ash and I created with Moya, the wordy &quot;&lt;a href=&quot;https://github.com/Moya/contributors&quot;&gt;Moya Community Continuity Guidelines&lt;/a&gt;&quot; which define the expectations of the maintainers of a project towards contributors.&lt;/p&gt;

&lt;p&gt;It&#39;s helped let a lot of other contributors make an impact. In the future, I hope those are the people that I get to hand Danger off to. Danger is bigger than me.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Maintaining big projects is a learned activity, for most people it&#39;s a spectator sport, but it&#39;s not too hard to jump from writing issues to helping out. It&#39;s how I ended up contributing to CocoaPods.&lt;/p&gt;
</description>
        <pubDate>Sun, 03 Jul 2016 12:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/07/03/handling-big-projects/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/07/03/handling-big-projects/</guid>
        
        
        <category>culture</category>
        
        <category>danger</category>
        
        <category>mobile</category>
        
        <category>oss</category>
        
      </item>
    
      <item>
        <title>Code Spelunking: Injection for Xcode Plugin</title>
        <description>&lt;p&gt;It was only three months ago that I came to the conclusion of just how much time I had wasted &lt;a href=&quot;http://artsy.github.io/blog/2016/03/05/iOS-Code-Injection/&quot;&gt;on code compilation cycles&lt;/a&gt;, once I started to play with &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode&quot;&gt;Injection for Xcode&lt;/a&gt;. I still feel guilt about the time I wasted. However, I&#39;m trying to turn that into something constructive. In order to do that, I need to have a solid understanding of the fundamentals on how Injection For Xcode works.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ashfurrow.com/&quot;&gt;Ash&lt;/a&gt; says one of the best ways to &lt;a href=&quot;https://ashfurrow.com/blog/teaching-learning/&quot;&gt;learn is to teach&lt;/a&gt;. So I&#39;m going to try take you through a guided tour of the code-base. You need some pretty reasonable Objective-C chops to get this, but anyone with an app or two under their belt should be able to &lt;a href=&quot;https://en.wikipedia.org/wiki/Grok&quot;&gt;grok&lt;/a&gt; it.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;&lt;img src=&quot;/images/2016-06-29-injection-overview/overview.png&quot; alt=&quot;Xcode Project Overview&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You might find it easier to clone the repo and have Xcode open along-side this article, to quickly do that, run these commands to put it in a temporary folder via the terminal:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;sh&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /tmp/
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;git clone https://github.com/johnno1962/injectionforxcode TempInjection
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;open TempInjection/InjectionPluginLite/InjectionPlugin.xcodeproj/
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;h2&gt;A note on code style&lt;/h2&gt;

&lt;p&gt;I am of the _why &lt;a href=&quot;https://www.smashingmagazine.com/2010/05/why-a-tale-of-a-post-modern-genius/#dont-be-afraid-to-take-risks&quot;&gt;camp of programming&lt;/a&gt; - the code we are spelunking through can feel foreign to modern Objective-C, and it&#39;s not got tests. &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; described it to me as being like 1997&#39;s Objective-C. The end result of all this code &lt;em&gt;is&lt;/em&gt; beautiful, whether the code is - is a matter of perspective. I&#39;m super happy it exists.&lt;/p&gt;

&lt;h2&gt;Targets&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;InjectionPlugin - The user facing Xcode plugin&lt;/li&gt;
&lt;li&gt;InjectionLoader - A Bundle used to skip patching a project for injection.&lt;/li&gt;
&lt;li&gt;iOSBundleTemplate - A folder to a reference implementation of a iOS Project&lt;/li&gt;
&lt;li&gt;OSXBundleTemplate - Same but for OSX Project&lt;/li&gt;
&lt;li&gt;unhide - A command line tool that extracts symbols from a Swift Framework&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Implementation Order&lt;/h2&gt;

&lt;p&gt;I want to go through the code-base from the perspective what happens when it:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Loads up inside Xcode.&lt;/li&gt;
&lt;li&gt;Recieves a call to inject.&lt;/li&gt;
&lt;/ul&gt;


&lt;h3&gt;Launch&lt;/h3&gt;

&lt;p&gt;All Xcode plugins have the exact same launch process, you &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Info.plist#L21-L22&quot;&gt;define a class&lt;/a&gt; in the info.plist, this class, &lt;code&gt;INPluginMenuController&lt;/code&gt;, gets &lt;code&gt;+ pluginDidLoad:&lt;/code&gt; called. This is where you &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L83-L94&quot;&gt;set up a shared instance&lt;/a&gt;, and can keep a reference to your bundle.&lt;/p&gt;

&lt;p&gt;This triggers the interesting stuff in &lt;code&gt;applicationDidFinishLaunching:&lt;/code&gt; this sets up the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L131-L137&quot;&gt;user interface from a nib file&lt;/a&gt;, which &lt;a href=&quot;http://artsy.github.io/blog/2016/06/27/dependency-injection-in-swift/&quot;&gt;DIs&lt;/a&gt; in a lot of the instance variables, and will send you to get a new version of Injection if it fails. It then sets up the menu ( note: &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L151-L154&quot;&gt;interesting use of c-structs here&lt;/a&gt; ) and starts a TCP server, then registers for when a &lt;code&gt;NSWindow&lt;/code&gt; becomes active.&lt;/p&gt;

&lt;h4&gt;Server&lt;/h4&gt;

&lt;p&gt;The server is a &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L512-L535&quot;&gt;c TCP socket&lt;/a&gt;, prior to digging in here, I&#39;d never needed to see one. I see a lot of references to Android injection, so I assume the low-level choice in a socket  was so the same code can do both platforms.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;c&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;startServer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr_in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_family&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INADDR_ANY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;serverAddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;htons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;INJECTION_PORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;optval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverSocket&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Could not open service socket: %s&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strerror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[...]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// skipping a bunch of error handling&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Service socket would not listen: %s&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strerror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;performSelectorInBackground&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundConnectionService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;withObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Assuming everything went well, then a &lt;a href=&quot;https://en.wikipedia.org/wiki/Bonjour_%28software%29&quot;&gt;Bonjour&lt;/a&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L539-L542&quot;&gt;service&lt;/a&gt; is created advertising the socket on the network. This then moves to a background thread and starts a infinite runloop checking for new connections on the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L545-L557&quot;&gt;socket every 0.5 seconds&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here is it &lt;a href=&quot;/images/2016-06-29-injection-overview/selected_bonjour.png&quot;&gt;running&lt;/a&gt; in &lt;a href=&quot;http://tildesoft.com&quot;&gt;Bonjour Browser&lt;/a&gt;. So, what does this server do? That&#39;s handled inside &lt;code&gt;INPluginClientController&lt;/code&gt;. It uses a MAC address so that you can have multiple non-competing services running on the same network.&lt;/p&gt;

&lt;p&gt;At its simplest, the server exists to send messages between running multiple applications and the injection plugin. We&#39;ll get back to what the server does later.&lt;/p&gt;

&lt;h4&gt;Inside Xcode&lt;/h4&gt;

&lt;p&gt;The plugin will keep track of the key editor window, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L214-L220&quot;&gt;this is done&lt;/a&gt; by making sure the window&#39;s controller is of the class &lt;code&gt;IDEWorkspaceWindowController&lt;/code&gt; and that it has a corresponding file.&lt;/p&gt;

&lt;p&gt;That&#39;s basically everything set up for the plugin now, until a user decides to start using Injection. So we&#39;re going to move to what happens when you press &lt;code&gt;ctrl + =&lt;/code&gt;.&lt;/p&gt;

&lt;h4&gt;On Preparing for Injection&lt;/h4&gt;

&lt;p&gt;The work starts at &lt;code&gt;injectSource&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L359&quot;&gt;from INPluginMenuController&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The first thing it does is grab the current file, then saves it. It then checks what type of file it is, as only &lt;code&gt;.m, .mm, .swift or .storyboard&lt;/code&gt; can be injected.&lt;/p&gt;

&lt;p&gt;Next, it pulls out a reference to the currently running LLDB session, the console in the bottom of Xcode. It checks if the server has any active clients.&lt;/p&gt;

&lt;p&gt;OK, to understand the next bit you need to understand what &lt;em&gt;&quot;unpatched injection&quot;&lt;/em&gt; is. In order to support code injection, your app has to have some way to communicate back to the TCP server hosted in Xcode. This can be done either by &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/documentation/patching_injection.md&quot;&gt;including some source code&lt;/a&gt; in your project, or by adding it in at runtime. Including the source code, is &quot;patching&quot; your project to allow injection. It&#39;s optional because of what comes next.&lt;/p&gt;

&lt;p&gt;If there are no clients connected, then requests a pause from LLDB, allowing the plugin to send messages to the running app, it then waits a few microseconds to give the debugger chance to load. Once it&#39;s loaded &lt;code&gt;loadBundle:&lt;/code&gt; is &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L404-L415&quot;&gt;called&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Injection then sends &lt;code&gt;expr -l objc++ -O -- (void)[[NSClassFromString(@&quot;NSBundle&quot;)  bundleWithPath:@&quot;/Users/orta/Library/Application Support/Developer/Shared/Xcode/Plug-ins/InjectionPlugin.xcplugin/Contents/Resources/InjectionLoader.bundle&quot;] load]&lt;/code&gt; into the debugger. Causing the same code as the patch to exist inside your app.  This code comes from the second target from the list at the top, and is hosted inside the plugin&#39;s bundle (meta...).&lt;/p&gt;

&lt;p&gt;With that verified, it&#39;s ready to inject the source code.&lt;/p&gt;

&lt;h4&gt;Code Injection Compilation&lt;/h4&gt;

&lt;p&gt;If everything is good, and ready to go, and we&#39;ve got confirmation that a client exists, Injection starts monitoring for file changes inside your Xcodeproject.&lt;/p&gt;

&lt;p&gt;A lot of the code injection work is done inside perl scripts, another new language for me. OK, so, at the end of &lt;code&gt;injectSource&lt;/code&gt; it runs &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl&quot;&gt;injectSource.pl&lt;/a&gt; with an argument of the file to inject.&lt;/p&gt;

&lt;p&gt;Note, a lot of ground-work for the perl scripts is done inside &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/common.pm&quot;&gt;common.pm&lt;/a&gt; - which is a module the other &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L15&quot;&gt;scripts import&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It is the role and responsibility of this script to setup, maintain and amend an xcodeproject that compiles just the class that has changed into a new bundle. Luckily for me this is pretty well documented &lt;code&gt;:D&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;It starts out by copying a template xcodeproject (either &lt;code&gt;iOSBundleTemplate&lt;/code&gt; or &lt;code&gt;OSXBundleTemplate&lt;/code&gt;) into your current project directory. I &lt;a href=&quot;https://github.com/artsy/eigen/pull/1236/files#diff-a084b794bc0759e7a6b77810e01874f2R46&quot;&gt;add this&lt;/a&gt; to the &lt;code&gt;.gitignore&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Next it pulls out the build settings for all these keys &lt;code&gt;FRAMEWORK_SEARCH_PATHS HEADER_SEARCH_PATHS USER_HEADER_SEARCH_PATHS GCC_VERSION ARCHS VALID_ARCHS GCC_PREPROCESSOR_DEFINITIONS GCC_ENABLE_OBJC_EXCEPTIONS&lt;/code&gt; from your project, into the sub-project.&lt;/p&gt;

&lt;p&gt;Next it determines how to handle code-signing on the app, as it supports both simulator and on-device, and you need to sign to run any code on a device.&lt;/p&gt;

&lt;p&gt;After that, if needs to understand how to compile an individual file, it gets a reference to the build log dirs for the &lt;a href=&quot;/images/2016-06-29-injection-overview/build_logs.png&quot;&gt;derived data&lt;/a&gt; for your app. They&#39;re zipped files, so it unzips them and parses the log. Here&#39;s an example of what &lt;a href=&quot;/images/2016-06-29-injection-overview/a_build_log.png&quot;&gt;compiling a single class from Eigen looks like&lt;/a&gt; (I&#39;ve highlighted the useful bits). Internally, this is called the learnt db.&lt;/p&gt;

&lt;p&gt;The learnt db is used to compile a class to be individually compiled into a &lt;code&gt;injecting_class.o&lt;/code&gt; file, I can&#39;t quite figure out where that file comes from though.&lt;/p&gt;

&lt;p&gt;To wrap up the compilation it needs to take the compiled object &lt;code&gt;injecting_class.o&lt;/code&gt; and statically link it to the bundle that is generated inside the sub-project. Here is the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L331-L365&quot;&gt;command line generation&lt;/a&gt;, building the script is a little bit &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L376-L467&quot;&gt;more involved&lt;/a&gt; - but that&#39;s generally because it&#39;s trying to support a lot of user options. The main class that exists in the bundle is &lt;code&gt;BundleContents&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The compiled bundle is then renamed so that you don&#39;t have name clashes, it&#39;s just incremental integers. My current sub-project I&#39;m using for debugging looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2016-06-29-injection-overview/injection_subproject.png&quot; alt=&quot;Injection Subproject&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With the &lt;code&gt;Logs&lt;/code&gt; dir being a symlink to the derived data folder.&lt;/p&gt;

&lt;p&gt;With that done, it will &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L487-L503&quot;&gt;include any nibs&lt;/a&gt; from compiling storyboards, and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L505-L512&quot;&gt;code-sign the bundle&lt;/a&gt; if it&#39;s going to a device. Finally it prints out &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L515&quot;&gt;the new bundle path&lt;/a&gt; in so the monitoring script can work with it.&lt;/p&gt;

&lt;h4&gt;Script Monitoring&lt;/h4&gt;

&lt;p&gt;The script to create the Xcode project, amend it, and compile is done as a separate process. It&#39;s &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L365&quot;&gt;done&lt;/a&gt; via the &lt;a href=&quot;http://linux.die.net/man/3/popen&quot;&gt;function&lt;/a&gt; &lt;code&gt;popen&lt;/code&gt;. This is then monitored in background, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L382&quot;&gt;listening for output lines&lt;/a&gt; that begins with &lt;code&gt;&amp;lt;&lt;/code&gt;, &lt;code&gt;&amp;gt;&lt;/code&gt;, &lt;code&gt;!&lt;/code&gt;, &lt;code&gt;%&lt;/code&gt; and &lt;code&gt;?&lt;/code&gt;. The one that we&#39;re most interested in, is the &lt;code&gt;!&lt;/code&gt; operator which tells the server the filepath of the now compiled &lt;code&gt;InjectionBundleX.bundle&lt;/code&gt;, in my most recent case, this looked like &lt;code&gt;/Users/orta/dev/ios/energy/iOSInjectionProject/build/Debug-iphonesimulator/InjectionBundle4.bundle&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L422-L423&quot;&gt;tells the&lt;/a&gt; server running inside Xcode that it has a file to send to the clients.&lt;/p&gt;

&lt;h4&gt;How the server works&lt;/h4&gt;

&lt;p&gt;Alright, back to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m&quot;&gt;the INPluginClientController&lt;/a&gt;. Skipping over the option setting &lt;code&gt;IBAction&lt;/code&gt;s and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L129-L185&quot;&gt;RTF-formatted logging&lt;/a&gt;. We come to the initial connection responder: &lt;code&gt;setConnection:&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;So, this is where I ended up a bit out of my comfort zone. This isn&#39;t a blog post about sockets and c though, so I&#39;ll annotate what&#39;s going on from the high level thoughout this &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L189&quot;&gt;connection setup function&lt;/a&gt;.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Grab some the main client file from socket, then if it&#39;s is an injection message, set the Injection console&#39;s info label to that filepath, this is the &lt;code&gt;BundleContents.m&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Otherwise inject all objects from a storyboard (not too sure whats going on there TBH)&lt;/li&gt;
&lt;li&gt;The server &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L216&quot;&gt;asks the client&lt;/a&gt; for the app&#39;s path e.g. &lt;code&gt;/Users/orta/Library/Developer/CoreSimulator/Devices/CDC9D8EF-AAAD-47F8-8D53-C3C69551E85A/data/Containers/Data/Application/1F636180-7113-406E-88F8-7E43EFAC13F6&quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;There&#39;s some more communication around the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginClientController.m#L229-L230&quot;&gt;app&#39;s architecture&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;The app gets a &lt;a href=&quot;/images/2016-06-29-injection-overview/badge.png&quot;&gt;badge&lt;/a&gt; with the client count on it, so you know it&#39;s working.&lt;/li&gt;
&lt;li&gt;If checks if you want the File Watcher turned on.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;From that point the server&#39;s job is mainly to pass messages and files that come out of the scripts between the client and the host doing the compilation.&lt;/p&gt;

&lt;h4&gt;File Watcher&lt;/h4&gt;

&lt;p&gt;As an option you can set in the preferences toggles a File Watcher. I found a bunch of references to this in the code, so I wanted to at least dig into that. When you turn it on, any save will trigger an injection. This is done by looking for the folder that your &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/INPluginMenuController.m#L432-L436&quot;&gt;project resides in&lt;/a&gt;, then using Apple&#39;s &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/FileWatcher.m#L31&quot;&gt;file system event stream&lt;/a&gt; to monitor for save changes. Then when a new FS event is triggered, it re-injects that file. I bet it&#39;s turned off by default as you&#39;ll see errors when it&#39;s not compilable.&lt;/p&gt;

&lt;h2&gt;Client-Side&lt;/h2&gt;

&lt;p&gt;We&#39;ve hand-waved though the client-side of the app during the patching stage of installation, but to understand both parts of the system we need to cover the client side in a bit more depth. There&#39;s two aspects to it, the initial bundle/patch and incremental bundles that contain the new compiled code.&lt;/p&gt;

&lt;h4&gt;Client Setup&lt;/h4&gt;

&lt;p&gt;To understand this, we need to grok a 1,200 LOC header file &lt;code&gt;:D&lt;/code&gt;, it has a few responsibilities though. So we can try work through those, to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h&quot;&gt;BundleInjection.h&lt;/a&gt;. Interesting note, when you are patching your application - you&#39;re actually making a link to a copy of this file inside your &lt;code&gt;/tmp/&lt;/code&gt; dir.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;objc&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_inMainFilePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__FILE__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_inIPAddresses&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;10.12.1.67&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;127.0.0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#define INJECTION_ENABLED&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#import &amp;quot;/tmp/injectionforxcode/BundleInjection.h&amp;quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;cp&quot;&gt;#endif&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;h4&gt;Client Socket Connection&lt;/h4&gt;

&lt;p&gt;Like the server, this has two responsibilities - using Bonjour to find the server, and raw socket communication. There is nothing unique about the Bonjour mutlicast work, so I&#39;m skipping that. Once the socket knows how to establish a connection between processes &lt;code&gt;+ bundleLoader&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L359&quot;&gt;is called&lt;/a&gt; on a background thread.&lt;/p&gt;

&lt;p&gt;So, what does &lt;code&gt;bundleLoad&lt;/code&gt; do?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It checks if it&#39;s a new Injection install in the app, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L366-L367&quot;&gt;if so&lt;/a&gt; it sets up &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/documentation/tunable_parameters.md&quot;&gt;INParameters and INColors&lt;/a&gt; for tunable parameters.&lt;/li&gt;
&lt;li&gt;It then determines the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L383-L400&quot;&gt;hardware architecture&lt;/a&gt; for it to be sent to the server for compilation later.&lt;/li&gt;
&lt;li&gt;Attempt to connect to the server, 5 times.&lt;/li&gt;
&lt;li&gt;If it succeeds, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L415&quot;&gt;write the location&lt;/a&gt; of the &lt;code&gt;BundleInjection&lt;/code&gt; file to the server. Triggering the first of the socket work on the server.&lt;/li&gt;
&lt;li&gt;Expect a response of the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L417&quot;&gt;server&#39;s&lt;/a&gt; version of &lt;code&gt;BundleInjection&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;If the bundle is compiling storyboards on iOS, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L424-L429&quot;&gt;swizzle some&lt;/a&gt; of the UINib init functions.&lt;/li&gt;
&lt;li&gt;Pass the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L443&quot;&gt;home directory of the app&lt;/a&gt; to the server.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;From there the socket goes into runloop mode on it&#39;s on thread.&lt;/p&gt;

&lt;h4&gt;Client Socket Runloop&lt;/h4&gt;

&lt;p&gt;As with server monitoring, the client listens for strings that begin with special prefixes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;~&lt;/code&gt; - Injects, then Re-creates the app degelate + view controller heirarchy.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/&lt;/code&gt; - &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L644&quot;&gt;Loads&lt;/a&gt; the bundle path that was sent in.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;gt;&lt;/code&gt; - Accepts a file or directory to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L476&quot;&gt;be sent through the socket&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;&lt;/code&gt; - Sends a requested file or directory to &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L492&quot;&gt;through the socket&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#&lt;/code&gt; - &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L540&quot;&gt;Receives&lt;/a&gt; an &lt;code&gt;NS/UIImage&lt;/code&gt; via NSData for Tunable Parameters.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;!&lt;/code&gt; - Logs to console&lt;/li&gt;
&lt;li&gt;Otherwise, assume it&#39;s another Tunable Parameter.&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;Loading the Bundle&lt;/h4&gt;

&lt;p&gt;When the new bundle is loaded &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L303-L308&quot;&gt;it triggers&lt;/a&gt; this code:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;objc&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kt&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSClassFromString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&amp;quot;BundleInjection&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;autoLoadedNotify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;hook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;injectionHook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Which does the job of letting the running app know that instances have been updated with new code. Injection does three things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;A global NSNotification for .&lt;/li&gt;
&lt;li&gt;Sends all instances of classes injected a message that they&#39;ve been injected.&lt;/li&gt;
&lt;li&gt;Sends all classes that have been injected a message they&#39;ve been injected.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Which is where this goes from &quot;complex&quot;, to &quot;I would need to study up to do this.&quot; Let&#39;s start of quoting the README that &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; and I worked on for a while.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It can be tough to look through all of the memory of a running application. In order to determine the classes and instances to call the injected callbacks on, Injection performs a &quot;sweep&quot; to find all objects in memory. Roughly, this involves looking at an object, then recursively looking through objects which it refers to. For example, the object&#39;s instance variables and properties.&lt;/p&gt;

&lt;p&gt;This process is seeded using the application&#39;s delegate and all windows. Once all the in-memory reference are collected, Injection will then filter these references to ones that it has compiled and injected. Then sending them the messages referenced in the callbacks section.&lt;/p&gt;

&lt;p&gt;If no references are found, Injection will look through all objects that are referred to via sharedInstance. If that fails, well, Injection couldn&#39;t find your instance. This is one way in which you may miss callbacks in your app.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h4&gt;Class + Method Injections&lt;/h4&gt;

&lt;p&gt;So how does it pull that off? Calling &lt;code&gt;NSBundle&lt;/code&gt;&#39;s &lt;code&gt;- load&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L648&quot;&gt;here&lt;/a&gt;, calls the &lt;a href=&quot;https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSBundle_Class/index.html#//apple_ref/occ/instm/NSBundle/load&quot;&gt;load function to call on all classes&lt;/a&gt; inside that new bundle. This triggers the load function from the &lt;code&gt;InjectionBundle&lt;/code&gt; that is auto-generated during the Injection stage. Here&#39;s what one of mine looks like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;objc&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;InjectionBundle3&lt;/span&gt; : &lt;span class=&quot;bp&quot;&gt;NSObject&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;InjectionBundle3&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kt&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSClassFromString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&amp;quot;BundleInjection&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bundleInjection&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;autoLoadedNotify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;hook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;injectionHook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This is generated from the &lt;code&gt;injectSource.pl&lt;/code&gt; script &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/injectSource.pl#L311-L315&quot;&gt;here&lt;/a&gt;] &lt;code&gt;[bundleInjection autoLoadedNotify:$flags hook:(void *)injectionHook];&lt;/code&gt; . It also comes with another function,&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;c&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;injectionHook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;n&quot;&gt;NSLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\@&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;injectionHook():&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InjectionBundle3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;What we care about is &lt;code&gt;&amp;amp;injectionHook&lt;/code&gt; which gets passed to &lt;code&gt;autoLoadedNotify&lt;/code&gt; as a pointer to a function. Oddly enough, I&#39;m a tad confused about the fact that the injection hook contains a reference to the function that calls it, but lets roll with it for now. Perhaps it&#39;s never actually called, &lt;em&gt;I asked&lt;/em&gt; -it&#39;s for Android support, and isn&#39;t used.&lt;/p&gt;

&lt;p&gt;So, we&#39;ve had a fairly typical &lt;code&gt;NSBundle&lt;/code&gt; &lt;code&gt;- load&lt;/code&gt; load our classes into the runtime. This triggered the &lt;code&gt;InjectionBundle.bundle&lt;/code&gt; to have it&#39;s classes created, and the first thing it does is pass a reference back to the &lt;code&gt;BundleInjection&lt;/code&gt; class instance for the &lt;code&gt;injectionHook&lt;/code&gt; function that calls the &lt;code&gt;load&lt;/code&gt; on the new classes.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; terminology changes here, I&#39;ve talked about a bundle, but now that the code is in the runtime, we start talking about it as a dynamic library. These bundles contain 2 files &lt;code&gt;Info.plist&lt;/code&gt;, &lt;code&gt;InjectionBundleX&lt;/code&gt; - so when I say dynamic library, I&#39;m referring to the code that is inside the bundle that is linked ar runtime (and thus dynamically linked in.)&lt;/p&gt;

&lt;p&gt;Next, Injection creates a &lt;a href=&quot;https://github.com/davetroy/astmanproxy/blob/f4b952a717b7e982b585bf0daa86398add394a88/src/include/dlfcn-compat.h#L44-L54&quot;&gt;dynamic library info&lt;/a&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L944-L946&quot;&gt;struct&lt;/a&gt; and uses &lt;a href=&quot;http://linux.die.net/man/3/dladdr&quot;&gt;dladdr&lt;/a&gt; to fill the struct, based on the function pointer. This lets Injection know where in memory the library exists. It&#39;s now safe in the knowledge that the code has been injected into the runtime. Injection will re-create the app structure, if requested - like when it receives a socket event of &lt;code&gt;~&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;We&#39;re getting into Mach-O binary APIs, so put on your crash helmets. Injection is going to use the dynamic library info, and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L959-L981&quot;&gt;ask for the Objective-C&lt;/a&gt; &lt;code&gt;__classlist&lt;/code&gt; via &lt;a href=&quot;http://www.manpagez.com/man/3/getsectdatafromheader/&quot;&gt;getsectdatafromheader&lt;/a&gt; for the new dynamic library. This works fine for Swift too, it &lt;em&gt;mostly&lt;/em&gt; has to be exposed to the Objective-C runtime. If you want to understand more about what this looks like, read &lt;a href=&quot;https://blog.zynamics.com/2010/07/02/objective-c-reversing-ii/&quot;&gt;this blog post&lt;/a&gt; from &lt;a href=&quot;https://zynamics.com&quot;&gt;Zynamics&lt;/a&gt;. Injection then loops through the classes inside the library, via the most &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L988&quot;&gt;intensely casted&lt;/a&gt; line in of code in here: &lt;code&gt;Class *classReferences = (Class *)(void *)((char *)info.dli_fbase+(uint64_t)referencesSection);&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;These classes are then iterated though, and &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L836-L845&quot;&gt;new implementations of functions are swizzled&lt;/a&gt; to reference the new implementations. With Swift you have no guarantee that the methods are &lt;code&gt;dynamic&lt;/code&gt; so all their &lt;code&gt;vtable&lt;/code&gt; &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L847-L855&quot;&gt;data is switched&lt;/a&gt;. If you don&#39;t know what a vtable is check this &lt;a href=&quot;https://en.wikipedia.org/wiki/Virtual_method_table&quot;&gt;page on Wikipedia&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Once all of the classes have had their methods switched, the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L911-L937&quot;&gt;class table is updated&lt;/a&gt; to ensure that functions that rely on the class table ( e.g. &lt;code&gt;NSClassFromSelector&lt;/code&gt; ) return the new values.&lt;/p&gt;

&lt;p&gt;With valid class tables, and the newly injected functions added. Injection starts the memory sweep to send updated notifications.&lt;/p&gt;

&lt;h4&gt;Class + Instance Notifications&lt;/h4&gt;

&lt;p&gt;At &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L1028&quot;&gt;this point&lt;/a&gt; Injected does a run through the new class list again, if that class responds to the selector &lt;code&gt;+ injected&lt;/code&gt; it runs it. It then does a check to see if the class&#39;s instances reponds to &lt;code&gt;- injected&lt;/code&gt; if it does, it looks to see if it has any instances of the objects in it&#39;s liveObjects array. If the array hasn&#39;t been set up, then it needs to do a full memory sweep.&lt;/p&gt;

&lt;p&gt;Injection has an &lt;a href=&quot;https://github.com/johnno1962/Xprobe&quot;&gt;Xprobe&lt;/a&gt;-lite included inside it. This lives in &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h&quot;&gt;BundleSweeper.h&lt;/a&gt;. The quote opening this notification section above gave the start away, BundleSweeper &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L47&quot;&gt;looks at the app delegate&lt;/a&gt; ( or a &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L55&quot;&gt;Cocos2D director object&lt;/a&gt;) and then starts to recursively look at every object that it&#39;s related to. This is done by adding a &lt;code&gt;bwseep&lt;/code&gt; function to &lt;code&gt;NSObject&lt;/code&gt; then individually customizing it for known container classes, and &quot;reference&quot; classes e.g &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L228&quot;&gt;NSBlock&lt;/a&gt;, &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L221&quot;&gt;NSData&lt;/a&gt;, NSString, NSValue etc. The &lt;code&gt;bsweep&lt;/code&gt; function adds itself to the &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L113-L117&quot;&gt;shared list&lt;/a&gt; of &quot;objects seen&quot;, checks for an it being a &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L119-L124&quot;&gt;private class or a transition&lt;/a&gt;, if it&#39;s not then it loops through the &lt;a href=&quot;http://stackoverflow.com/questions/16304483/debug-obtain-a-list-of-all-instance-variables-of-an-object-unknown-type&quot;&gt;IvarList&lt;/a&gt; and runs &lt;code&gt;bsweep&lt;/code&gt; on all of those. With that done, it casually tests to see if there are any weakly held objects that &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/16a9b8e93b458b1c5916e95df06fe8c74cb56862/InjectionPluginLite/Classes/BundleSweeper.h#L148-L160&quot;&gt;tend to use common selectors&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let that simmer for a bit ( I jest, it&#39;s super fast. ) and then you have &lt;em&gt;almost&lt;/em&gt; every object in your object graph being told that they&#39;ve been updated. I say almost because of the above caveat. Can&#39;t find all objects this way. Singletons that never are referenced strongly from another object inside the findable graph wouldn&#39;t get a notification this way for example.&lt;/p&gt;

&lt;p&gt;With all the fancy class an instance nofications sorted, there is a good old reliable &lt;code&gt;NSNotification&lt;/code&gt; - &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/master/InjectionPluginLite/Classes/BundleInjection.h#L1065&quot;&gt;here&lt;/a&gt;. Which is what I based my &lt;a href=&quot;https://github.com/artsy/eigen/pull/1236&quot;&gt;work on for Eigen&lt;/a&gt;, super simple, extremely reliable and great for re-use.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/49038/13548868/131cbb1e-e2c8-11e5-9f61-4acdfd10b6aa.gif&quot; alt=&quot;https://cloud.githubusercontent.com/assets/49038/13548868/131cbb1e-e2c8-11e5-9f61-4acdfd10b6aa.gif&quot; /&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;Phew!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;So, this covered the majority of how Injection for Xcode works. It&#39;s a &lt;em&gt;really&lt;/em&gt; powerful tool, that can vastly improve your day-to-day programming. When I showed a draft of this post to &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; he reminded me that &lt;a href=&quot;https://github.com/johnno1962/Diamond&quot;&gt;Diamond&lt;/a&gt; - his Swift scripting improvement tool, had it&#39;s own version of Injector inside that, that is much &lt;a href=&quot;https://github.com/johnno1962/Diamond/blob/master/Reloader/Reloader.m&quot;&gt;simpler and a easier read&lt;/a&gt; at 120 LOC. However, can&#39;t understand the future without understanding the past.&lt;/p&gt;

&lt;p&gt;A lot of the most complicated code is around:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The client-server architecture, and about passing files/folders between the running application and the Xcode plugin.&lt;/li&gt;
&lt;li&gt;The recursive memory sweeping required to get a notification that it&#39;s done.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The actual work involved in &lt;a href=&quot;https://github.com/johnno1962/injectionforxcode/blob/2c1696e7301fdcf1d99a8a75be501df7c25d93e8/InjectionPluginLite/Classes/BundleInjection.h#L807-L938&quot;&gt;doing the injection, and replacing the classes&lt;/a&gt; isn&#39;t particularly complicated, and is easy to understand without c/Mach-o domain knowledge. It&#39;s making sure the environment is set up and supporting useful features like Storyboards, Android via Apportable, ARC and no-ARC, 32bit vs 64bit and iOS vs Mac where things start to become more complex.&lt;/p&gt;

&lt;p&gt;As of Xcode 8, Xcode Plugins are on the way out, though there are hacks to work around the system to install them, doing so might not be the smartest of moves yet. It&#39;s hard to see where the future lies here. However,&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://media2.giphy.com/media/VHW0X0GEQQjiU/giphy.gif&quot; alt=&quot;Giphy&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we&#39;ll see in a few months.&lt;/p&gt;

&lt;p&gt;If you&#39;re interested in this kind of stuff, follow &lt;a href=&quot;https://github.com/johnno1962/&quot;&gt;@Johno1962&lt;/a&gt; on Twitter, he&#39;s &lt;a href=&quot;https://twitter.com/Injection4Xcode&quot;&gt;@Injection4Xcode&lt;/a&gt; - Chris Lattner follows him, so you know it&#39;s good stuff. He&#39;s always got some project that is pushing a boundry or two.&lt;/p&gt;
</description>
        <pubDate>Wed, 29 Jun 2016 12:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2016/06/29/code-spelunking-injection/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2016/06/29/code-spelunking-injection/</guid>
        
        
        <category>mobile</category>
        
        <category>swift</category>
        
        <category>tooling</category>
        
        <category>xcode</category>
        
      </item>
    
  </channel>
</rss>
